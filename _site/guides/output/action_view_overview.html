<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Ruby on Rails Guides</title>
<link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />

<link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

<link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
</head>
<body class="guide">
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">More at <a href="http://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        More Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="http://rubyonrails.org/">Overview</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/download">Download</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/deploy">Deploy</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">Code</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/screencasts">Screencasts</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/documentation">Documentation</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/ecosystem">Ecosystem</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/community">Community</a></li>
        <li class="more-info"><a href="http://weblog.rubyonrails.org/">Blog</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Return to home page">Guides.rubyonrails.org</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Home</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">Guides Index</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>Start Here</dt>
                <dd><a href="getting_started.html">Getting Started with Rails</a></dd>
                <dt>Models</dt>
                <dd><a href="active_record_basics.html">Active Record Basics</a></dd>
                <dd><a href="migrations.html">Rails Database Migrations</a></dd>
                <dd><a href="active_record_validations.html">Active Record Validations</a></dd>
                <dd><a href="active_record_callbacks.html">Active Record Callbacks</a></dd>
                <dd><a href="association_basics.html">Active Record Associations</a></dd>
                <dd><a href="active_record_querying.html">Active Record Query Interface</a></dd>
                <dt>Views</dt>
                <dd><a href="layouts_and_rendering.html">Layouts and Rendering in Rails</a></dd>
                <dd><a href="form_helpers.html">Action View Form Helpers</a></dd>
                <dt>Controllers</dt>
                <dd><a href="action_controller_overview.html">Action Controller Overview</a></dd>
                <dd><a href="routing.html">Rails Routing from the Outside In</a></dd>
              </dl>
              <dl class="R">
                <dt>Digging Deeper</dt>
                <dd><a href="active_support_core_extensions.html">Active Support Core Extensions</a></dd>
                <dd><a href="i18n.html">Rails Internationalization API</a></dd>
                <dd><a href="action_mailer_basics.html">Action Mailer Basics</a></dd>
                <dd><a href="security.html">Securing Rails Applications</a></dd>
                <dd><a href="debugging_rails_applications.html">Debugging Rails Applications</a></dd>
                <dd><a href="configuring.html">Configuring Rails Applications</a></dd>
                <dd><a href="command_line.html">Rails Command Line Tools and Rake Tasks</a></dd>
                <dd><a href="asset_pipeline.html">Asset Pipeline</a></dd>
                <dd><a href="working_with_javascript_in_rails.html">Working with JavaScript in Rails</a></dd>
                <dt>Extending Rails</dt>
                <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                <dd><a href="generators.html">Creating and Customizing Rails Generators</a></dd>
                <dt>Contributing to Ruby on Rails</dt>
                <dd><a href="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</a></dd>
                <dd><a href="api_documentation_guidelines.html">API Documentation Guidelines</a></dd>
                <dd><a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</a></dd>
                <dt>Maintenance Policy</dt>
                <dd><a href="maintenance_policy.html">Maintenance Policy</a></dd>
                <dt>Release Notes</dt>
                <dd><a href="4_1_release_notes.html">Ruby on Rails 4.1 Release Notes</a></dd>
                <dd><a href="4_0_release_notes.html">Ruby on Rails 4.0 Release Notes</a></dd>
                <dd><a href="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes</a></dd>
                <dd><a href="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes</a></dd>
                <dd><a href="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes</a></dd>
                <dd><a href="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes</a></dd>
                <dd><a href="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes</a></dd>
              </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">Contribute</a></li>
        <li><a class="nav-item" href="credits.html">Credits</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">Guides Index</option>
              <optgroup label="Start Here">
                  <option value="getting_started.html">Getting Started with Rails</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record Basics</option>
                  <option value="migrations.html">Rails Database Migrations</option>
                  <option value="active_record_validations.html">Active Record Validations</option>
                  <option value="active_record_callbacks.html">Active Record Callbacks</option>
                  <option value="association_basics.html">Active Record Associations</option>
                  <option value="active_record_querying.html">Active Record Query Interface</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="layouts_and_rendering.html">Layouts and Rendering in Rails</option>
                  <option value="form_helpers.html">Action View Form Helpers</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller Overview</option>
                  <option value="routing.html">Rails Routing from the Outside In</option>
              </optgroup>
              <optgroup label="Digging Deeper">
                  <option value="active_support_core_extensions.html">Active Support Core Extensions</option>
                  <option value="i18n.html">Rails Internationalization API</option>
                  <option value="action_mailer_basics.html">Action Mailer Basics</option>
                  <option value="security.html">Securing Rails Applications</option>
                  <option value="debugging_rails_applications.html">Debugging Rails Applications</option>
                  <option value="configuring.html">Configuring Rails Applications</option>
                  <option value="command_line.html">Rails Command Line Tools and Rake Tasks</option>
                  <option value="asset_pipeline.html">Asset Pipeline</option>
                  <option value="working_with_javascript_in_rails.html">Working with JavaScript in Rails</option>
              </optgroup>
              <optgroup label="Extending Rails">
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">Creating and Customizing Rails Generators</option>
              </optgroup>
              <optgroup label="Contributing to Ruby on Rails">
                  <option value="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</option>
                  <option value="api_documentation_guidelines.html">API Documentation Guidelines</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</option>
              </optgroup>
              <optgroup label="Maintenance Policy">
                  <option value="maintenance_policy.html">Maintenance Policy</option>
              </optgroup>
              <optgroup label="Release Notes">
                  <option value="4_1_release_notes.html">Ruby on Rails 4.1 Release Notes</option>
                  <option value="4_0_release_notes.html">Ruby on Rails 4.0 Release Notes</option>
                  <option value="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes</option>
                  <option value="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes</option>
                  <option value="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes</option>
                  <option value="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes</option>
                  <option value="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes</option>
              </optgroup>
          </select>
        </li>
      </ul>
      </div>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      

                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<ol class="chapters">
<li><a href="#5310148244860e6498b3a2c363afaeba0c4427ca">Action Viewについて</a></li>
<li><a href="#4c046a689ff30c03878af3c268082d7167157d1c">Action ViewをRailsで使用する</a></li>
<li>
<a href="#3db206d7611d40ace6d11fef189e839790e6407a">テンプレート、パーシャル、レイアウト</a>

<ul>
<li><a href="#a4929e97f71a23e68be7705fe809b80d1c087b76">テンプレート</a></li>
<li><a href="#bd819b97f67d654240b789d6b8a1f0398b2d59c0">パーシャル</a></li>
<li><a href="#11c1317b4c46e0ab1ab71a0a80d34219b5fc07a1">レイアウト</a></li>
</ul>
</li>
<li><a href="#a5486ef4ebc17b6b38a1cf92d26d8dca5cf34044">パーシャルレイアウト</a></li>
<li><a href="#bf3122c124ac1a0378e1b6c7da5abd8b2d7573bc">ビューのパス</a></li>
<li>
<a href="#a159b69c0b15269ec9acbee6eceae623a4c73901">Action Viewが提供するヘルパーの概要</a>

<ul>
<li><a href="#651aee8da56ac99a0bff4c767003f04e1756d221">RecordTagHelper</a></li>
<li><a href="#4e422102084cf0b63cf0b32ba3f2ac548d6a1ccb">AssetTagHelper</a></li>
<li><a href="#7079ee4fb1d90674cad1ec87e53d9f41d4d9ec63">AtomFeedHelper</a></li>
<li><a href="#61c7d2483623bf49a95324c835eeeea3d896ceed">BenchmarkHelper</a></li>
<li><a href="#9b8082abdebc0e560d5ba3d6d0f5a93f549b2b3d">CacheHelper</a></li>
<li><a href="#082706e64261e155b952b36a3e3df0fa9a672553">CaptureHelper</a></li>
<li><a href="#04c202a6231687ed8bdca25b0d53249ba87ae2c9">DateHelper</a></li>
<li><a href="#a6023a6355a09308dd355ea3bf127f6fa96618f6">DebugHelper</a></li>
<li><a href="#60c7e3bd2a7ae88a97397841cb221353c5893842">FormHelper</a></li>
<li><a href="#2c8e14faa240cc7ef6841b9e737dc4bf9a433878">FormOptionsHelper</a></li>
<li><a href="#8ff66420ce0286ed3e95edc21fb03e009325fed5">FormTagHelper</a></li>
<li><a href="#e79342aa85fd4f1c22498783cd42d8faf5c0f966">JavaScriptHelper</a></li>
<li><a href="#5a4142ed71d8bb3054e10546418ff4a5622d023e">NumberHelper</a></li>
<li><a href="#73df85af0580ef97f23b64c3e4212b856d72f8a5">SanitizeHelper</a></li>
<li><a href="#1508ce4b932cf6c1d431f0262adc6bfad713e0b0">CsrfHelper</a></li>
</ul>
</li>
<li><a href="#eee5e380db3a4ac4756b88f25b92e96446791544">ローカライズされたビュー</a></li>
</ol>
</body></html>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h2>Action Viewの概要</h2>
<p>このガイドの内容:</p>
<ul>
<li>Action Viewの概要とRailsでの利用法</li>
<li>テンプレート、パーシャル(部分テンプレート)、レイアウトの最適な利用法</li>
<li>Action Viewで提供されるヘルパーの紹介と、カスタムヘルパーの作成法</li>
<li>ビューのローカライズ方法</li>
<li>Rails以外の環境でAction Viewを使用する方法</li>
</ul>

<hr>
<h3 id="5310148244860e6498b3a2c363afaeba0c4427ca">1 Action Viewについて</h3>
<p>Action ViewおよびAction Controllerは、Action Packを構成する2大コンポーネントです。Railsでは、WebリクエストはAction Packで取り扱われます。この動作はコントローラ寄りの部分 (ロジックの実行) とビュー寄りの部分(テンプレートの描画) に分かれます。Action Controllerは、データベースとのやりとりや、必要に応じたCRUD (Create/Read/Update/Delete) アクションの実行にかかわります。Action View はその後レスポンスを実際のWebページにまとめる役割を担います。</p>
<p>Action Viewのテンプレートは、HTMLタグの合間にERB (Embedded Ruby) を含む形式で書かれます。ビューテンプレートがコードの繰り返しでうずまって乱雑になるのを避けるために、フォーム・日付・文字列に対して共通の動作を提供するヘルパークラスが多数用意されています。アプリケーションの機能向上に応じて独自のヘルパーを追加することも簡単にできます。</p>
<p>メモ: Action Viewの一部の機能はActive Recordと結びついていますが、Action ViewがActive Recordに依存しているわけではありません。Action Viewは独立したパッケージであり、どのようなRubyライブラリとでも組み合わせて使用できます。</p>
<h3 id="4c046a689ff30c03878af3c268082d7167157d1c">2 Action ViewをRailsで使用する</h3>
<p>アプリケーションの<code>app/views</code>ディレクトリには、1つのコントローラごとに1つのディレクトリが作成され、そこにビューテンプレートファイルが置かれます。このビューテンプレートはそのコントローラと関連付けられています。これらのファイルは、コントローラ内にあるアクションごとに出力された結果をビューで表示するために使用されます。</p>
<p>scaffoldを使用してリソースを生成するときに、Railsがデフォルトでどんなことを行なうのか見てみましょう。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
$ rails generate scaffold post
      [...]
      invoke  scaffold_controller
      create    app/controllers/posts_controller.rb
      invoke    erb
      create      app/views/posts
      create      app/views/posts/index.html.erb
      create      app/views/posts/edit.html.erb
      create      app/views/posts/show.html.erb
      create      app/views/posts/new.html.erb
      create      app/views/posts/_form.html.erb
      [...]

</pre>
</div>
<p>Railsのビューには命名規則があります。上で生成されたファイルを見るとわかるように、ビューテンプレートファイルは基本的にコントローラのアクションと関連付けられています。
たとえば、<code>posts_controller.rb</code>コントローラのindexアクションは、<code>app/views/posts</code>ディレクトリの<code>index.html.erb</code>を使用します。
これらのERBファイルに、それらを内包するレイアウトテンプレートや、ビューから参照されるあらゆるパーシャル (部分テンプレート) が組み合わさって完全なHTMLが生成され、クライアントに送信されます。この後、本ガイドではこれらの3つのコンポーネントについて詳細に説明します。</p>
<h3 id="3db206d7611d40ace6d11fef189e839790e6407a">3 テンプレート、パーシャル、レイアウト</h3>
<p>前述のとおり、Railsが出力する最終的なHTMLは<code>テンプレート</code>、<code>パーシャル</code>、<code>レイアウト</code>の3つの要素です。
まずこれらについて簡単に説明いたします。</p>
<h4 id="a4929e97f71a23e68be7705fe809b80d1c087b76">3.1 テンプレート</h4>
<p>Action Viewのテンプレートはさまざまな方法で記述することができます。テンプレートの拡張子が<code>.erb</code>であれば、ERB (ここにRubyのコードが含まれます) とHTMLが含まれます。テンプレートの拡張子が<code>.builder</code>であれば、<code>Builder::XmlMarkup</code>ライブラリの新鮮なインスタンスが使用されます。</p>
<p>Railsでは複数のテンプレートシステムがサポートされており、テンプレートファイルの拡張子で区別されます。たとえば、ERBテンプレートシステムを使用するHTMLファイルの拡張子は<code>.html.erb</code>になります。</p>
<h5 id="2859d8584ea8c10b85a549c283d13f20ca15f6d8">3.1.1 ERB</h5>
<p>ERBテンプレートの内部では、<code>&lt;% %&gt;</code>タグや<code>&lt;%= %&gt;</code>タグにRubyコードを含めることができます。最初の<code>&lt;% %&gt;</code>タグはその中に書かれたRubyコードを実行しますが、実行結果は出力されません。条件文やループ、ブロックなど出力の不要な行はこのタグの中に書くとよいでしょう。次の<code>&lt;%= %&gt;</code>タグでは実行結果がWebページに出力されます。</p>
<p>以下は、名前を出力するためのループです。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;h1&gt;Names of all the people&lt;/h1&gt;
&lt;% @people.each do |person| %&gt;
  Name: &lt;%= person.name %&gt;&lt;br&gt;
&lt;% end %&gt;

</pre>
</div>
<p>ループの開始行と終了行は通常のERBタグ (<code>&lt;% %&gt;</code>) に書かれており、名前を出力する行は出力用のERBタグ (<code>&lt;%= %&gt;</code>) に書かれています。上のコードは、単にERBの書き方を説明しているだけではありません。Rubyでよく使用される<code>print</code>や<code>puts</code>のような通常の出力関数はERBでは使用できませんのでご注意ください。以下のコードは誤りです。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%# 間違い %&gt;
Hi, Mr. &lt;% puts "Frodo" %&gt;

</pre>
</div>
<p>なお、Webページへの出力結果の最初と最後からホワイトスペースを取り除きたい場合は<code>&lt;%-</code> <code>-%&gt;</code>を通常の<code>&lt;%</code> and <code>%&gt;</code>と交互にご使用ください (訳注: これは英語のようなスペース分かち書きを行なう言語向けのノウハウです)。</p>
<h5 id="30883106ee4c7750dc82f22d4920e55d72094425">3.1.2 Builderテンプレート</h5>
<p>BuilderテンプレートはERBの代わりに使用できる、よりプログラミング向きな記法です。これは特にXMLコンテンツの生成を得意とします。たとえば、<code>xml</code>という名前のXmlMarkupオブジェクトを使用すると、自動的に拡張子<code>.builder</code>のテンプレートが適用されます。</p>
<p>基本的な例を以下にいくつか示します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
xml.em("emphasized")
xml.em { xml.b("emph &amp; bold") }
xml.a("A Link", "href" =&gt; "http://rubyonrails.org")
xml.target("name" =&gt; "compile", "option" =&gt; "fast")

</pre>
</div>
<p>上のコードから以下が生成されます。</p>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;em&gt;emphasized&lt;/em&gt;
&lt;em&gt;&lt;b&gt;emph &amp;amp; bold&lt;/b&gt;&lt;/em&gt;
&lt;a href="http://rubyonrails.org"&gt;A link&lt;/a&gt;
&lt;target option="fast" name="compile" /&gt;

</pre>
</div>
<p>ブロックを後ろに伴うメソッドはすべて、ブロックの中にネストしたマークップを含むXMLマークアップタグとして扱われます。以下の例で示します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
xml.div {
  xml.h1(@person.name)
  xml.p(@person.bio)
}

</pre>
</div>
<p>上のコードの出力は以下のようなものになります。</p>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;div&gt;
  &lt;h1&gt;David Heinemeier Hansson&lt;/h1&gt;
  &lt;p&gt;A product of Danish Design during the Winter of '79...&lt;/p&gt;
&lt;/div&gt;

</pre>
</div>
<p>以下はBasecampで実際に使用されているRSS出力コードをそのまま引用したものです。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
xml.rss("version" =&gt; "2.0", "xmlns:dc" =&gt; "http://purl.org/dc/elements/1.1/") do
  xml.channel do
    xml.title(@feed_title)
    xml.link(@url)
    xml.description "Basecamp: Recent items"
    xml.language "en-us"
    xml.ttl "40"

    for item in @recent_items
      xml.item do
        xml.title(item_title(item))
        xml.description(item_description(item)) if item_description(item)
        xml.pubDate(item_pubDate(item))
        xml.guid(@person.firm.account.url + @recent_items.url(item))
        xml.link(@person.firm.account.url + @recent_items.url(item))
        xml.tag!("dc:creator", item.author_name) if item_has_creator?(item)
      end
    end
  end
end

</pre>
</div>
<h5 id="a89b8dcaa09a46036858377a97a3cdf54d2c1294">3.1.3 テンプレートをキャッシュする</h5>
<p>Railsは、デフォルトですべてのビューテンプレートをコンパイルしてメソッド化し、出力に備えます。developmentモードの場合、ビューテンプレートが変更されるとファイルの日付で変更が検出され、再度コンパイルされます。</p>
<h4 id="bd819b97f67d654240b789d6b8a1f0398b2d59c0">3.2 パーシャル</h4>
<p>部分テンプレートまたはパーシャルは、出力を扱いやすく分割するための仕組みです。パーシャルを使用することで、ビュー内のコードをいくつものファイルに分割して書き出し、他のテンプレートでも使いまわすことができます。</p>
<h5 id="5357c3f16f437ded6a099daf7a57e57087268b16">3.2.1 パーシャルの命名ルール</h5>
<p>パーシャルをビューの一部に含めて出力するには、ビューで<code>render</code>メソッドを使用します。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render "menu" %&gt;

</pre>
</div>
<p>上の呼び出しにより、<code>_menu.html.erb</code>という名前のファイルの内容が、renderメソッドを書いたその場所でレンダリングされます。パーシャルファイル名の冒頭にはアンダースコアが付いていることにご注意ください。これは通常のビューと区別するために付けられています。ただしrenderで呼び出す際にはこのアンダースコアは不要です。以下のように、他のフォルダの下にあるパーシャルを呼び出す際にもアンダースコアは不要です。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render "shared/menu" %&gt;

</pre>
</div>
<p>上のコードでは、<code>app/views/shared/_menu.html.erb</code>パーシャルを読み込んで使用します。</p>
<h5 id="ee1f859bb50f01dde83907cf923c427e51d6936c">3.2.2 パーシャルを活用してビューを簡潔に保つ</h5>
<p>すぐに思い付くパーシャルの使い方といえば、パーシャルをサブルーチンと同等のものとみなすというのがあります。ビューの詳細部分をパーシャルに移動し、コードの見通しを良くするために、たとえば、以下のようなビューがあるとします。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= render "shared/ad_banner" %&gt;

&lt;h1&gt;Products&lt;/h1&gt;

&lt;p&gt;Here are a few of our fine products:&lt;/p&gt;
&lt;% @products.each do |product| %&gt;
  &lt;%= render partial: "product", locals: {product: product} %&gt;
&lt;% end %&gt;

&lt;%= render "shared/footer" %&gt;

</pre>
</div>
<p>上のコードの<code>_ad_banner.html.erb</code>パーシャルと<code>_footer.html.erb</code>パーシャルに含まれるコンテンツは、アプリケーションの多くのページと共有できます。あるページを開発中、パーシャルの部分については詳細を気にせずに済みます。</p>
<h5 id="53b40e09f38cbf9c57b148e2dfab34282caf5e0f">3.2.3 <code>as</code>と<code>object</code>オプション</h5>
<p><code>ActionView::Partials::PartialRenderer</code>は、デフォルトでテンプレートと同じ名前を持つローカル変数の中に自身のオブジェクトを持ちます。以下のコードを見てみましょう。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render partial: "product" %&gt;

</pre>
</div>
<p>上のコードでは、ローカル変数である<code>product</code>の中に<code>@product</code>が置かれます。これは以下のコードと同等の結果になります。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render partial: "product", locals: {product: @product} %&gt;

</pre>
</div>
<p><code>as</code>オプションは、ローカル変数の名前を変更したい場合に使用します。たとえば、ローカル変数を<code>product</code>ではなく<code>item</code>にしたいのであれば、以下のようにします。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render partial: "product", as: "item" %&gt;

</pre>
</div>
<p><code>object</code>オプションは、パーシャルで出力するオブジェクトを直接指定したい場合に使用します。これは、テンプレートのオブジェクトが他の場所 (別のインスタンス変数や別のローカル変数) にある場合に便利です。</p>
<p>たとえば、以下のコードがあるとします。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render partial: "product", locals: {product: @item} %&gt;

</pre>
</div>
<p>上のコードは以下のようになります。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render partial: "product", object: @item %&gt;

</pre>
</div>
<p><code>object</code>オプションと<code>as</code>オプションは同時に使用することもできます。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render partial: "product", object: @item, as: "item" %&gt;

</pre>
</div>
<h5 id="fb840df20ccd53c1d94a439baa8d48505ad00f92">3.2.4 コレクションを出力する</h5>
<p>テンプレート上にコレクションを1つ表示し、サブテンプレートでそのコレクションの要素を1つずつ出力するというのは、よくあるパターンです。このパターンは1つのメソッドだけで実行できます。このメソッドは配列を受け取り、配列内の各要素ごとにパーシャルを出力します。</p>
<p>すべての製品(products)を出力するコード例は以下のようになります。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;% @products.each do |product| %&gt;
  &lt;%= render partial: "product", locals: { product: product } %&gt;
&lt;% end %&gt;

</pre>
</div>
<p>上のコードは以下のように1行で書けます。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render partial: "product", collection: @products %&gt;

</pre>
</div>
<p>パーシャルでこのようにコレクションなどが使用されている場合、パーシャルの各インスタンスは、パーシャル名に基づいた変数を経由して出力されるコレクションのメンバーにアクセスします。このパーシャルは<code>_product</code>という名前なので、<code>product</code>を指定すれば、出力されるインスタンスを取得できます。</p>
<p>コレクション出力には短縮記法があります。<code>@products</code>が<code>Product</code>インスタンスのコレクションであれば、以下のコードでも同じ結果を得られます。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render @products %&gt;

</pre>
</div>
<p>使用されるパーシャル名は、コレクションの中にある「モデル名」を参照して決定されます。この場合のモデル名は<code>Product</code>です。作成するコレクションの各要素が不揃い (訳注: 要素ごとにモデルが異なる場合を指すと考えられる●) であっても、Railsはコレクションのメンバごとに適切なパーシャルを選んで出力してくれます。</p>
<h5 id="5000e2e48a20eaab1b503f4b32e2118a2d118e63">3.2.5 スペーサーテンプレート</h5>
<p><code>:spacer_template</code>オプションを使用すると、主要なパーシャル同士の間を埋める第二のパーシャルを指定することができます。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render partial: @products, spacer_template: "product_ruler" %&gt;

</pre>
</div>
<p>主要な<code>_product</code>パーシャルの合間に、スペーサーとなる<code>_product_ruler</code>パーシャルが出力されます (<code>_product_ruler</code>にはデータは渡していません)。</p>
<h4 id="11c1317b4c46e0ab1ab71a0a80d34219b5fc07a1">3.3 レイアウト</h4>
<p>Railsにおける「レイアウト」は、多くのコントローラのアクションにわたって共通して使用できるテンプレートのことです。Railsアプリケーションには必ず全体用のレイアウトがあり、ほぼすべてのWebページ出力はこの全体レイアウトの内側で行われますが、これが典型的なレイアウトです。たとえば、あるWebサイトにはユーザーログイン用のレイアウトが使用されていたり、別のWebサイトにはマーケティングやセールス用のレイアウトが使用されていたりします。ログインしたユーザー向けのレイアウトであれば、ナビゲーションツールバーをページのトップレベルに表示し、多くのコントローラ/アクションで共通して使用できるようにするでしょう。SaaSアプリケーションにおけるセールス用のレイアウトであれば、トップレベルのナビゲーションに「お値段」や「お問い合わせ先」を共通して表示するでしょう。レイアウトごとに異なる外観を設定してこれらを使い分けることができます。レイアウトの詳細については、<a href="layouts_and_rendering.html">Railsにおけるレイアウトと出力</a> ガイドを参照してください。</p>
<h3 id="a5486ef4ebc17b6b38a1cf92d26d8dca5cf34044">4 パーシャルレイアウト</h3>
<p>パーシャルに独自のレイアウトを適用することができます。パーシャル用のレイアウトは、アクション全体にわたるグローバルなレイアウトとは異なりますが、動作は同じです。</p>
<p>試しに、ページ上に投稿を1つ表示してみましょう。表示制御のため<code>div</code>タグで囲むことにします。最初に、<code>Post</code>を1つ新規作成します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Post.create(body: 'Partial Layouts are cool!')

</pre>
</div>
<p><code>show</code>テンプレートは、<code>box</code>レイアウトに内包された<code>_post</code>パーシャルを出力します。</p>
<p><strong>posts/show.html.erb</strong></p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render partial: 'post', layout: 'box', locals: {post: @post} %&gt;

</pre>
</div>
<p>その<code>box</code>レイアウトは、<code>div</code>タグの中に<code>_post</code>パーシャルを内包した簡単な構造です。</p>
<p><strong>posts/_box.html.erb</strong></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;div class='box'&gt;
  &lt;%= yield %&gt;
&lt;/div&gt;

</pre>
</div>
<p>その<code>_post</code>パーシャルは、投稿の本文(<code>body</code>)を<code>div</code>タグに内包し、<code>div_for</code>を使用して投稿の<code>id</code>を与えます。●</p>
<p><strong>posts/_post.html.erb</strong></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= div_for(post) do %&gt;
  &lt;p&gt;&lt;%= post.body %&gt;&lt;/p&gt;
&lt;% end %&gt;

</pre>
</div>
<p>上のコードの出力は以下のようになります。</p>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;div class='box'&gt;
  &lt;div id='post_1'&gt;
    &lt;p&gt;Partial Layouts are cool!&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;

</pre>
</div>
<p>このパーシャルレイアウトは、<code>render</code>呼び出しに渡されたローカルの<code>post</code>変数にアクセスできる点にご注目ください。ただし、アプリケーション全体で共通のレイアウトとは異なり、パーシャルレイアウトのファイル名冒頭にはアンダースコアが必要です。</p>
<p><code>yield</code>を呼び出す代わりに、パーシャルレイアウト内にあるコードのブロックを出力することもできます。たとえば、<code>_post</code>というパーシャルがない場合でも、以下のような呼び出しが行えます。</p>
<p><strong>posts/show.html.erb</strong></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;% render(layout: 'box', locals: {post: @post}) do %&gt;
  &lt;%= div_for(post) do %&gt;
    &lt;p&gt;&lt;%= post.body %&gt;&lt;/p&gt;
  &lt;% end %&gt;
&lt;% end %&gt;

</pre>
</div>
<p>ここでは、同じ<code>_box</code>パーシャルを使用する前提であり、先の例と同じ出力が得られます。</p>
<h3 id="bf3122c124ac1a0378e1b6c7da5abd8b2d7573bc">5 ビューのパス</h3>
<p>(執筆予定)</p>
<h3 id="a159b69c0b15269ec9acbee6eceae623a4c73901">6 Action Viewが提供するヘルパーの概要</h3>
<p>執筆メモ: このリストにまだ含まれていないヘルパーがあります。完全なリストについては<a href="http://api.rubyonrails.org/classes/ActionView/Helpers.html">APIドキュメント</a>を参照してください。</p>
<p>Action Viewで利用できるヘルパーの概要を以下に示します。<a href="http://api.rubyonrails.org/classes/ActionView/Helpers.html">APIドキュメント</a> も参照して調べ直すことをお勧めします。APIドキュメントにはすべてのヘルパーの詳細が記載されており、本ガイドは概要を把握するためのものです。</p>
<h4 id="651aee8da56ac99a0bff4c767003f04e1756d221">6.1 RecordTagHelper</h4>
<p>このモジュールは、<code>div</code>などのコンテナタグを生成するメソッドを提供します。Active Recordオブジェクトを出力するためのコンテナ作成方法にはこれを使うことをお勧めします。この方法であれば、適切なクラスとid属性がコンテナに追加されるからです。これにより、これらのコンテナを通常の方法で簡単に参照でき、どのクラスやどのid属性を使用すべきかどうかを考えずに済みます。</p>
<h5 id="2cf91c87f84b1d34274090cff36a14c2024d275a">6.1.1 content_tag_for</h5>
<p>Active Recordオブジェクトに関連付けられるコンテナタグを出力します。</p>
<p>たとえば、<code>@post</code>が<code>Post</code>クラスのオブジェクトであれば、以下のように書くことができます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= content_tag_for(:tr, @post) do %&gt;
  &lt;td&gt;&lt;%= @post.title %&gt;&lt;/td&gt;
&lt;% end %&gt;

</pre>
</div>
<p>上のコードによって以下のHTMLが生成されます。</p>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;tr id="post_1234" class="post"&gt;
  &lt;td&gt;Hello World!&lt;/td&gt;
&lt;/tr&gt;

</pre>
</div>
<p>オプションのハッシュを追加することで、HTML属性を指定することもできます。例：</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= content_tag_for(:tr, @post, class: "frontpage") do %&gt;
  &lt;td&gt;&lt;%= @post.title %&gt;&lt;/td&gt;
&lt;% end %&gt;

</pre>
</div>
<p>上のコードによって以下のHTMLが生成されます。</p>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;tr id="post_1234" class="post frontpage"&gt;
  &lt;td&gt;Hello World!&lt;/td&gt;
&lt;/tr&gt;

</pre>
</div>
<p>Active Recordオブジェクトのコレクションを渡すこともできます。このメソッドはオブジェクトをループで回してそれぞれについてコンテナを作成します。たとえば、<code>@posts</code>は<code>Post</code>オブジェクトを2つ含む配列であるとします。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= content_tag_for(:tr, @posts) do |post| %&gt;
  &lt;td&gt;&lt;%= post.title %&gt;&lt;/td&gt;
&lt;% end %&gt;

</pre>
</div>
<p>上のコードによって以下のHTMLが生成されます。</p>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;tr id="post_1234" class="post"&gt;
  &lt;td&gt;Hello World!&lt;/td&gt;
&lt;/tr&gt;
&lt;tr id="post_1235" class="post"&gt;
  &lt;td&gt;Ruby on Rails Rocks!&lt;/td&gt;
&lt;/tr&gt;

</pre>
</div>
<h5 id="86258f149ef7bd32d29f233678cc5e183af2e00e">6.1.2 div_for</h5>
<p>このメソッドは内部で<code>content_tag_for</code>を呼び出して<code>:div</code>をタグ名にしてくれる、便利なメソッドです。Active Recordオブジェクトを単体またはコレクションとして渡すことができます。例：</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= div_for(@post, class: "frontpage") do %&gt;
  &lt;td&gt;&lt;%= @post.title %&gt;&lt;/td&gt;
&lt;% end %&gt;

</pre>
</div>
<p>上のコードによって以下のHTMLが生成されます。</p>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;div id="post_1234" class="post frontpage"&gt;
  &lt;td&gt;Hello World!&lt;/td&gt;
&lt;/div&gt;

</pre>
</div>
<h4 id="4e422102084cf0b63cf0b32ba3f2ac548d6a1ccb">6.2 AssetTagHelper</h4>
<p>このモジュールは、画像・JavaScriptファイル・スタイルシート・フィードなどのアセットにビューをリンクするHTMLを生成するメソッドを提供します。</p>
<p>デフォルトでは、現在ホストされているpublicフォルダ内のアセットに対してリンクしますが、アプリケーション設定 (通常は<code>config/environments/production.rb</code>) の<code>config.action_controller.asset_host</code>で設定されているアセット用サーバーにリンクすることもできます。たとえば、<code>assets.example.com</code>というアセット専用ホストを使用したいとします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
config.action_controller.asset_host = "assets.example.com"
image_tag("rails.png") # =&gt; &lt;img src="http://assets.example.com/images/rails.png" alt="Rails" /&gt;

</pre>
</div>
<h5 id="ca41f18a8e5dd27979392ca47c51ffaefd54452a">6.2.1 register_javascript_expansion</h5>
<p>javascript_include_tagにシンボルを渡すことで、インクルードしたいJavaScriptファイルを1つまたは複数登録できます。このメソッドの主な目的は、プラグインの初期化中に、プラグインによって<code>vendor/assets/javascripts</code>にインストールされたJavaScriptファイルを登録することです。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
ActionView::Helpers::AssetTagHelper.register_javascript_expansion monkey: ["head", "body", "tail"]

javascript_include_tag :monkey # =&gt;
  &lt;script src="/assets/head.js"&gt;&lt;/script&gt;
  &lt;script src="/assets/body.js"&gt;&lt;/script&gt;
  &lt;script src="/assets/tail.js"&gt;&lt;/script&gt;

</pre>
</div>
<h5 id="57cae635a5d3fa780d57ecd208b4b52a2d557c05">6.2.2 register_stylesheet_expansion</h5>
<p>javascript_include_tagにシンボルを渡すことで、インクルードしたいスタイルシートファイルを1つまたは複数登録できます。このメソッドの主な目的は、プラグインの初期化中に、プラグインによって<code>vendor/assets/stylesheets</code>にインストールされたスタイルシートファイルを登録することです。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
ActionView::Helpers::AssetTagHelper.register_stylesheet_expansion monkey: ["head", "body", "tail"]

stylesheet_link_tag :monkey # =&gt;
  &lt;link href="/assets/head.css" media="screen" rel="stylesheet" /&gt;
  &lt;link href="/assets/body.css" media="screen" rel="stylesheet" /&gt;
  &lt;link href="/assets/tail.css" media="screen" rel="stylesheet" /&gt;

</pre>
</div>
<h5 id="73b6cbb9d94f8b97d67d0d884f2a9edf539e0732">6.2.3 auto_discovery_link_tag</h5>
<p>ブラウザやフィードリーダーが検出可能なRSSフィードやAtomフィードのリンクタグを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
auto_discovery_link_tag(:rss, "http://www.example.com/feed.rss", {title: "RSS Feed"}) # =&gt;
  &lt;link rel="alternate" type="application/rss+xml" title="RSS Feed" href="http://www.example.com/feed" /&gt;

</pre>
</div>
<h5 id="f03b89f33671086e6733828e79c2dc44ad1df37d">6.2.4 image_path</h5>
<p><code>app/assets/images</code>に置かれている画像アセットへのパスを算出します。ドキュメントルート・ディレクトリからの完全なパスが返されます。このメソッドの内部では画像へのパス作成に<code>image_tag</code>が使用されています。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
image_path("edit.png") # =&gt; /assets/edit.png

</pre>
</div>
<p>config.assets.digestがtrueに設定されている場合、ファイル名にフィンガープリントが追加されます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
image_path("edit.png") # =&gt; /assets/edit-2d1a2db63fc738690021fedb5a65b68e.png

</pre>
</div>
<h5 id="602959dc3010ff4b4805ee7f1042c44549912ee8">6.2.5 image_url</h5>
<p><code>app/assets/images</code>に置かれている画像アセットへのURLを算出します。このメソッドは内部で<code>image_path</code>を呼び出しており、現在のホストまたはアセット用のホストとマージしてURLを生成します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
image_url("edit.png") # =&gt; http://www.example.com/assets/edit.png

</pre>
</div>
<h5 id="22e7c2bdbaca18bf0acbacea9900e39668d0b313">6.2.6 image_tag</h5>
<p>HTML imgタグを返します。画像へのフルパス、または<code>app/assets/images</code>ディレクトリ内にあるファイルを引数として与えられます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
image_tag("icon.png") # =&gt; &lt;img src="/assets/icon.png" alt="Icon" /&gt;

</pre>
</div>
<h5 id="6ab6c4cc97f33fd197fa946c67981e37307eb23f">6.2.7 javascript_include_tag</h5>
<p>引数に与えられたソースごとにHTML scriptタグを返します。<code>app/assets/javascripts</code>ディレクトリにあるJavaScriptファイル名 (拡張子<code>.js</code>はあってもなくても構いません) を引数として渡すことができます。この結果は現在のページにインクルードされます。ドキュメントルートからの相対完全パスを渡すこともできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
javascript_include_tag "common" # =&gt; &lt;script src="/assets/common.js"&gt;&lt;/script&gt;

</pre>
</div>
<p>アプリケーションでアセットパイプラインを使用せずにjQuery JavaScriptライブラリをインクルードする場合は、ソースとして<code>:defaults</code>を渡してください。<code>:defaults</code>を指定した場合、<code>app/assets/javascripts</code>ディレクトリに<code>application.js</code>というファイルがあればこれもインクルードされます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
javascript_include_tag :defaults

</pre>
</div>
<p>ソースに<code>:all</code>を指定すると、<code>app/assets/javascripts</code>ディレクトリ以下にあるJavaScriptファイルをすべてインクルードできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
javascript_include_tag :all

</pre>
</div>
<p>複数のJavaScriptファイルをキャッシュして1つのファイルにすることができます。こうすることでJavaScriptファイルのダウンロードに必要なHTTP接続数を減らすことができ、速度が向上します。gzip圧縮すればさらに転送が速くなります。キャッシュが有効になるのは、<code>ActionController::Base.perform_caching</code>をtrueに設定した場合のみです。production環境ではデフォルトでtrueになりますが、development環境ではデフォルトではtrueになりません。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
javascript_include_tag :all, cache: true # =&gt;
  &lt;script src="/javascripts/all.js"&gt;&lt;/script&gt;

</pre>
</div>
<h5 id="79419ec009c9279dc13d4ece2ecbe4f359d98b2d">6.2.8 javascript_path</h5>
<p><code>app/assets/javascripts</code>に置かれているJavaScriptアセットへのパスを算出します。ソースのファイル名に拡張子<code>.js</code>がない場合は自動的に補われます。ドキュメントルート・ディレクトリからの完全なパスが返されます。スクリプトパス作成のために内部で<code>javascript_include_tag</code>が使用されています。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
javascript_path "common" # =&gt; /assets/common.js

</pre>
</div>
<h5 id="60aa05dad85259c2017e539423eea27b2ba6d429">6.2.9 javascript_url</h5>
<p><code>app/assets/javascripts</code>に置かれているJavaScriptアセットへのURLを算出します。このメソッドは内部で<code>javascript_path</code>を呼び出しており、現在のホストまたはアセット用のホストとマージしてURLを生成します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
javascript_url "common" # =&gt; http://www.example.com/assets/common.js

</pre>
</div>
<h5 id="fb2f38ca1fca0a5d584878d702b13212f0c25f63">6.2.10 stylesheet_link_tag</h5>
<p>引数として指定されたソースにあるスタイルシートへのリンクタグを返します。拡張子が指定されていない場合は、<code>.css</code>が自動的に補われます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
stylesheet_link_tag "application" # =&gt; &lt;link href="/assets/application.css" media="screen" rel="stylesheet" /&gt;

</pre>
</div>
<p>ソースに<code>:all</code>を指定すると、stylesheetディレクトリにあるすべてのスタイルシートを含めることができます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
stylesheet_link_tag :all

</pre>
</div>
<p>複数のスタイルシートファイルをキャッシュして1つのファイルにすることができます。こうすることでスタイルシートファイルのダウンロードに必要なHTTP接続数を減らすことができ、速度が向上します。gzip圧縮すればさらに転送が速くなります。キャッシュが有効になるのは、<code>ActionController::Base.perform_caching</code>をtrueに設定した場合のみです。production環境ではデフォルトでtrueになりますが、development環境ではデフォルトではtrueになりません。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
stylesheet_link_tag :all, cache: true
# =&gt; &lt;link href="/assets/all.css" media="screen" rel="stylesheet" /&gt;

</pre>
</div>
<h5 id="1b680f84151ab624b145c803ea7042e8e8732d79">6.2.11 stylesheet_path</h5>
<p><code>app/assets/stylesheets</code>に置かれているスタイルシートアセットへのパスを算出します。ソースのファイル名に拡張子<code>.css</code>がない場合は自動的に補われます。ドキュメントルート・ディレクトリからの完全なパスが返されます。このメソッドの内部ではスタイルシートへのパス作成に<code>stylesheet_link_tag</code>が使用されています。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
stylesheet_path "application" # =&gt; /assets/application.css

</pre>
</div>
<h5 id="c1391add668bf934b2c5fce20556e69a19c1d2eb">6.2.12 stylesheet_url</h5>
<p><code>app/assets/stylesheets</code>に置かれているスタイルシートアセットへのURLを算出します。このメソッドは内部で<code>stylesheet_path</code>を呼び出しており、現在のホストまたはアセット用のホストとマージしてURLを生成します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
stylesheet_url "application" # =&gt; http://www.example.com/assets/application.css

</pre>
</div>
<h4 id="7079ee4fb1d90674cad1ec87e53d9f41d4d9ec63">6.3 AtomFeedHelper</h4>
<h5 id="58d944e8adc79da6154123d24a5e2f59cfc54f3a">6.3.1 atom_feed</h5>
<p>このヘルパーを使用して、Atomフィードを簡単に生成できます。以下にすべての使用例を示します。</p>
<p><strong>config/routes.rb</strong></p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :posts

</pre>
</div>
<p><strong>app/controllers/posts_controller.rb</strong></p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def index
  @posts = Post.all

respond_to do |format|
    format.html
    format.atom
  end
end

</pre>
</div>
<p><strong>app/views/posts/index.atom.builder</strong></p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
atom_feed do |feed|
  feed.title("Posts Index")
  feed.updated((@posts.first.created_at))

  @posts.each do |post|
    feed.entry(post) do |entry|
      entry.title(post.title)
      entry.content(post.body, type: 'html')

      entry.author do |author|
        author.name(post.author_name)
      end
    end
  end
end

</pre>
</div>
<h4 id="61c7d2483623bf49a95324c835eeeea3d896ceed">6.4 BenchmarkHelper</h4>
<h5 id="fc38e4aeb7a5b66c5616d1fa21a41af646fb7594">6.4.1 benchmark</h5>
<p>テンプレート内の1つのブロックの実行時間測定と、結果のログ出力に使用します。実行に時間のかかる行や、ボトルネックになる可能性のある行をこのブロックで囲み、実行にかかった時間を読み取ります。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;% benchmark "Process data files" do %&gt;
  &lt;%= expensive_files_operation %&gt;
&lt;% end %&gt;

</pre>
</div>
<p>上のコードは、"Process data files (0.34523)"のようなログを出力します。このログは、コード最適化のためにタイミングを比較する際に役立てることができます。</p>
<h4 id="9b8082abdebc0e560d5ba3d6d0f5a93f549b2b3d">6.5 CacheHelper</h4>
<h5 id="b03592806efabfeeb709f5a70a7c172669b00538">6.5.1 cache</h5>
<p><code>cache</code>メソッドは、(アクション全体やページ全体ではなく) ビューの断片をキャッシュするメソッドです。この手法は、メニュー・ニュース記事・静的HTMLの断片などをキャッシュするのに便利です。このメソッドには、キャッシュしたいコンテンツを1つのブロックに含めて引数として渡します。詳細については、<code>ActionController::Caching::Fragments</code>を参照してください。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;% cache do %&gt;
  &lt;%= render "shared/footer" %&gt;
&lt;% end %&gt;

</pre>
</div>
<h4 id="082706e64261e155b952b36a3e3df0fa9a672553">6.6 CaptureHelper</h4>
<h5 id="fbc259d1f78c5cc26c64e0bfd6c19ff56bd84a7f">6.6.1 capture</h5>
<p><code>capture</code>メソッドを使用することで、テンプレートの一部を変数に保存することができます。保存された変数は、テンプレートやレイアウトのどんな場所でも自由に使用できます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;% @greeting = capture do %&gt;
  &lt;p&gt;Welcome! The date and time is &lt;%= Time.now %&gt;&lt;/p&gt;
&lt;% end %&gt;

</pre>
</div>
<p>上でキャプチャした変数は以下のように他の場所で自由に使用できます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Welcome!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;%= @greeting %&gt;
  &lt;/body&gt;
&lt;/html&gt;

</pre>
</div>
<h5 id="96c3807afed712b7cf0ab56e0cda5de17e00025c">6.6.2 content_for</h5>
<p><code>content_for</code>を呼び出すと、後の利用に備えて、idに対応するマークアップのブロックが保存されます。●以後、保存されたコンテンツを他のテンプレートやレイアウトで呼び出すことができます。呼び出しの際には、<code>yield</code>の引数となるidを渡します。●</p>
<p>たとえば、あるRailsアプリケーション全体にわたって標準のアプリケーションレイアウトを使用しているが、特定のページでのみ特定のJavaScriptコードが必要となり、他のページではこのJavaScriptはまったく不要であるとします。このようなときには<code>content_for</code>を使用します。これにより、そのJavaScriptコードを特定のページにだけインクルードし、サイトの他の部分でインクルードされることのないようにできます。</p>
<p><strong>app/views/layouts/application.html.erb</strong></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Welcome!&lt;/title&gt;
    &lt;%= yield :special_script %&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;Welcome! The date and time is &lt;%= Time.now %&gt;&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;

</pre>
</div>
<p><strong>app/views/posts/special.html.erb</strong></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;p&gt;This is a special page.&lt;/p&gt;

&lt;% content_for :special_script do %&gt;
  &lt;script&gt;alert('Hello!')&lt;/script&gt;
&lt;% end %&gt;

</pre>
</div>
<h4 id="04c202a6231687ed8bdca25b0d53249ba87ae2c9">6.7 DateHelper</h4>
<h5 id="fb12b8fa03be34cb40b0423e0f0cc21717cbed03">6.7.1 date_select</h5>
<p>日付用のselectタグのセットを返します。タグは年・月・日用にそれぞれあり、日付に関する特定の属性にアクセスして年月日を選択済みの状態にします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
date_select("post", "published_on")

</pre>
</div>
<h5 id="0ce953cddcea36a63bf8278b19ea91289e419ac5">6.7.2 datetime_select</h5>
<p>日付・時刻用のselectタグのセットを返します。タグは年・月・日・時・分用にそれぞれあり、日付・時刻に関する特定の属性にアクセスして日時が選択済みになります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
datetime_select("post", "published_on")

</pre>
</div>
<h5 id="bc2d6ae381861f4125e45deeb02e9f8ab1f809b9">6.7.3 distance_of_time_in_words</h5>
<p>TimeオブジェクトやDateオブジェクト、秒を表す整数同士を比較して近似表現を返します。<code>include_seconds</code>をtrueにすると、より詳細な差を得られます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
distance_of_time_in_words(Time.now, Time.now + 15.seconds)        # =&gt; less than a minute
distance_of_time_in_words(Time.now, Time.now + 15.seconds, include_seconds: true)  # =&gt; less than 20 seconds

</pre>
</div>
<h5 id="95b1ea3d236af452822394f9df4a9c4a809e25e1">6.7.4 select_date</h5>
<p>日付用のselectタグのセットを返します。タグは年・月・日用にそれぞれあり、<code>date</code>で得られる値で選択済みの状態にします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# 指定された日付 (ここでは本日から6日後) をデフォルト値とする日付セレクトボックスを生成する
select_date(Time.today + 6.days)

# 日付の指定がない場合、本日をデフォルト値とする日付セレクトボックスを生成する
select_date()

</pre>
</div>
<h5 id="70e658d8cf59c70eb186d1958eb4f66b7c811e39">6.7.5 select_datetime</h5>
<p>日付・時刻用のselectタグのセットを返します。タグは年・月・日・時・分用にそれぞれあり、<code>datetime</code>で得られる値で選択済みの状態にします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# 指定された日時 (ここでは本日から4日後) をデフォルト値とする日時セレクトボックスを生成する
select_datetime(Time.now + 4.days)

# 日時の指定がない場合、本日をデフォルト値とする日時セレクトボックスを生成する
select_datetime()

</pre>
</div>
<h5 id="1d4c0d756c36fe68932c65141bc7ea15f63d985d">6.7.6 select_day</h5>
<p>1から31までの日付をオプションに持ち、当日が選択されているselectタグを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# 指定された日付をデフォルト値に持つセレクトボックスを生成する
select_day(Time.today + 2.days)

# 指定された数値をデフォルトの日付として持つセレクトボックスを生成する
select_day(5)

</pre>
</div>
<h5 id="3578e2a098d1750856d1bd6ea1a202ddad3d55a3">6.7.7 select_hour</h5>
<p>0から23までの時をオプションに持ち、現在時刻が選択されているselectタグを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# 指定された時をデフォルト値として持つセレクトボックスを生成する
select_hour(Time.now + 6.hours)

</pre>
</div>
<h5 id="f0d446065ccfc8bfcd535e93f4cb8bff65d4020a">6.7.8 select_minute</h5>
<p>0から59までの分をオプションに持ち、現在時刻の分が選択されているselectタグを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# 指定された分をデフォルト値として持つセレクトボックスを生成する●以下の例が時の場合のままになっている
select_minute(Time.now + 6.hours)

</pre>
</div>
<h5 id="c18f495b29de7c340e62d0a5072b2efd1749fad3">6.7.9 select_month</h5>
<p>JanuaryからDecemberまでの月をオプションに持ち、現在の月が選択されているselectタグを返します(訳注: 日本語環境では1月から12月が表示されます)。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# 現在の月をデフォルト値に持つセレクトボックスを生成する
select_month(Date.today)

</pre>
</div>
<h5 id="aab86976037c7d98ce351a285f6564b0e0b31bd5">6.7.10 select_second</h5>
<p>0から59までの秒をオプションに持ち、現在時刻の秒が選択されているselectタグを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# 指定の秒を現在時刻に加えた値をデフォルト値に持つ秒用のセレクトボックスを生成する
select_second(Time.now + 16.minutes)

</pre>
</div>
<h5 id="bb2ad8c0f5632865a20c252530078aebde0faa84">6.7.11 select_time</h5>
<p>時刻用のselectタグのセットを返します。タグは時・分用にそれぞれあります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# 現在時刻をデフォルト値に持つ時刻セレクトボックスを生成する
select_time(Time.now)

</pre>
</div>
<h5 id="bddadbfa738b6f6ba495ea3f13a631c5c72fc761">6.7.12 select_year</h5>
<p>当年を含む直近の5つの年をオプションに持ち、当年がデフォルトとして選択されているselectタグを返します。<code>:start_year</code>キーと<code>:end_year</code>キーを<code>options</code>に設定することで、デフォルトの5年を変更できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# 今年をデフォルト値に持ち、Date.todayで得られた日の前後5年をオプションに持つセレクトボックスを生成する
select_year(Date.today)

# 今年をデフォルト値に持ち、1900年から2009年までをオプションに持つセレクトボックスを生成する
select_year(Date.today, start_year: 1900, end_year: 2009)

</pre>
</div>
<h5 id="0bf622c254a393de5b4b5603f2ceb6514b2bf484">6.7.13 time_ago_in_words</h5>
<p><code>distance_of_time_in_words</code>と基本的に同じ動作であり、<code>to_time</code>の部分が<code>Time.now</code>に固定されている点だけが異なります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
time_ago_in_words(3.minutes.from_now)  # =&gt; 3分

</pre>
</div>
<h5 id="6ad4dd6808bfccf057f7f65c64e1826f4e32c140">6.7.14 time_select</h5>
<p>時刻用のselectタグのセットを返します。タグは時・分用の他にオプションで秒もあります。時刻に関する特定の属性にアクセスして日時が選択済みになります。このタグで選択された項目は、Active Recordオブジェクトにマルチパラメータとして割り当て可能な形式になります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# 時刻選択用タグを作成する。フォームがPOSTされると、submitted属性のorder変数が保存される。
time_select("order", "submitted")

</pre>
</div>
<h4 id="a6023a6355a09308dd355ea3bf127f6fa96618f6">6.8 DebugHelper</h4>
<p>YAMLからダンプしたオブジェクトを含む<code>pre</code>タグを返します。これを利用することで、オブジェクトの内容が非常に読みやすくなります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
my_hash = {'first' =&gt; 1, 'second' =&gt; 'two', 'third' =&gt; [1,2,3]}
debug(my_hash)

</pre>
</div>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;pre class='debug_dump'&gt;---
first: 1
second: two 
third:
- 1
- 2
- 3
&lt;/pre&gt;

</pre>
</div>
<h4 id="60c7e3bd2a7ae88a97397841cb221353c5893842">6.9 FormHelper</h4>
<p>フォームヘルパーを使用すると、標準のHTML要素だけを使用するよりもはるかに容易に、モデルと連携動作するフォームを作成することができます。Formヘルパーはフォーム用のHTMLを生成し、テキストやパスワードといった入力の種類に応じたメソッドを提供します。(送信ボタンがクリックされたり、JavaScriptでform.submitを呼び出すなどして) フォームが送信されると、フォームの入力内容はparamsオブジェクトにまとめて保存され、コントローラに渡されます。</p>
<p>フォームヘルパーは、モデル属性の操作に特化したものと、より一般的なものの2種類に分類できます。ここではモデル属性の扱いに特化したものについて説明します。モデル属性に特化していない一般的なフォームヘルパーについては、ActionView::Helpers::FormTagHelperのドキュメントを参照してください。</p>
<p>ここで扱うフォームヘルパーの中心となるメソッドはform_forです。このメソッドはモデルのインスタンスからフォームを作成することができます。たとえば、以下のようにPersonというモデルがあり、このモデルをもとにしてインスタンスを1つ作成するとします。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
# メモ: a @person変数はコントローラ側で設定済みであるとする (@person = Person.newなど)
&lt;%= form_for @person, url: {action: "create"} do |f| %&gt;
  &lt;%= f.text_field :first_name %&gt;
  &lt;%= f.text_field :last_name %&gt;
  &lt;%= submit_tag 'Create' %&gt;
&lt;% end %&gt;

</pre>
</div>
<p>上のコードによって生成されるHTMLは以下のようになります。</p>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;form action="/people/create" method="post"&gt;
  &lt;input id="person_first_name" name="person[first_name]" type="text" /&gt;
  &lt;input id="person_last_name" name="person[last_name]" type="text" /&gt;
  &lt;input name="commit" type="submit" value="Create" /&gt;
&lt;/form&gt;

</pre>
</div>
<p>上のフォームが送信される時に作成されるparamsオブジェクトは以下のようになります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{"action" =&gt; "create", "controller" =&gt; "people", "person" =&gt; {"first_name" =&gt; "William", "last_name" =&gt; "Smith"}}

</pre>
</div>
<p>上のparamsハッシュには、Personモデル用の値がネストした形で含まれているので、コントローラで<code>params[:person]</code>と書くことで内容にアクセスできます。</p>
<h5 id="8086264325a10d807c143cfb981abab4380a8f34">6.9.1 check_box</h5>
<p>指定された属性にアクセスするためのチェックボックスタグを生成します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# @post.validated?が1の場合
check_box("post", "validated")
# =&gt; &lt;input type="checkbox" id="post_validated" name="post[validated]" value="1" /&gt;
#    &lt;input name="post[validated]" type="hidden" value="0" /&gt;

</pre>
</div>
<h5 id="cba5a45118e51a8f2f814c3bb393541993858f38">6.9.2 fields_for</h5>
<p>form_forのような特定のモデルオブジェクトの外側にスコープを作成しますが、フォームタグ自体は作成しません。このため、fields_forは同じフォームに別のモデルオブジェクトを追加するのに向いています。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= form_for @person, url: {action: "update"} do |person_form| %&gt;
  First name: &lt;%= person_form.text_field :first_name %&gt; 
  Last name : &lt;%= person_form.text_field :last_name %&gt;

  &lt;%= fields_for @person.permission do |permission_fields| %&gt;
    Admin?  : &lt;%= permission_fields.check_box :admin %&gt;
&lt;% end %&gt;
&lt;% end %&gt;

</pre>
</div>
<h5 id="fb2f6f5c63ef616b8a42d6873d3b0496cf0f1a54">6.9.3 file_field</h5>
<p>特定の属性にアクセスするための、ファイルアップロード用inputタグを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
file_field(:user, :avatar)
# =&gt; &lt;input type="file" id="user_avatar" name="user[avatar]" /&gt;

</pre>
</div>
<h5 id="7690130aa7b19394100049cc68805e38d26b76a8">6.9.4 form_for</h5>
<p>フィールドにどのような値があるかを問い合わせるのに使用される、特定のモデルオブジェクトの外側にフォームを1つとスコープを1つ作成します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= form_for @post do |f| %&gt;
  &lt;%= f.label :title, 'Title' %&gt;:
  &lt;%= f.text_field :title %&gt;&lt;br&gt;
  &lt;%= f.label :body, 'Body' %&gt;:
  &lt;%= f.text_area :body %&gt;&lt;br&gt;
&lt;% end %&gt;

</pre>
</div>
<h5 id="993a8fd75a86479d5a3c4e289b9c68e6c9c36921">6.9.5 hidden_field</h5>
<p>特定の属性にアクセスするための、隠されたinputタグを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
hidden_field(:user, :token)
# =&gt; &lt;input type="hidden" id="user_token" name="user[token]" value="#{@user.token}" /&gt;

</pre>
</div>
<h5 id="64c65374dbab6fe3762748196d9d3a9610e2e5a9">6.9.6 label</h5>
<p>特定の属性用のinputフィールドに与えるラベルを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
label(:post, :title)
# =&gt; &lt;label for="post_title"&gt;Title&lt;/label&gt;

</pre>
</div>
<h5 id="264127ba3f048eae7033442e65f60c2589c28658">6.9.7 password_field</h5>
<p>特定の属性にアクセスするための、種類が"password"のinputタグを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
password_field(:login, :pass)
# =&gt; &lt;input type="text" id="login_pass" name="login[pass]" value="#{@login.pass}" /&gt;

</pre>
</div>
<h5 id="9c9f8f86610f456edaa3a3342034f5dddd3b6053">6.9.8 radio_button</h5>
<p>特定の属性にアクセスするためのラジオボタンタグを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# @post.categoryが"rails"を返す場合
radio_button("post", "category", "rails")
radio_button("post", "category", "java")
# =&gt; &lt;input type="radio" id="post_category_rails" name="post[category]" value="rails" checked="checked" /&gt;
#    &lt;input type="radio" id="post_category_java" name="post[category]" value="java" /&gt;

</pre>
</div>
<h5 id="4509ef41c2aa218cba7e118d8f3c01fd727856d6">6.9.9 text_area</h5>
<p>特定の属性にアクセスするための、テキストエリア用開始タグと終了タグを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
text_area(:comment, :text, size: "20x30")
# =&gt; &lt;textarea cols="20" rows="30" id="comment_text" name="comment[text]"&gt;
#      #{@comment.text}
#    &lt;/textarea&gt;

</pre>
</div>
<h5 id="1275733d05a80851fb02104d09665d77104c7839">6.9.10 text_field</h5>
<p>特定の属性にアクセスするための、種類が"text"のinputタグを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
text_field(:post, :title)
# =&gt; &lt;input type="text" id="post_title" name="post[title]" value="#{@post.title}" /&gt;

</pre>
</div>
<h5 id="f502b91100e50cc022ce1ef4b3edd72cbd0315fe">6.9.11 email_field</h5>
<p>特定の属性にアクセスするための、種類が"email"のinputタグを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
email_field(:user, :email)
# =&gt; &lt;input type="email" id="user_email" name="user[email]" value="#{@user.email}" /&gt;

</pre>
</div>
<h5 id="12142ec603ee8ff9fde34a49aa6c1410847b69b2">6.9.12 url_field</h5>
<p>特定の属性にアクセスするための、種類が"url"のinputタグを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
url_field(:user, :url)
# =&gt; &lt;input type="url" id="user_url" name="user[url]" value="#{@user.url}" /&gt;

</pre>
</div>
<h4 id="2c8e14faa240cc7ef6841b9e737dc4bf9a433878">6.10 FormOptionsHelper</h4>
<p>さまざまな種類のコンテナを1つのオプションタグのセットにまとめるためのメソッドを多数提供します。</p>
<h5 id="7387827d316df2c08f22c8383637375ce6ff4781">6.10.1 collection_select</h5>
<p><code>select</code>タグと、<code>object</code>が属するクラスのメソッド値の既存の返り値をコレクションにした<code>option</code>タグを返します。</p>
<p>例として、このメソッドを適用するオブジェクトの構造が以下のようになっているとします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Post &lt; ActiveRecord::Base
  belongs_to :author
end

class Author &lt; ActiveRecord::Base
  has_many :posts
  def name_with_initial
    "#{first_name.first}. #{last_name}"
  end
end

</pre>
</div>
<p>利用法は、たとえば以下のようになります。ここでは、Postモデルのインスタンスである<code>@post</code>に関連付けられているAuthorモデルから選択肢を取り出しています。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
collection_select(:post, :author_id, Author.all, :id, :name_with_initial, {prompt: true})

</pre>
</div>
<p><code>@post.author_id</code>が1の場合、以下が返されます。</p>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;select name="post[author_id]"&gt;
  &lt;option value=""&gt;Please select&lt;/option&gt;
  &lt;option value="1" selected="selected"&gt;D. Heinemeier Hansson&lt;/option&gt;
  &lt;option value="2"&gt;D. Thomas&lt;/option&gt;
  &lt;option value="3"&gt;M. Clark&lt;/option&gt;
&lt;/select&gt;

</pre>
</div>
<h5 id="6bea4cfef78558f12d168b6f18a8b637d9a6f854">6.10.2 collection_radio_buttons</h5>
<p><code>object</code>が属するクラスのメソッド値の既存の返り値をコレクションにした<code>radio_button</code>タグを返します。</p>
<p>例として、このメソッドを適用するオブジェクトの構造が以下のようになっているとします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Post &lt; ActiveRecord::Base
  belongs_to :author
end

class Author &lt; ActiveRecord::Base
  has_many :posts
  def name_with_initial
    "#{first_name.first}. #{last_name}"
  end
end

</pre>
</div>
<p>利用法は、たとえば以下のようになります。ここでは、Postモデルのインスタンスである<code>@post</code>に関連付けられているAuthorモデルから選択肢を取り出しています。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
collection_radio_buttons(:post, :author_id, Author.all, :id, :name_with_initial)

</pre>
</div>
<p><code>@post.author_id</code>が1の場合、以下が返されます。</p>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;input id="post_author_id_1" name="post[author_id]" type="radio" value="1" checked="checked" /&gt;
&lt;label for="post_author_id_1"&gt;D. Heinemeier Hansson&lt;/label&gt;
&lt;input id="post_author_id_2" name="post[author_id]" type="radio" value="2" /&gt;
&lt;label for="post_author_id_2"&gt;D. Thomas&lt;/label&gt;
&lt;input id="post_author_id_3" name="post[author_id]" type="radio" value="3" /&gt;
&lt;label for="post_author_id_3"&gt;M. Clark&lt;/label&gt;

</pre>
</div>
<h5 id="76fdcc58ec0c43d131f7fc9d2ba2b1e10ecfe3ca">6.10.3 collection_check_boxes</h5>
<p><code>object</code>が属するクラスのメソッド値の既存の返り値をコレクションにした<code>check_box</code>タグを返します。</p>
<p>例として、このメソッドを適用するオブジェクトの構造が以下のようになっているとします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Post &lt; ActiveRecord::Base
  has_and_belongs_to_many :authors
end

class Author &lt; ActiveRecord::Base
  has_and_belongs_to_many :posts
  def name_with_initial
    "#{first_name.first}. #{last_name}"
  end
end

</pre>
</div>
<p>利用法は、たとえば以下のようになります。ここでは、Postモデルのインスタンスである<code>@post</code>に関連付けられているAuthorsから選択肢を取り出しています。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
collection_check_boxes(:post, :author_ids, Author.all, :id, :name_with_initial)

</pre>
</div>
<p><code>@post.author_ids</code>が1の場合、以下が返されます。</p>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;input id="post_author_ids_1" name="post[author_ids][]" type="checkbox" value="1" checked="checked" /&gt;
&lt;label for="post_author_ids_1"&gt;D. Heinemeier Hansson&lt;/label&gt;
&lt;input id="post_author_ids_2" name="post[author_ids][]" type="checkbox" value="2" /&gt;
&lt;label for="post_author_ids_2"&gt;D. Thomas&lt;/label&gt;
&lt;input id="post_author_ids_3" name="post[author_ids][]" type="checkbox" value="3" /&gt;
&lt;label for="post_author_ids_3"&gt;M. Clark&lt;/label&gt;
&lt;input name="post[author_ids][]" type="hidden" value="" /&gt;

</pre>
</div>
<h5 id="ff383afcb65d7f382b7ba56114613e944d332536">6.10.4 country_options_for_select</h5>
<p>世界のほぼすべての国名を含むオプションタグの文字列を返します。</p>
<h5 id="2e13c8aa18c0a314a3899f35bb02526f73a25a05">6.10.5 country_select</h5>
<p>country_options_for_selectを使用してオプションタグを生成し、指定されたオブジェクトとメソッド用のselectタグとoptionタグを返します。</p>
<h5 id="1d8de34d8e926810cbf89f4ce2b2a130e44b2bc1">6.10.6 option_groups_from_collection_for_select</h5>
<p><code>option</code>タグの文字列を返します。後述の<code>options_from_collection_for_select</code>と似ていますが、引数のオブジェクトリレーションに基いて<code>optgroup</code>タグを使用する点が異なります。</p>
<p>例として、このメソッドを適用するオブジェクトの構造が以下のようになっているとします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Continent &lt; ActiveRecord::Base
  has_many :countries
  # attribs: id, name
end

class Country &lt; ActiveRecord::Base
  belongs_to :continent
  # attribs: id, name, continent_id
end

</pre>
</div>
<p>使用例は以下のようになります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
option_groups_from_collection_for_select(@continents, :countries, :name, :id, :name, 3)

</pre>
</div>
<p>出力結果は以下のようになります。</p>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;optgroup label="Africa"&gt;
  &lt;option value="1"&gt;Egypt&lt;/option&gt;
  &lt;option value="4"&gt;Rwanda&lt;/option&gt;
  ...
&lt;/optgroup&gt;
&lt;optgroup label="Asia"&gt;
  &lt;option value="3" selected="selected"&gt;China&lt;/option&gt;
  &lt;option value="12"&gt;India&lt;/option&gt;
  &lt;option value="5"&gt;Japan&lt;/option&gt;
  ...
&lt;/optgroup&gt;

</pre>
</div>
<p>メモ: 返されるのは<code>optgroup</code>タグと<code>option</code>だけです。従って、出力結果の外側を適切な<code>select</code>タグで囲む必要があります。</p>
<h5 id="9337abeda5de70bae0ca68e013e0174eda24ee9b">6.10.7 options_for_select</h5>
<p>コンテナ (ハッシュ、配列、enumerable、独自の型) を引数として受け付け、オプションタグの文字列を返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
options_for_select([ "VISA", "MasterCard" ])
# =&gt; &lt;option&gt;VISA&lt;/option&gt; &lt;option&gt;MasterCard&lt;/option&gt;

</pre>
</div>
<p>メモ: 返されるのは<code>option</code>だけです。従って、出力結果の外側を適切なHTML <code>select</code>タグで囲む必要があります。</p>
<h5 id="ce60e9e75bdd79e1631d98cf22867bf68e45a85e">6.10.8 options_from_collection_for_select</h5>
<p><code>collection</code>を列挙した結果をoptionタグ化した文字列を返し、呼び出しの結果を<code>value_method</code>にオプション値として割り当て、<code>text_method</code>にオプションテキストとして割り当てます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
options_from_collection_for_select(collection, value_method, text_method, selected = nil)●原文がコメントアウトされているのは誤り

</pre>
</div>
<p>たとえば、@project.peopleに入っているpersonをループですべて列挙してinputタグを作成するのであれば、以下のようになります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
options_from_collection_for_select(@project.people, "id", "name")
# =&gt; &lt;option value="#{person.id}"&gt;#{person.name}&lt;/option&gt;

</pre>
</div>
<p>メモ: 返されるのは<code>option</code>だけです。従って、出力結果の外側を適切なHTML <code>select</code>タグで囲む必要があります。</p>
<h5 id="81448fe273247b533b9f018e96c158cab7901247">6.10.9 select</h5>
<p>指定されたオブジェクトとメソッドに従って、selectタグの中に一連のoptionタグを含んだものを作成します。</p>
<p>例：</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
select("post", "person_id", Person.all.collect {|p| [ p.name, p.id ] }, {include_blank: true})

</pre>
</div>
<p><code>@post.person_id</code>が1の場合、以下が返されます。</p>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;select name="post[person_id]"&gt;
  &lt;option value=""&gt;&lt;/option&gt;
  &lt;option value="1" selected="selected"&gt;David&lt;/option&gt;
  &lt;option value="2"&gt;Sam&lt;/option&gt;
  &lt;option value="3"&gt;Tobias&lt;/option&gt;
&lt;/select&gt;

</pre>
</div>
<h5 id="5ab6396c318b94bb2becda7b1ab60dca58238a40">6.10.10 time_zone_options_for_select</h5>
<p>世界のほぼすべてのタイムゾーンを含むオプションタグの文字列を返します。</p>
<h5 id="0bee965a700f1a0dbd51dc0baa0bbae1db56939f">6.10.11 time_zone_select</h5>
<p>time_zone_options_for_selectを使用してオプションタグを生成し、指定されたオブジェクトとメソッド用のselectタグとoptionタグを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
time_zone_select( "user", "time_zone")

</pre>
</div>
<h5 id="5433e568cb93db0607541ad4f368d6869dd0a8e0">6.10.12 date_field</h5>
<p>特定の属性にアクセスするための、種類が"date"のinputタグを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
date_field("user", "dob")

</pre>
</div>
<h4 id="8ff66420ce0286ed3e95edc21fb03e009325fed5">6.11 FormTagHelper</h4>
<p>フォームタグを作成するためのメソッドを多数提供します。これらのメソッドは、テンプレートに割り当てられているActive Recordオブジェクトに依存しない点がFormHelperと異なります。その代わり、FormTagHelperのメソッドでは名前と値を個別に指定します。</p>
<h5 id="840d1f6852d61c62e2d7cf055d44cac31491ce8f">6.11.1 check_box_tag</h5>
<p>チェックボックス用のフォームinputタグを作成します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
check_box_tag 'accept'
# =&gt; &lt;input id="accept" name="accept" type="checkbox" value="1" /&gt;

</pre>
</div>
<h5 id="32afec62b0694194a4f1d2765ba111432d2eba13">6.11.2 field_set_tag</h5>
<p>HTMLフォーム要素をグループ化するためのfieldsetタグを作成します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= field_set_tag do %&gt;
  &lt;p&gt;&lt;%= text_field_tag 'name' %&gt;&lt;/p&gt;
&lt;% end %&gt;
# =&gt; &lt;fieldset&gt;&lt;p&gt;&lt;input id="name" name="name" type="text" /&gt;&lt;/p&gt;&lt;/fieldset&gt;

</pre>
</div>
<h5 id="d58b37a2602332672e2387507e582a46af2c978b">6.11.3 file_field_tag</h5>
<p>ファイルアップロード用のフィールドを作成します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= form_tag({action:"post"}, multipart: true) do %&gt;
  &lt;label for="file"&gt;File to Upload&lt;/label&gt; &lt;%= file_field_tag "file" %&gt;
  &lt;%= submit_tag %&gt;
&lt;% end %&gt;

</pre>
</div>
<p>出力例:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
file_field_tag 'attachment'
# =&gt; &lt;input id="attachment" name="attachment" type="file" /&gt;

</pre>
</div>
<h5 id="8c8027665aa008ad474e1a1265d5d4bdf6c3f10c">6.11.4 form_tag</h5>
<p><code>url_for_options</code>で設定されたURLへのアクションに送信されるフォームタグを作成します。これは<code>ActionController::Base#url_for</code>と似ています。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= form_tag '/posts' do %&gt;
  &lt;div&gt;&lt;%= submit_tag 'Save' %&gt;&lt;/div&gt;
&lt;% end %&gt;
# =&gt; &lt;form action="/posts" method="post"&gt;&lt;div&gt;&lt;input type="submit" name="submit" value="Save" /&gt;&lt;/div&gt;&lt;/form&gt;

</pre>
</div>
<h5 id="a39e1b4dde91764087a0f852d962bcace1cef48c">6.11.5 hidden_field_tag</h5>
<p>フォームinputの「隠しフィールド」を作成します。この隠しフィールドは、通常であればHTTPがステートレスであることによって失われる可能性のあるデータを送信したり、ユーザーから見えないようにしておきたいデータを送信するのに使用されます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
hidden_field_tag 'token', 'VUBJKB23UIVI1UU1VOBVI@'
# =&gt; &lt;input id="token" name="token" type="hidden" value="VUBJKB23UIVI1UU1VOBVI@" /&gt;

</pre>
</div>
<h5 id="db80a7bdc450bc17766a208b99587060acbdd3d2">6.11.6 image_submit_tag</h5>
<p>送信画像を表示します。この画像をクリックするとフォームが送信されます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
image_submit_tag("login.png")
# =&gt; &lt;input src="/images/login.png" type="image" /&gt;

</pre>
</div>
<h5 id="60a597a883444787664a906248714bab8f4419fa">6.11.7 label_tag</h5>
<p>フィールドのラベルを作成します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
label_tag 'name'
# =&gt; &lt;label for="name"&gt;Name&lt;/label&gt;

</pre>
</div>
<h5 id="e84eb463dc1f6b1abc35ae62f8d822cfd8212e95">6.11.8 password_field_tag</h5>
<p>パスワード用のフィールドを作成します。このフィールドへの入力はマスク用文字で隠されます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
password_field_tag 'pass'
# =&gt; &lt;input id="pass" name="pass" type="password" /&gt;

</pre>
</div>
<h5 id="8053925f93c70d7a78a92000ed3b2006bcb18dbd">6.11.9 radio_button_tag</h5>
<p>ラジオボタンを作成します。ユーザーが同じオプショングループ内から選択できるよう、同じ名前でラジオボタンをグループ化してください。●</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
radio_button_tag 'gender', 'male'
# =&gt; &lt;input id="gender_male" name="gender" type="radio" value="male" /&gt;

</pre>
</div>
<h5 id="fca1ea2167cee1428b32255626c8fecd49ea765b">6.11.10 select_tag</h5>
<p>ドロップダウン選択ボックスを作成します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
select_tag "people", "&lt;option&gt;David&lt;/option&gt;"
# =&gt; &lt;select id="people" name="people"&gt;&lt;option&gt;David&lt;/option&gt;&lt;/select&gt;

</pre>
</div>
<h5 id="8113fb36dd25a0f14f9f7eeb9b4c02d2cc994b80">6.11.11 submit_tag</h5>
<p>キャプションとして指定されたテキストを使用して送信ボタンを作成します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
submit_tag "Publish this post"
# =&gt; &lt;input name="commit" type="submit" value="Publish this post" /&gt;

</pre>
</div>
<h5 id="8dc9daf183916a71ca9feb6de1cebd808aa8caea">6.11.12 text_area_tag</h5>
<p>textareaタグでテキスト入力エリアを作成します。ブログへの投稿や説明文などの長いテキストを入力するにはtextareaをご使用ください。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
text_area_tag 'post'
# =&gt; &lt;textarea id="post" name="post"&gt;&lt;/textarea&gt;

</pre>
</div>
<h5 id="a5d0d8f362a819cea9fdcab681b24a0e822bc0c4">6.11.13 text_field_tag</h5>
<p>通常のテキストフィールドを作成します。ユーザー名や検索キーワード入力用のフィールドにはこの通常のテキストフィールドをご使用ください。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
text_field_tag 'name'
# =&gt; &lt;input id="name" name="name" type="text" /&gt;

</pre>
</div>
<h5 id="ae67c03116e1e9cd053229194c627ffe464416df">6.11.14 email_field_tag</h5>
<p>種類が<code>email</code>の標準入力フィールドを作成します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
email_field_tag 'email'
# =&gt; &lt;input id="email" name="email" type="email" /&gt;

</pre>
</div>
<h5 id="0e3418696ed5e9ad5c0cf4fa502f427a4a67cbb1">6.11.15 url_field_tag</h5>
<p>種類が<code>url</code>の標準入力フィールドを作成します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
url_field_tag 'url'
# =&gt; &lt;input id="url" name="url" type="url" /&gt;

</pre>
</div>
<h5 id="3876eb686a4dc2f56b399b716f2930792194c960">6.11.16 date_field_tag</h5>
<p>種類が<code>date</code>の標準入力フィールドを作成します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
date_field_tag "dob"
# =&gt; &lt;input id="dob" name="dob" type="date" /&gt;

</pre>
</div>
<h4 id="e79342aa85fd4f1c22498783cd42d8faf5c0f966">6.12 JavaScriptHelper</h4>
<p>ビューでJavaScriptを使用するための機能を提供します。</p>
<h5 id="b1d25ddb2d4612a0e91625ba61d93307f819cef2">6.12.1 button_to_function</h5>
<p><code>onclick</code>ハンドラを使用するJavaScript関数を起動するボタンを返します。以下の例を参照ください。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
button_to_function "Greeting", "alert('Hello world!')"
button_to_function "Delete", "if (confirm('Really?')) do_delete()"
button_to_function "Details" do |page|
  page[:details].visual_effect :toggle_slide
end

</pre>
</div>
<h5 id="678284f703033fbfbf40849838f46744c7651656">6.12.2 define_javascript_functions</h5>
<p>単一の<code>script</code>タグ内にAction PackのJavaScriptライブラリを追加します。</p>
<h5 id="d07777d092b3f24c783c39afeb6e5d792d21a1cc">6.12.3 escape_javascript</h5>
<p>JavaScriptセグメントから改行 (CR) と一重引用符と二重引用符をエスケープします。●原文のcarrierはcarriageが正しい</p>
<h5 id="1d315f07d29ae8eb7878b4e163c6827143806848">6.12.4 javascript_tag</h5>
<p>渡されたコードをJavaScript用タグにラップして返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
javascript_tag "alert('All is good')"

</pre>
</div>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;script&gt;
//&lt;![CDATA[
alert('All is good')
//]]&gt;
&lt;/script&gt;

</pre>
</div>
<h5 id="2097aa7d9ab4268a144c486663571bbff5a7e86e">6.12.5 link_to_function</h5>
<p><code>onclick</code>ハンドラを使用するJavaScript関数を起動し、その後falseを返すリンクを返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
link_to_function "Greeting", "alert('Hello world!')"
# =&gt; &lt;a onclick="alert('Hello world!'); return false;" href="#"&gt;Greeting&lt;/a&gt;

</pre>
</div>
<h4 id="5a4142ed71d8bb3054e10546418ff4a5622d023e">6.13 NumberHelper</h4>
<p>数値をフォーマット済み文字列に変換するメソッド群を提供します。サポートされているフォーマットは電話番号、通貨、パーセント、精度、座標、ファイルサイズなどです。</p>
<h5 id="026f2ca0057aa5438b9932a5ed73c6611cea475f">6.13.1 number_to_currency</h5>
<p>数値を通貨表示に変換します ($13.65など)。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
number_to_currency(1234567890.50) # =&gt; $1,234,567,890.50

</pre>
</div>
<h5 id="97dd0486f602d6ec3206d81121eab01fe820de9a">6.13.2 number_to_human_size</h5>
<p>バイト数を読みやすい形式にフォーマットします。ファイルサイズをユーザーに表示する場合に便利です。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
number_to_human_size(1234)          # =&gt; 1.2 KB
number_to_human_size(1234567)       # =&gt; 1.2 MB

</pre>
</div>
<h5 id="66ce8c2552aea4206633c407196583795a6a7a37">6.13.3 number_to_percentage</h5>
<p>数値をパーセント文字列に変換します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
number_to_percentage(100, precision: 0)        # =&gt; 100%

</pre>
</div>
<h5 id="8b81a913169de37f548abdd42fa9b87287ec222c">6.13.4 number_to_phone</h5>
<p>数値を米国式の電話番号に変換します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
number_to_phone(1235551234) # =&gt; 123-555-1234

</pre>
</div>
<h5 id="77c26bc288f15c3b42cec6582714d43f366f29f9">6.13.5 number_with_delimiter</h5>
<p>数値に3桁ごとの桁区切り文字を追加します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
number_with_delimiter(12345678) # =&gt; 12,345,678

</pre>
</div>
<h5 id="0297884303e44b9c4394982901061b700d54487d">6.13.6 number_with_precision</h5>
<p>数値を指定された精度(<code>precision</code>)に変換します。デフォルトの精度は3です。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
number_with_precision(111.2345)     # =&gt; 111.235
number_with_precision(111.2345, 2)  # =&gt; 111.23

</pre>
</div>
<h4 id="73df85af0580ef97f23b64c3e4212b856d72f8a5">6.14 SanitizeHelper</h4>
<p>SanitizeHelperモジュールは、望ましくないHTML要素を除去するためのメソッド群を提供します。</p>
<h5 id="b64c5f5ed148a5f6408863d88cbda685d8199377">6.14.1 sanitize</h5>
<p>sanitizeヘルパーメソッドは、すべてのタグ文字をHTMLエンコードし、明示的に許可されていない属性をすべて削除します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
sanitize @article.body

</pre>
</div>
<p>:attributesオプションまたは:tagsオプションが渡されると、そこで指定されたタグおよび属性のみが処理の対象外となります。●</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
sanitize @article.body, tags: %w(table tr td), attributes: %w(id class style)

</pre>
</div>
<p>さまざまな用途に合わせてデフォルト設定を変更できます。たとえば以下のようにデフォルトのタグにtableタグを追加するとします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Application &lt; Rails::Application
  config.action_view.sanitized_allowed_tags = 'table', 'tr', 'td'
end

</pre>
</div>
<h5 id="79e3ad6309dc5dd0ee06775450fe57f32efb8544">6.14.2 sanitize_css(style)</h5>
<p>CSSコードをサニタイズします。</p>
<h5 id="a3fab3894bd8cb402af7072067bbbc3dc4ba5437">6.14.3 strip_links(html)</h5>
<p>リンクテキストを残してリンクタグをすべて削除します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
strip_links("&lt;a href="http://rubyonrails.org"&gt;Ruby on Rails&lt;/a&gt;")
# =&gt; Ruby on Rails

</pre>
</div>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
strip_links("emails to &lt;a href="mailto:me@email.com"&gt;me@email.com&lt;/a&gt;.")
# =&gt; emails to me@email.com.

</pre>
</div>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
strip_links('Blog: &lt;a href="http://myblog.com/"&gt;Visit&lt;/a&gt;.')
# =&gt; Blog: Visit.

</pre>
</div>
<h5 id="519ef12e2c3eccd6e5a501b6001aa85be29e2df0">6.14.4 strip_tags(html)</h5>
<p>HTMLからHTMLタグをすべて削除します。HTMLコメントも削除されます。
このメソッドではHTMLスキャナとHTMLトークナイザ (tokenizer) を使用しており、HTMLの解析能力はスキャナの能力に依存しています。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
strip_tags("Strip &lt;i&gt;these&lt;/i&gt; tags!")
# =&gt; Strip these tags!

</pre>
</div>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
strip_tags("&lt;b&gt;Bold&lt;/b&gt; no more!  &lt;a href='more.html'&gt;See more&lt;/a&gt;")
# =&gt; Bold no more!  See more

</pre>
</div>
<p>注意: この出力にはエスケープされていない'&lt;'、'&gt;'、'&amp;'文字が残ることがあり、それにによってブラウザが期待どおりに動作しなくなることがあります。</p>
<h4 id="1508ce4b932cf6c1d431f0262adc6bfad713e0b0">6.15 CsrfHelper</h4>
<p>"csrf-param"メタタグと"csrf-token"メタタグを返します。これらの名称はそれぞれ、クロスサイトリクエストフォージェリ (CSRF: cross-site request foregery) のパラメータとトークンが元になっています。</p>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;%= csrf_meta_tags %&gt;

</pre>
</div>
<p>メモ: 通常のフォームではそのための隠しフィールドが生成されるので、これらのタグは使用されません。詳細については<a href="./security.html#cross-site-request-forgery-csrf">セキュリティガイド</a>を参照してください。</p>
<h3 id="eee5e380db3a4ac4756b88f25b92e96446791544">7 ローカライズされたビュー</h3>
<p>Action Viewは、現在のロケールに応じてさまざまなテンプレートを出力することができます。</p>
<p>たとえば、<code>PostsController</code>にshowアクションがあるとしましょう。このshowアクションを呼び出すと、デフォルトでは<code>app/views/posts/show.html.erb</code>が出力されます。ここで<code>I18n.locale = :de</code>を設定すると、代りに<code>app/views/posts/show.de.html.erb</code>が出力されます。ローカライズ版のテンプレートが見当たらない場合は、装飾なしのバージョンが使用されます。つまり、ローカライズ版ビューがなくても動作しますが、ローカライズ版ビューがあればそれが使用されます。</p>
<p>同じ要領で、publicディレクトリのレスキューファイル (いわゆるエラーページ) もローカライズできます。たとえば、<code>I18n.locale = :de</code>と設定し、<code>public/500.de.html</code>と<code>public/404.de.html</code>を作成することで、ローカライズ版のレスキューページを作成できます。</p>
<p>RailsはI18n.localeに設定できるシンボルを制限していないので、ローカライズにかぎらず、あらゆる状況に合わせて異なるコンテンツを表示し分けるようにすることができます。たとえば、エキスパートユーザーには、通常ユーザーと異なる画面を表示したいとします。これを行なうには、<code>app/controllers/application.rb</code>に以下のように追記します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
before_action :set_expert_locale

def set_expert_locale
  I18n.locale = :expert if current_user.expert?
end

</pre>
</div>
<p>これにより、たとえば<code>app/views/posts/show.expert.html.erb</code>のような特殊なビューをエキスパートユーザーにだけ表示することができます。</p>
<p>詳細については、<a href="i18n.html">Rails国際化 (I18n) API</a> を参照してください。</p>
</body></html>


        <h3>Feedback</h3>
        <p>
          You're encouraged to help improve the quality of this guide.
        </p>
        <p>
          Please contribute if you see any typos or factual errors.
          To get started, you can read our <a href="http://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">documentation contributions</a> section.
        </p>
        <p>
          You may also find incomplete content, or stuff that is not up to date.
          Please do add any missing documentation for master. Make sure to check
          <a href="http://edgeguides.rubyonrails.org">Edge Guides</a> first to verify
          if the issues are already fixed or not on the master branch.
          Check the <a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</a>
          for style and conventions.
        </p>
        <p>
          If for whatever reason you spot something to fix but cannot patch it yourself, please
          <a href="https://github.com/rails/rails/issues">open an issue</a>.
        </p>
        <p>And last but not least, any kind of discussion regarding Ruby on Rails
          documentation is very welcome in the <a href="http://groups.google.com/group/rubyonrails-docs">rubyonrails-docs mailing list</a>.
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-Share Alike 3.0</a> License</p>
<p>"Rails", "Ruby on Rails", and the Rails logo are trademarks of David Heinemeier Hansson. All rights reserved.</p>

    </div>
  </div>

  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all();
    $(guidesIndex.bind);
  </script>
</body>
</html>
