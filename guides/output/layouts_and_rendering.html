<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="description" content="Rails開発のお供に! 日本語版Railsリファレンスガイド (Rails 4.1 対応)" />
<meta name="keywords"    content="Guides Ruby Rails ガイド ウェブ 無料 Rails開発" />
<meta name="author"      content="Ruby on Rails Community" />

<meta property="fb:admins"      content="715330868" />
<meta property="og:title"       content="Ruby on Rails ガイド"/>
<meta property="og:site_name"   content="Ruby on Rails ガイド"/>
<meta property="og:image"       content="http://railsguides.jp/images/rails_guides_logo.gif"/>
<meta property="og:url"         content="http://railsguides.jp/" />
<meta property="og:type"        content="article" />
<meta property="og:description" content="Rails 開発のお供に! 日本語版 Rails リファレンスガイド (Rails 4.1 対応)" />

<title>Ruby on Rails Guides</title>
<link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />

<link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

<link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
</head>
<body class="guide">
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=614116885378153&version=v2.0";
    fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">関連サイト: </strong>
      <span class="red-button more-info-button">
        関連サイト
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="http://guides.rubyonrails.org/">原著 (英語)</a></li>
        <li class="more-info"><a href="https://github.com/yasslab/railsguides.jp">ソースコード (GitHub)</a></li>
        <li class="more-info"><a href="http://railstutorial.jp/">Rails チュートリアル</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="/" title="Return to home page">railsguides.jp</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">ホーム</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">ガイド目次</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>はじめに</dt>
                <dd><a href="getting_started.html">Rails をはじめよう</a></dd>
                <dt>モデル</dt>
                <dd><a href="active_record_basics.html">Active Record の基礎</a></dd>
                <dd><a href="active_record_migrations.html">Active Record マイグレーション [翻訳中]</a></dd>
                <dd><a href="active_record_validations.html">Active Record バリデーション</a></dd>
                <dd><a href="active_record_callbacks.html">Active Record コールバック</a></dd>
                <dd><a href="association_basics.html">Active Record アソシエーション</a></dd>
                <dd><a href="active_record_querying.html">Active Record クエリインターフェイス</a></dd>
                <dt>ビュー</dt>
                <dd><a href="layouts_and_rendering.html">レイアウトとレンダリング [翻訳中]</a></dd>
                <dd><a href="form_helpers.html">Action View フォームヘルパー</a></dd>
                <dt>コントローラ</dt>
                <dd><a href="action_controller_overview.html">Action Controller の概要</a></dd>
                <dd><a href="routing.html">Rails ルーティング</a></dd>
              </dl>
              <dl class="R">
                <dt>高度なトピック</dt>
                <dd><a href="active_support_core_extensions.html">Active Support コア拡張機能</a></dd>
                <dd><a href="i18n.html">Rails 国際化 (i18n) API</a></dd>
                <dd><a href="action_mailer_basics.html">Action Mailer Basics [未着手]</a></dd>
                <dd><a href="active_job_basics.html">Active Job Basics [未着手]</a></dd>
                <dd><a href="security.html">Ruby on Rails セキュリティガイド</a></dd>
                <dd><a href="debugging_rails_applications.html">Debugging Rails Applications [未着手]</a></dd>
                <dd><a href="configuring.html">Rails アプリケーションを設定する</a></dd>
                <dd><a href="command_line.html">Rails Command Line Tools and Rake Tasks [未着手]</a></dd>
                <dd><a href="asset_pipeline.html">Asset Pipeline [未着手]</a></dd>
                <dd><a href="working_with_javascript_in_rails.html">Working with JavaScript in Rails [未着手]</a></dd>
                <dt>Rails を拡張する</dt>
                <dd><a href="rails_on_rack.html">Rails on Rack [未着手]</a></dd>
                <dd><a href="generators.html">Creating and Customizing Rails Generators [未着手]</a></dd>
                <dt>Ruby on Rails に貢献する</dt>
                <dd><a href="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails [未着手]</a></dd>
                <dd><a href="api_documentation_guidelines.html">API Documentation Guidelines [未着手]</a></dd>
                <dd><a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails ガイドのガイドライン</a></dd>
                <dt>メンテナンスポリシー</dt>
                <dd><a href="maintenance_policy.html">Maintenance Policy [未着手]</a></dd>
                <dt>リリースノート</dt>
                <dd><a href="upgrading_ruby_on_rails.html">Ruby on Rails アップグレードガイド</a></dd>
                <dd><a href="4_1_release_notes.html">Ruby on Rails 4.1 リリースノート</a></dd>
                <dd><a href="4_0_release_notes.html">Ruby on Rails 4.0 Release Notes [未着手]</a></dd>
                <dd><a href="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes [未着手]</a></dd>
                <dd><a href="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes [未着手]</a></dd>
                <dd><a href="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes [未着手]</a></dd>
                <dd><a href="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes [未着手]</a></dd>
                <dd><a href="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes [未着手]</a></dd>
              </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">貢献する</a></li>
        <li><a class="nav-item" href="credits.html">原著者</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">ガイド目次</option>
              <optgroup label="はじめに">
                  <option value="getting_started.html">Rails をはじめよう</option>
              </optgroup>
              <optgroup label="モデル">
                  <option value="active_record_basics.html">Active Record の基礎</option>
                  <option value="active_record_migrations.html">Active Record マイグレーション [翻訳中]</option>
                  <option value="active_record_validations.html">Active Record バリデーション</option>
                  <option value="active_record_callbacks.html">Active Record コールバック</option>
                  <option value="association_basics.html">Active Record アソシエーション</option>
                  <option value="active_record_querying.html">Active Record クエリインターフェイス</option>
              </optgroup>
              <optgroup label="ビュー">
                  <option value="layouts_and_rendering.html">レイアウトとレンダリング [翻訳中]</option>
                  <option value="form_helpers.html">Action View フォームヘルパー</option>
              </optgroup>
              <optgroup label="コントローラ">
                  <option value="action_controller_overview.html">Action Controller の概要</option>
                  <option value="routing.html">Rails ルーティング</option>
              </optgroup>
              <optgroup label="高度なトピック">
                  <option value="active_support_core_extensions.html">Active Support コア拡張機能</option>
                  <option value="i18n.html">Rails 国際化 (i18n) API</option>
                  <option value="action_mailer_basics.html">Action Mailer Basics [未着手]</option>
                  <option value="active_job_basics.html">Active Job Basics [未着手]</option>
                  <option value="security.html">Ruby on Rails セキュリティガイド</option>
                  <option value="debugging_rails_applications.html">Debugging Rails Applications [未着手]</option>
                  <option value="configuring.html">Rails アプリケーションを設定する</option>
                  <option value="command_line.html">Rails Command Line Tools and Rake Tasks [未着手]</option>
                  <option value="asset_pipeline.html">Asset Pipeline [未着手]</option>
                  <option value="working_with_javascript_in_rails.html">Working with JavaScript in Rails [未着手]</option>
              </optgroup>
              <optgroup label="Rails を拡張する">
                  <option value="rails_on_rack.html">Rails on Rack [未着手]</option>
                  <option value="generators.html">Creating and Customizing Rails Generators [未着手]</option>
              </optgroup>
              <optgroup label="Ruby on Rails に貢献する">
                  <option value="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails [未着手]</option>
                  <option value="api_documentation_guidelines.html">API Documentation Guidelines [未着手]</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Ruby on Rails ガイドのガイドライン</option>
              </optgroup>
              <optgroup label="メンテナンスポリシー">
                  <option value="maintenance_policy.html">Maintenance Policy [未着手]</option>
              </optgroup>
              <optgroup label="リリースノート">
                  <option value="upgrading_ruby_on_rails.html">Ruby on Rails アップグレードガイド</option>
                  <option value="4_1_release_notes.html">Ruby on Rails 4.1 リリースノート</option>
                  <option value="4_0_release_notes.html">Ruby on Rails 4.0 Release Notes [未着手]</option>
                  <option value="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes [未着手]</option>
                  <option value="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes [未着手]</option>
                  <option value="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes [未着手]</option>
                  <option value="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes [未着手]</option>
                  <option value="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes [未着手]</option>
              </optgroup>
          </select>
        </li>
      </ul>
      </div>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      
                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<ol class="chapters">
<li><a href="#%E6%A6%82%E8%A6%81:-%E9%83%A8%E5%93%81%E3%82%92%E7%B5%84%E3%81%BF%E4%B8%8A%E3%81%92%E3%82%8B">概要: 部品を組み上げる</a></li>
<li>
<a href="#%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B">レスポンスを作成する</a>

<ul>
<li><a href="#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%AE%E5%87%BA%E5%8A%9B:-%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E3%80%8C%E8%A8%AD%E5%AE%9A%E3%82%88%E3%82%8A%E8%A6%8F%E7%B4%84%E3%80%8D">デフォルトの出力: アクションにおける「設定より規約」</a></li>
<li><a href="#render%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><code>render</code>を使用する</a></li>
<li><a href="#using-redirect_to">Using <code>redirect_to</code></a></li>
<li><a href="#using-head-to-build-header-only-responses">Using <code>head</code> To Build Header-Only Responses</a></li>
</ul>
</li>
<li>
<a href="#structuring-layouts">Structuring Layouts</a>

<ul>
<li><a href="#asset-tag-helpers">Asset Tag Helpers</a></li>
<li><a href="#understanding-yield">Understanding <code>yield</code></a></li>
<li><a href="#using-the-content_for-method">Using the <code>content_for</code> Method</a></li>
<li><a href="#using-partials">Using Partials</a></li>
<li><a href="#using-nested-layouts">Using Nested Layouts</a></li>
</ul>
</li>
</ol>
</body></html>

          </div>
</div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h2>ビューのレイアウトとレンダリング</h2>
<p>本ガイドでは、Action ControllerとAction Viewによる基本的なレイアウト機能について解説します。</p>
<p>このガイドの内容:</p>
<ul>
<li>Railsに組み込まれているさまざまなレンダリング (=レスポンスの出力) 方法の使い方</li>
<li>コンテンツが複数のセクションからなるレイアウト作成法</li>
<li>パーシャルを使用してビューをDRYにする方法</li>
<li>レイアウトをネストする方法 (サブテンプレート)</li>
</ul>

<hr>
<h3 id="概要:-部品を組み上げる">1 概要: 部品を組み上げる</h3>
<p>本ガイドでは、コントローラ、ビュー、モデルによって形成される三角形のうち、コントローラとビューの間でのやりとりを中心に扱います。御存じのように、Railsのコントローラはリクエストを扱うプロセス全体の流れを組織的に調整する責任を負い、(ビジネスロジックのような) 重い処理はモデルの方で行なわせるのが普通ですモデル側での処理が完了し、ユーザーに結果を表示する時がきたら、コントローラは処理結果をビューに渡します。このときの、コントローラからビューへの結果の渡し方こそが本ガイドの主なトピックです。</p>
<p>大きな流れとしては、ユーザーへのレスポンスとして送信すべき内容を決定することと、ユーザーへのレスポンスを作成するために適切なメソッドを呼び出すこともこの作業に含まれます。ユーザーに返すレスポンス画面を完全なビューにするのであれば、Railsはそのビューをさらに別のレイアウトでラッピングし、パーシャルビューとして取り出すでしょう。以後本ガイドではこれらの方法をすべて紹介します。</p>
<h3 id="レスポンスを作成する">2 レスポンスを作成する</h3>
<p>コントローラ側から見ると、HTTPレスポンスの作成方法は以下の3とおりあります。</p>
<ul>
<li>
<code>render</code>を呼び出し、ブラウザに返す完全なレスポンスを作成する</li>
<li>
<code>redirect_to</code>を呼び出し、HTTPリダイレクトコードステータスをブラウザに送信する</li>
<li>
<code>head</code>を呼び出し、HTTPヘッダーのみで構成されたレスポンスを作成してブラウザに送信する</li>
</ul>
<h4 id="デフォルトの出力:-アクションにおける「設定より規約」">2.1 デフォルトの出力: アクションにおける「設定より規約」</h4>
<p>Railsでは「設定より規約 (CoC: convention over configuration)」というポリシーが推奨されていることをご存じかと思います。デフォルトの出力結果は、CoCのよい例でもあります。Railsのコントローラは、デフォルトでは正しいルーティングに対応する名前を持つビューを自動的に選び、それを使用してレスポンスを出力します。たとえば、<code>BooksController</code>というコントローラに以下のコードがあるとします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class BooksController &lt; ApplicationController
end

</pre>
</div>
<p>ルーティングファイルに以下が記載されているとします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
  resources :books

</pre>
</div>
<p><code>app/views/books/index.html.erb</code>ビューファイルの内容が以下のようになっているとします。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;h1&gt;Books are coming soon!&lt;/h1&gt;

</pre>
</div>
<p>以上のようにすることで、ユーザーがブラウザで<code>/books</code>にアクセスすると、Railsは自動的に<code>app/views/books/index.html.erb</code>ビューを使用してレスポンスを出力し、その結果「Books are coming soon!」という文字が画面に表示されます。</p>
<p>しかしこの画面だけではほとんど実用性がないので、<code>Book</code>モデルを作成し、<code>BooksController</code>にindexアクションを追加してみましょう。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class BooksController &lt; ApplicationController
  def index
    @books = Book.all
  end
end

</pre>
</div>
<p>上のコードでご注目いただきたいのは、「設定より規約」の原則が利いているおかげでindexアクションの最後で明示的に画面出力を指示する必要がないという点です。ここでの原則は、「コントローラのアクションの最終部分で明示的な画面出力が指示されていない場合は、コントローラが使用できるビューのパスから<code>アクション名.html.erb</code>というビューテンプレートを探し、それを使用して自動的に出力する」というものです。従って、この場合は<code>app/views/books/index.html.erb</code>ファイルが出力されます。</p>
<p>ビューですべての本の属性を表示したい場合は、以下のようにERBを書くことができます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;h1&gt;Listing Books&lt;/h1&gt;

&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Title&lt;/th&gt;
    &lt;th&gt;Summary&lt;/th&gt;
    &lt;th&gt;&lt;/th&gt;
    &lt;th&gt;&lt;/th&gt;
    &lt;th&gt;&lt;/th&gt;
  &lt;/tr&gt;

&lt;% @books.each do |book| %&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;%= book.title %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= book.content %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= link_to "Show", book %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= link_to "Edit", edit_book_path(book) %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= link_to "Remove", book, method: :delete, data: { confirm: "Are you sure?" } %&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;% end %&gt;
&lt;/table&gt;

&lt;br&gt;

&lt;%= link_to "New book", new_book_path %&gt;

</pre>
</div>
<p>メモ: 実際のレンダリングは、<code>ActionView::TemplateHandlers</code>のサブクラスで行われます。本ガイドではレンダリングの詳細については触れませんが、テンプレートハンドラの選択がビューテンプレートファイルの拡張子によって制御されているという重要な点は理解しておいてください。Rails 2以降におけるビューテンプレートの標準拡張子は、ERB (HTML + eMbedded RuBy) でレンダリングする場合は<code>.erb</code>、Builder (XMLジェネレータ) でレンダリングする場合は<code>.builder</code>です。</p>
<h4 id="renderを使用する">2.2 <code>render</code>を使用する</h4>
<p>アプリケーションがブラウザで表示するコンテンツのレンダリング (出力) という力仕事は、<code>ActionController::Base#render</code>メソッドがほぼ一手に引き受けています。<code>render</code>メソッドはさまざまな方法でカスタマイズできます。Railsテンプレートのデフォルトビューを出力することもできますし、特定のテンプレート、ファイル、インラインコードを指定して出力したり、何も出力しないこともできます。テキスト、JSON、XMLを出力することもできます。出力されるレスポンスのcontent typeやHTTPステータスを指定することもできます。</p>
<p>ヒント: 出力結果をブラウザで表示して調べることなく、<code>render</code>呼び出しの正確な結果を取得したい場合は、<code>render_to_string</code>を呼び出すことができます。このメソッドの動作は<code>render</code>と完全に同じであり、出力結果をブラウザに返さずに文字列を返す点だけが異なります。</p>
<h5 id="何も出力しない方法">2.2.1 何も出力しない方法</h5>
<p><code>render</code>メソッドでできる最も単純な動作は、何も出力しないことでしょう。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render nothing: true

</pre>
</div>
<p>このレスポンスをcurlコマンドを使用して調べてみると以下のようになっています。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
$ curl -i 127.0.0.1:3000/books
HTTP/1.1 200 OK
Connection: close
Date: Sun, 24 Jan 2010 09:25:18 GMT
Transfer-Encoding: chunked
Content-Type: */*; charset=utf-8
X-Runtime: 0.014297
Set-Cookie: _blog_session=...snip...; path=/; HttpOnly
Cache-Control: no-cache

$

</pre>
</div>
<p>レスポンスの内容は空欄になっています (<code>Cache-Control</code>行以降にデータがない) が、ステータスコートが200 OKになっているのでリクエストが成功していることがわかります。renderメソッドの<code>:status</code>オプションを設定することでレスポンスを変更できます。何も出力しないというレスポンスは、Ajaxリクエストを使用する時に便利です。これを使用することで、リクエストが成功したという確認応答だけをブラウザに送り返すことができるからです。</p>
<p>ヒント: 200 OKヘッダーだけを送信したいのであれば、ここでご紹介した<code>render :nothing</code>よりも、本ガイドで後述する<code>head</code>メソッドを使用する方がおそらくよいでしょう。<code>head</code>メソッドは<code>render :nothing</code>よりも柔軟性が高く、HTTPヘッダーだけを生成していることが明確になるからです。</p>
<h5 id="action-viewを出力する">2.2.2 Action Viewを出力する</h5>
<p>同じコントローラで、デフォルトと異なるテンプレートに対応するビューを出力したい場合は、<code>render</code>メソッドでビュー名を指定することができます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
  def update
  @book = Book.find(params[:id])
  if @book.update(book_params)
    redirect_to(@book)
  else
    render "edit"
  end
end

</pre>
</div>
<p>上の<code>update</code>アクションでモデルに対する<code>update</code>メソッドの呼び出しが失敗すると、同じコントローラに用意しておいた別の<code>edit.html.erb</code>テンプレートを使用して出力します。</p>
<p>出力するアクションを指定するには、文字列の他にシンボルを使用することもできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
  def update
  @book = Book.find(params[:id])
  if @book.update(book_params)
    redirect_to(@book)
  else
    render :edit
  end
end

</pre>
</div>
<h5 id="別のコントローラからアクションのテンプレートを出力する">2.2.3 別のコントローラからアクションのテンプレートを出力する</h5>
<p>あるコントローラのアクションから、まったく別のコントローラの配下にあるテンプレートを使用して出力することは可能でしょうか。これも<code>render</code>メソッドだけで行なうことができます。<code>render</code>メソッドには<code>app/views</code>を起点とするフルパスを渡すことができますので、出力したいテンプレートをフルパスで指定します。たとえば、<code>app/controllers/admin</code>に置かれている<code>AdminProducts</code>コントローラのコードを実行しているとすると、<code>app/views/products</code>に置かれているビューテンプレートに対するアクションの実行結果を出力するには以下のようにします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render "products/show"

</pre>
</div>
<p>パスにスラッシュ<code>/</code>が含まれていると、Railsによってこのビューは異なるコントローラの配下にあると認識されます。異なるコントローラのテンプレートを指定していることをより明示的にしたい場合は、以下のように<code>:template</code>オプションを使用することもできます (Rails 2.2以前ではこのオプションは必須でした)。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render template: "products/show"

</pre>
</div>
<h5 id="任意のファイルを使用して出力する">2.2.4 任意のファイルを使用して出力する</h5>
<p><code>render</code>メソッドで指定するビューは、現在のアプリケーションディレクトリの外部にあっても構いません (2つのRailsアプリケーションでビューを共有しているなどの場合)。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render "/u/apps/warehouse_app/current/app/views/products/show"

</pre>
</div>
<p>パスがスラッシュ<code>/</code>で始まっている場合、Railsはこのコードがファイルの出力であると認識します。ファイルを出力することをより明示的にしたい場合は、以下のように<code>:file</code>オプションを使用することもできます (Rails 2.2以前ではこのオプションは必須でした)。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render file: "/u/apps/warehouse_app/current/app/views/products/show"

</pre>
</div>
<p><code>:file</code>オプションに与えるパスは、ファイルシステムの絶対パスです。当然ながら、コンテンツを出力したいファイルに対して適切なアクセス権が与えられている必要があります。</p>
<p>メモ: ファイルを出力する場合、デフォルトでは現在のレイアウトが適用されません。ファイルの出力を現在のレイアウト内で行いたい場合は、<code>layout: true</code>オプションを追加する必要があります。</p>
<p>ヒント: Microsoft Windows上でRailsを実行している場合、ファイルを出力する際に<code>:file</code>オプションを省略できません。Windowsのファイル名フォーマットはUnixのファイル名と同じではないためです。</p>
<h5 id="まとめ">2.2.5 まとめ</h5>
<p>これまでご紹介した3とおりの出力方法 (コントローラ内の別テンプレートを使用、べコントローラのテンプレートを使用、ファイルシステム上の任意のファイルを使用) は、実際には同一のアクションのバリエーションにすぎません。</p>
<p>実のところ、たとえばBooksControllerクラスのupdateアクション内で、本の更新に失敗したらeditテンプレートを出力したいとすると、以下のどのレンダリング呼び出しを行っても最終的には必ず<code>views/books</code>ディレクトリの<code>edit.html.erb</code>を使用して出力が行われます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render :edit
render action: :edit
render "edit"
render "edit.html.erb"
render action: "edit"
render action: "edit.html.erb"
render "books/edit"
render "books/edit.html.erb"
render template: "books/edit"
render template: "books/edit.html.erb"
render "/path/to/rails/app/views/books/edit"
render "/path/to/rails/app/views/books/edit.html.erb"
render file: "/path/to/rails/app/views/books/edit"
render file: "/path/to/rails/app/views/books/edit.html.erb"

</pre>
</div>
<p>どの呼び出しを使用するかはコーディングのスタイルと規則の問題でしかありませんが、経験上なるべくシンプルな記法を使用する方がコードがわかりやすくなるでしょう。</p>
<h5 id="renderで:inlineオプションを使用する">2.2.6 <code>render</code>で<code>:inline</code>オプションを使用する</h5>
<p><code>render</code>メソッドは、メソッド呼び出しの際に<code>:inline</code>オプションを使用してERBを与えると、ビューがまったくない状態でも実行することができます。これは完全に有効な方法です。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render inline: "&lt;% products.each do |p| %&gt;&lt;p&gt;&lt;%= p.name %&gt;&lt;/p&gt;&lt;% end %&gt;"

</pre>
</div>
<p>警告: このオプションを実際に使用する意味はほぼないと思われます。コントローラのコードにERBを混在させると、RailsのMVC指向が崩されるだけでなく、開発者がプロジェクトのロジックを追いかけることが困難になってしまいます。通常のERBビューを使用してください。</p>
<p>インラインでは、デフォルトでERBを使用して出力を行います。<code>:type</code>オプションで:builderを指定すると、ERBに代えてBuilderが使用されます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render inline: "xml.p {'Horrid coding practice!'}", type: :builder

</pre>
</div>
<h5 id="テキストを出力する">2.2.7 テキストを出力する</h5>
<p><code>render</code>で<code>:plain</code>オプションを使用すると、平文テキストをマークアップせずにブラウザに送信することができます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render plain: "OK"

</pre>
</div>
<p>ヒント: 平文テキストの出力は、AjaxやWebサービスリクエストに応答するときに最も有用です。これらではHTML以外の応答を期待しています。</p>
<p>メモ: デフォルトでは、<code>:plain</code>オプションを使用すると出力結果に現在のレイアウトが適用されません。テキストの出力を現在のレイアウト内で行いたい場合は、<code>layout: true</code>オプションを追加する必要があります。</p>
<h5 id="htmlを出力する">2.2.8 HTMLを出力する</h5>
<p><code>render</code>で<code>:html</code>オプションを使用すると、HTML文字列を直接ブラウザに送信することができます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render html: "&lt;strong&gt;Not Found&lt;/strong&gt;".html_safe

</pre>
</div>
<p>ヒント: この手法は、HTMLコードのごく小規模なスニペットを出力したい場合に便利です。
スニペットのマークアップが複雑になるようであれば、早めにテンプレートファイルに移行することをご検討ください。</p>
<p>メモ: このオプションを使用すると、文字列が「HTML safe」でない場合にHTML要素をエスケープします。</p>
<h5 id="jsonを出力する">2.2.9 JSONを出力する</h5>
<p>JSONはJavaScriptのデータ形式の一種で、多くのAjaxライブラリで使用されています。Railsでは、オブジェクトからJSON形式への変換と、変換されたJSONをブラウザに送信する機能がビルトインでサポートされています。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render json: @product

</pre>
</div>
<p>ヒント: 出力するオブジェクトに対して<code>to_json</code>を呼び出す必要はありません。<code>:json</code>オプションが指定されていれば、<code>render</code>によって<code>to_json</code>が自動的に呼び出されるようになっています。</p>
<h5 id="xmlを出力する">2.2.10 XMLを出力する</h5>
<p>Railsでは、オブジェクトからXML形式への変換と、変換されたXMLをブラウザに送信する機能がビルトインでサポートされています。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render xml: @product

</pre>
</div>
<p>ヒント: 出力するオブジェクトに対して<code>to_xml</code>を呼び出す必要はありません。<code>:xml</code>オプションが指定されていれば、<code>render</code>によって<code>to_xml</code>が自動的に呼び出されるようになっています。</p>
<h5 id="vanilla-javascriptを出力する">2.2.11 Vanilla JavaScriptを出力する</h5>
<p>Railsはvanilla JavaScriptを出力することもできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render js: "alert('Hello Rails');"

</pre>
</div>
<p>上のコードは、引数で与えられた文字列をMIMEタイプ<code>text/javascript</code>でブラウザに送信します。</p>
<h5 id="生のコンテンツを出力する">2.2.12 生のコンテンツを出力する</h5>
<p><code>render</code>で<code>:body</code>オプションを指定することで、content typeを一切指定しない生のコンテンツをブラウザに送信することができます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render body: "raw"

</pre>
</div>
<p>ヒント: このオプションを使用するのは、レスポンスのcontent typeがどんなものであってもよい場合のみにしてください。ほとんどの場合、<code>:plain</code>や<code>:html</code>などを使用する方が適切です。</p>
<p>メモ: このオプションを使用してブラウザに送信されるレスポンスは、上書きされない限り<code>text/html</code>が使用されます。これはAction Dispatchによるレスポンスのデフォルトのcontent typeであるためです。</p>
<h5 id="renderのオプション">2.2.13 <code>render</code>のオプション</h5>
<p><code>render</code>メソッドに対する呼び出しでは、一般に以下の4つのオプションが使用できます。</p>
<ul>
<li><code>:content_type</code></li>
<li><code>:layout</code></li>
<li><code>:location</code></li>
<li><code>:status</code></li>
</ul>
<h6 id=":content_typeオプション">2.2.13.1 <code>:content_type</code>オプション</h6>
<p>Railsがデフォルトで出力する結果のMIME content-typeは、デフォルトで<code>text/html</code>になります (ただし<code>:json</code>を指定した場合には<code>application/json</code>、<code>:xml</code>を使用した場合は<code>application/xml</code>になります)。content-typeを変更したい場合は、<code>:content_type</code>オプションを指定します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render file: filename, content_type: "application/rss"

</pre>
</div>
<h6 id=":layoutオプション">2.2.13.2 <code>:layout</code>オプション</h6>
<p><code>render</code>で指定できるほとんどのオプションでは、出力されるコンテンツは現在のレイアウトの一部としてブラウザ上で表示されます。これより、レイアウトの詳細と利用法について本ガイドで説明します。</p>
<p><code>:layout</code>オプションを指定すると、現在のアクションに対して特定のファイルをレイアウトとして使用します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render layout: "special_layout"

</pre>
</div>
<p>出力時にレイアウトをまったく使用しないよう指定することもできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render layout: false

</pre>
</div>
<h6 id=":locationオプション">2.2.13.3 <code>:location</code>オプション</h6>
<p><code>:location</code>を使用することで、HTTPの<code>Location</code>ヘッダーを設定できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render xml: photo, location: photo_url(photo)

</pre>
</div>
<h6 id=":statusオプション">2.2.13.4 <code>:status</code>オプション</h6>
<p>Railsが返すレスポンスのHTTPステータスコードは自動的に生成されます (ほとんどの場合<code>200 OK</code>となります)。<code>:status</code>オプションを使用することで、レスポンスのステータスコードを変更できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render status: 500
render status: :forbidden

</pre>
</div>
<p>ステータスコードは数字で指定する他に、以下に示すシンボルで指定することもできます。</p>
<table>
<thead>
<tr>
<th>レスポンスクラス</th>
<th>HTTPステータスコード</th>
<th>シンボル</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Informational</strong></td>
<td>100</td>
<td>:continue</td>
</tr>
<tr>
<td></td>
<td>101</td>
<td>:switching_protocols</td>
</tr>
<tr>
<td></td>
<td>102</td>
<td>:processing</td>
</tr>
<tr>
<td><strong>Success</strong></td>
<td>200</td>
<td>:ok</td>
</tr>
<tr>
<td></td>
<td>201</td>
<td>:created</td>
</tr>
<tr>
<td></td>
<td>202</td>
<td>:accepted</td>
</tr>
<tr>
<td></td>
<td>203</td>
<td>:non_authoritative_information</td>
</tr>
<tr>
<td></td>
<td>204</td>
<td>:no_content</td>
</tr>
<tr>
<td></td>
<td>205</td>
<td>:reset_content</td>
</tr>
<tr>
<td></td>
<td>206</td>
<td>:partial_content</td>
</tr>
<tr>
<td></td>
<td>207</td>
<td>:multi_status</td>
</tr>
<tr>
<td></td>
<td>208</td>
<td>:already_reported</td>
</tr>
<tr>
<td></td>
<td>226</td>
<td>:im_used</td>
</tr>
<tr>
<td><strong>Redirection</strong></td>
<td>300</td>
<td>:multiple_choices</td>
</tr>
<tr>
<td></td>
<td>301</td>
<td>:moved_permanently</td>
</tr>
<tr>
<td></td>
<td>302</td>
<td>:found</td>
</tr>
<tr>
<td></td>
<td>303</td>
<td>:see_other</td>
</tr>
<tr>
<td></td>
<td>304</td>
<td>:not_modified</td>
</tr>
<tr>
<td></td>
<td>305</td>
<td>:use_proxy</td>
</tr>
<tr>
<td></td>
<td>306</td>
<td>:reserved</td>
</tr>
<tr>
<td></td>
<td>307</td>
<td>:temporary_redirect</td>
</tr>
<tr>
<td></td>
<td>308</td>
<td>:permanent_redirect</td>
</tr>
<tr>
<td><strong>Client Error</strong></td>
<td>400</td>
<td>:bad_request</td>
</tr>
<tr>
<td></td>
<td>401</td>
<td>:unauthorized</td>
</tr>
<tr>
<td></td>
<td>402</td>
<td>:payment_required</td>
</tr>
<tr>
<td></td>
<td>403</td>
<td>:forbidden</td>
</tr>
<tr>
<td></td>
<td>404</td>
<td>:not_found</td>
</tr>
<tr>
<td></td>
<td>405</td>
<td>:method_not_allowed</td>
</tr>
<tr>
<td></td>
<td>406</td>
<td>:not_acceptable</td>
</tr>
<tr>
<td></td>
<td>407</td>
<td>:proxy_authentication_required</td>
</tr>
<tr>
<td></td>
<td>408</td>
<td>:request_timeout</td>
</tr>
<tr>
<td></td>
<td>409</td>
<td>:conflict</td>
</tr>
<tr>
<td></td>
<td>410</td>
<td>:gone</td>
</tr>
<tr>
<td></td>
<td>411</td>
<td>:length_required</td>
</tr>
<tr>
<td></td>
<td>412</td>
<td>:precondition_failed</td>
</tr>
<tr>
<td></td>
<td>413</td>
<td>:request_entity_too_large</td>
</tr>
<tr>
<td></td>
<td>414</td>
<td>:request_uri_too_long</td>
</tr>
<tr>
<td></td>
<td>415</td>
<td>:unsupported_media_type</td>
</tr>
<tr>
<td></td>
<td>416</td>
<td>:requested_range_not_satisfiable</td>
</tr>
<tr>
<td></td>
<td>417</td>
<td>:expectation_failed</td>
</tr>
<tr>
<td></td>
<td>422</td>
<td>:unprocessable_entity</td>
</tr>
<tr>
<td></td>
<td>423</td>
<td>:locked</td>
</tr>
<tr>
<td></td>
<td>424</td>
<td>:failed_dependency</td>
</tr>
<tr>
<td></td>
<td>426</td>
<td>:upgrade_required</td>
</tr>
<tr>
<td></td>
<td>428</td>
<td>:precondition_required</td>
</tr>
<tr>
<td></td>
<td>429</td>
<td>:too_many_requests</td>
</tr>
<tr>
<td></td>
<td>431</td>
<td>:request_header_fields_too_large</td>
</tr>
<tr>
<td><strong>Server Error</strong></td>
<td>500</td>
<td>:internal_server_error</td>
</tr>
<tr>
<td></td>
<td>501</td>
<td>:not_implemented</td>
</tr>
<tr>
<td></td>
<td>502</td>
<td>:bad_gateway</td>
</tr>
<tr>
<td></td>
<td>503</td>
<td>:service_unavailable</td>
</tr>
<tr>
<td></td>
<td>504</td>
<td>:gateway_timeout</td>
</tr>
<tr>
<td></td>
<td>505</td>
<td>:http_version_not_supported</td>
</tr>
<tr>
<td></td>
<td>506</td>
<td>:variant_also_negotiates</td>
</tr>
<tr>
<td></td>
<td>507</td>
<td>:insufficient_storage</td>
</tr>
<tr>
<td></td>
<td>508</td>
<td>:loop_detected</td>
</tr>
<tr>
<td></td>
<td>510</td>
<td>:not_extended</td>
</tr>
<tr>
<td></td>
<td>511</td>
<td>:network_authentication_required</td>
</tr>
</tbody>
</table>
<h5 id="レイアウトの探索順序">2.2.14 レイアウトの探索順序</h5>
<p>Railsはが現在のレイアウトを探索する場合、最初に現在のコントローラと同じ基本名を持つレイアウトが<code>app/views/layouts</code>ディレクトリにあるかどうかを調べます。たとえば、<code>PhotosController</code>クラスのアクションから出力するのであれば、<code>app/views/layouts/photos.html.erb</code>または<code>app/views/layouts/photos.builder</code>を探します。該当のコントローラに属するレイアウトがない場合、<code>app/views/layouts/application.html.erb</code>または<code>app/views/layouts/application.builder</code>を使用します。<code>.erb</code>レイアウトがない場合、<code>.builder</code>レイアウトがあればそれを使用します。Railsには、各コントローラやアクションに割り当てる特定のレイアウトをもっと正確に指定する方法がいくつも用意されています。</p>
<h6 id="コントローラ用のレイアウトを指定する">2.2.14.1 コントローラ用のレイアウトを指定する</h6>
<p><code>layout</code>宣言を使用することで、デフォルトのレイアウト名ルールを上書きすることができます。例: </p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class ProductsController &lt; ApplicationController
  layout "inventory"
  #...
end

</pre>
</div>
<p>この宣言によって、<code>ProductsController</code>からの出力で使用されるレイアウトは<code>app/views/layouts/inventory.html.erb</code>になります。</p>
<p>アプリケーション全体で特定のレイアウトを使用したい場合は、<code>ApplicationController</code>クラスで<code>layout</code>を宣言します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class ApplicationController &lt; ActionController::Base
  layout "main"
  #...
end

</pre>
</div>
<p>この宣言によって、アプリケーションのすべてのビューで使用されるレイアウトは<code>app/views/layouts/main.html.erb</code>になります。</p>
<h6 id="実行時にレイアウトを指定する">2.2.14.2 実行時にレイアウトを指定する</h6>
<p>レイアウトの指定にシンボルを使用することで、リクエストが実際に処理されるときまでレイアウトを確定せず、選択を遅延することができます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class ProductsController &lt; ApplicationController
  layout :products_layout

  def show
    @product = Product.find(params[:id])
  end

  private
    def products_layout
      @current_user.special? ? "special" : "products"
    end

end

</pre>
</div>
<p>上のコードは、現在のユーザーが特別なユーザーの場合、そのユーザーが製品ページを見るときに特別なレイアウトを適用します。</p>
<p>レイアウトを決定する際に、Procなどのインラインメソッドを使用することもできます。たとえばProcオブジェクトを渡すと、Procを渡されたブロックには<code>controller</code>インスタンスが渡されます。これにより、現在のリクエストを元にしてレイアウトを決定することができます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class ProductsController &lt; ApplicationController
  layout Proc.new { |controller| controller.request.xhr? ? "popup" : "application" }
end

</pre>
</div>
<h6 id="条件付きレイアウト">2.2.14.3 条件付きレイアウト</h6>
<p>コントローラレベルで指定されたレイアウトでは、<code>:only</code>オプションと<code>:except</code>オプションがサポートされています。これらのオプションは、単一のメソッド名またはメソッド名の配列を引数として受け取ります。渡すメソッド名はコントローラ内のメソッド名に対応します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class ProductsController &lt; ApplicationController
  layout "product", except: [:index, :rss]
end

</pre>
</div>
<p>With this declaration, the <code>product</code> layout would be used for everything but the <code>rss</code> and <code>index</code> methods.</p>
<h6 id="layout-inheritance">2.2.14.4 Layout Inheritance</h6>
<p>Layout declarations cascade downward in the hierarchy, and more specific layout declarations always override more general ones. 例：</p>
<ul>
<li><code>application_controller.rb</code></li>
</ul>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class ApplicationController &lt; ActionController::Base
      layout "main"
  end
    ```

* `posts_controller.rb`

```ruby 
    class PostsController &lt; ApplicationController
  end
    ```

* `special_posts_controller.rb`

```ruby 
    class SpecialPostsController &lt; PostsController
      layout "special"
  end
    ```

* `old_posts_controller.rb`

```ruby 
    class OldPostsController &lt; SpecialPostsController
      layout false

  def show
        @post = Post.find(params[:id])
  end

  def index
        @old_posts = Post.older
        render layout: "old"
  end
      # ...
  end
    ```

In this application:

* In general, views will be rendered in the `main` layout
* `PostsController#index` will use the `main` layout
* `SpecialPostsController#index` will use the `special` layout
* `OldPostsController#show` will use no layout at all
* `OldPostsController#index` will use the `old` layout

#### Avoiding Double Render Errors

Sooner or later, most Rails developers will see the error message "Can only render or redirect once per action". While this is annoying, it's relatively easy to fix. Usually it happens because of a fundamental misunderstanding of the way that `render` works.

For example, here's some code that will trigger this error:

```ruby 
  def show
  @book = Book.find(params[:id])
  if @book.special?
    render action: "special_show"
  end
  render action: "regular_show"
  end

</pre>
</div>
<p>If <code>@book.special?</code> evaluates to <code>true</code>, Rails will start the rendering process to dump the <code>@book</code> variable into the <code>special_show</code> view. But this will <em>not</em> stop the rest of the code in the <code>show</code> action from running, and when Rails hits the end of the action, it will start to render the <code>regular_show</code> view - and throw an error. The solution is simple: make sure that you have only one call to <code>render</code> or <code>redirect</code> in a single code path. One thing that can help is <code>and return</code>. Here's a patched version of the method:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
  def show
  @book = Book.find(params[:id])
  if @book.special?
    render action: "special_show" and return
  end
  render action: "regular_show"
  end

</pre>
</div>
<p>Make sure to use <code>and return</code> instead of <code>&amp;&amp; return</code> because <code>&amp;&amp; return</code> will not work due to the operator precedence in the Ruby Language.</p>
<p>Note that the implicit render done by ActionController detects if <code>render</code> has been called, so the following will work without errors:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
  def show
  @book = Book.find(params[:id])
  if @book.special?
    render action: "special_show"
  end
  end

</pre>
</div>
<p>This will render a book with <code>special?</code> set with the <code>special_show</code> template, while other books will render with the default <code>show</code> template.</p>
<h4 id="using-redirect_to">2.3 Using <code>redirect_to</code>
</h4>
<p>Another way to handle returning responses to an HTTP request is with <code>redirect_to</code>. As you've seen, <code>render</code> tells Rails which view (or other asset) to use in constructing a response. The <code>redirect_to</code> method does something completely different: it tells the browser to send a new request for a different URL. For example, you could redirect from wherever you are in your code to the index of photos in your application with this call:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
redirect_to photos_url

</pre>
</div>
<p>You can use <code>redirect_to</code> with any arguments that you could use with <code>link_to</code> or <code>url_for</code>. There's also a special redirect that sends the user back to the page they just came from:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
      redirect_to :back

</pre>
</div>
<h5 id="getting-a-different-redirect-status-code">2.3.1 Getting a Different Redirect Status Code</h5>
<p>Rails uses HTTP status code 302, a temporary redirect, when you call <code>redirect_to</code>. If you'd like to use a different status code, perhaps 301, a permanent redirect, you can use the <code>:status</code> option:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
redirect_to photos_path, status: 301

</pre>
</div>
<p>Just like the <code>:status</code> option for <code>render</code>, <code>:status</code> for <code>redirect_to</code> accepts both numeric and symbolic header designations.</p>
<h5 id="the-difference-between-render-and-redirect_to">2.3.2 The Difference Between <code>render</code> and <code>redirect_to</code>
</h5>
<p>Sometimes inexperienced developers think of <code>redirect_to</code> as a sort of <code>goto</code> command, moving execution from one place to another in your Rails code. This is <em>not</em> correct. Your code stops running and waits for a new request for the browser. It just happens that you've told the browser what request it should make next, by sending back an HTTP 302 status code.</p>
<p>Consider these actions to see the difference:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
  def index
  @books = Book.all
  end

  def show
  @book = Book.find_by(id: params[:id])
  if @book.nil?
    render action: "index"
  end
  end

</pre>
</div>
<p>With the code in this form, there will likely be a problem if the <code>@book</code> variable is <code>nil</code>. Remember, a <code>render :action</code> doesn't run any code in the target action, so nothing will set up the <code>@books</code> variable that the <code>index</code> view will probably require. One way to fix this is to redirect instead of rendering:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
  def index
  @books = Book.all
  end

  def show
  @book = Book.find_by(id: params[:id])
  if @book.nil?
    redirect_to action: :index
  end
  end

</pre>
</div>
<p>With this code, the browser will make a fresh request for the index page, the code in the <code>index</code> method will run, and all will be well.</p>
<p>The only downside to this code is that it requires a round trip to the browser: the browser requested the show action with <code>/books/1</code> and the controller finds that there are no books, so the controller sends out a 302 redirect response to the browser telling it to go to <code>/books/</code>, the browser complies and sends a new request back to the controller asking now for the <code>index</code> action, the controller then gets all the books in the database and renders the index template, sending it back down to the browser which then shows it on your screen.</p>
<p>While in a small application, this added latency might not be a problem, it is something to think about if response time is a concern. We can demonstrate one way to handle this with a contrived example:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
  def index
  @books = Book.all
  end

  def show
  @book = Book.find_by(id: params[:id])
  if @book.nil?
    @books = Book.all
    flash.now[:alert] = "Your book was not found"
    render "index"
  end
  end

</pre>
</div>
<p>This would detect that there are no books with the specified ID, populate the <code>@books</code> instance variable with all the books in the model, and then directly render the <code>index.html.erb</code> template, returning it to the browser with a flash alert message to tell the user what happened.</p>
<h4 id="using-head-to-build-header-only-responses">2.4 Using <code>head</code> To Build Header-Only Responses</h4>
<p>The <code>head</code> method can be used to send responses with only headers to the browser. It provides a more obvious alternative to calling <code>render :nothing</code>. The <code>head</code> method accepts a number or symbol (see <a href="#the-status-option">reference table</a>) representing a HTTP status code. The options argument is interpreted as a hash of header names and values. For example, you can return only an error header:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
head :bad_request

</pre>
</div>
<p>This would produce the following header:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
HTTP/1.1 400 Bad Request
Connection: close
Date: Sun, 24 Jan 2010 12:15:53 GMT
Transfer-Encoding: chunked
Content-Type: text/html; charset=utf-8
X-Runtime: 0.013483
Set-Cookie: _blog_session=...snip...; path=/; HttpOnly
Cache-Control: no-cache

</pre>
</div>
<p>Or you can use other HTTP headers to convey other information:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
head :created, location: photo_path(@photo)

</pre>
</div>
<p>Which would produce:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
HTTP/1.1 201 Created
Connection: close
Date: Sun, 24 Jan 2010 12:16:44 GMT
Transfer-Encoding: chunked
Location: /photos/1
Content-Type: text/html; charset=utf-8
X-Runtime: 0.083496
Set-Cookie: _blog_session=...snip...; path=/; HttpOnly
Cache-Control: no-cache

</pre>
</div>
<h3 id="structuring-layouts">3 Structuring Layouts</h3>
<p>When Rails renders a view as a response, it does so by combining the view with the current layout, using the rules for finding the current layout that were covered earlier in this guide. Within a layout, you have access to three tools for combining different bits of output to form the overall response:</p>
<ul>
<li>Asset tags</li>
<li>
<code>yield</code> and <code>content_for</code>
</li>
<li>Partials</li>
</ul>
<h4 id="asset-tag-helpers">3.1 Asset Tag Helpers</h4>
<p>Asset tag helpers provide methods for generating HTML that link views to feeds, JavaScript, stylesheets, images, videos and audios. There are six asset tag helpers available in Rails:</p>
<ul>
<li><code>auto_discovery_link_tag</code></li>
<li>
<code>javascript_include_tag</code>
{0}&lt;%={/0} {1}stylesheet_link_tag{/1} {2}.{/2}{1}.{/1}{2}.{/2}</li>
<li><code>image_tag</code></li>
<li><code>video_tag</code></li>
<li><code>audio_tag</code></li>
</ul>
<p>You can use these tags in layouts or other views, although the <code>auto_discovery_link_tag</code>, <code>javascript_include_tag</code>, and <code>stylesheet_link_tag</code>, are most commonly used in the <code>&lt;head&gt;</code> section of a layout.</p>
<div class="warning"><p>The asset tag helpers do <em>not</em> verify the existence of the assets at the specified locations; they simply assume that you know what you're doing and generate the link.</p></div>
<h5 id="linking-to-feeds-with-the-auto_discovery_link_tag">3.1.1 Linking to Feeds with the <code>auto_discovery_link_tag</code>
</h5>
<p>The <code>auto_discovery_link_tag</code> helper builds HTML that most browsers and feed readers can use to detect the presence of RSS or Atom feeds. It takes the type of the link (<code>:rss</code> or <code>:atom</code>), a hash of options that are passed through to url_for, and a hash of options for the tag:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= auto_discovery_link_tag(:rss, {action: "feed"},
  {title: "RSS Feed"}) %&gt;
```</p>
<p>There are three tag options available for the <code>auto_discovery_link_tag</code>:</p>
<ul>
<li>
<code>:rel</code> specifies the <code>rel</code> value in the link. The default value is "alternate".</li>
<li>
<code>:type</code> specifies an explicit MIME type. Rails will generate an appropriate MIME type automatically.</li>
<li>
<code>:title</code> specifies the title of the link. The default value is the uppercase <code>:type</code> value, for example, "ATOM" or "RSS".</li>
</ul>
<h5 id="linking-to-javascript-files-with-the-javascript_include_tag">3.1.2 Linking to JavaScript Files with the <code>javascript_include_tag</code>
</h5>
<p>The <code>javascript_include_tag</code> helper returns an HTML <code>script</code> tag for each source provided.</p>
<p>If you are using Rails with the <a href="asset_pipeline.html">Asset Pipeline</a> enabled, this helper will generate a link to <code>/assets/javascripts/</code> rather than <code>public/javascripts</code> which was used in earlier versions of Rails. This link is then served by the asset pipeline.</p>
<p>A JavaScript file within a Rails application or Rails engine goes in one of three locations: <code>app/assets</code>, <code>lib/assets</code> or <code>vendor/assets</code>. These locations are explained in detail in the <a href="asset_pipeline.html#asset-organization">Asset Organization section in the Asset Pipeline Guide</a></p>
<p>You can specify a full path relative to the document root, or a URL, if you prefer. For example, to link to a JavaScript file that is inside a directory called <code>javascripts</code> inside of one of <code>app/assets</code>, <code>lib/assets</code> or <code>vendor/assets</code>, you would do this:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= javascript_include_tag "main" %&gt;
```</p>
<p>Rails will then output a <code>script</code> tag such as this:</p>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;script src='/assets/main.js'&gt;&lt;/script&gt;

</pre>
</div>
<p>The request to this asset is then served by the Sprockets gem.</p>
<p>To include multiple files such as <code>app/assets/javascripts/main.js</code> and <code>app/assets/javascripts/columns.js</code> at the same time:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= javascript_include_tag "main", "columns" %&gt;
```</p>
<p>To include <code>app/assets/javascripts/main.js</code> and <code>app/assets/javascripts/photos/columns.js</code>:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= javascript_include_tag "main", "/photos/columns" %&gt;
```</p>
<p>To include <code>http://example.com/main.js</code>:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= javascript_include_tag "<a href="http://example.com/main.js">http://example.com/main.js</a>" %&gt;
```</p>
<h5 id="linking-to-css-files-with-the-stylesheet_link_tag">3.1.3 Linking to CSS Files with the <code>stylesheet_link_tag</code>
</h5>
<p>The <code>stylesheet_link_tag</code> helper returns an HTML <code>&lt;link&gt;</code> tag for each source provided.</p>
<p>If you are using Rails with the "Asset Pipeline" enabled, this helper will generate a link to <code>/assets/stylesheets/</code>. This link is then processed by the Sprockets gem. A stylesheet file can be stored in one of three locations: <code>app/assets</code>, <code>lib/assets</code> or <code>vendor/assets</code>.</p>
<p>You can specify a full path relative to the document root, or a URL. For example, to link to a stylesheet file that is inside a directory called <code>stylesheets</code> inside of one of <code>app/assets</code>, <code>lib/assets</code> or <code>vendor/assets</code>, you would do this:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= stylesheet_link_tag "main" %&gt;
```</p>
<p>To include <code>app/assets/stylesheets/main.css</code> and <code>app/assets/stylesheets/columns.css</code>:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= stylesheet_link_tag "main", "columns" %&gt;
```</p>
<p>To include <code>app/assets/stylesheets/main.css</code> and <code>app/assets/stylesheets/photos/columns.css</code>:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= stylesheet_link_tag "main", "photos/columns" %&gt;
```</p>
<p>To include <code>http://example.com/main.css</code>:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= stylesheet_link_tag "<a href="http://example.com/main.css">http://example.com/main.css</a>" %&gt;
```</p>
<p>By default, the <code>stylesheet_link_tag</code> creates links with <code>media="screen" rel="stylesheet"</code>. You can override any of these defaults by specifying an appropriate option (<code>:media</code>, <code>:rel</code>):</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= stylesheet_link_tag "main_print", media: "print" %&gt;
```</p>
<h5 id="linking-to-images-with-the-image_tag">3.1.4 Linking to Images with the <code>image_tag</code>
</h5>
<p>The <code>image_tag</code> helper builds an HTML <code>&lt;img /&gt;</code> tag to the specified file. By default, files are loaded from <code>public/images</code>.</p>
<div class="warning"><p>Note that you must specify the extension of the image.</p></div>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= image_tag "header.png" %&gt;
```</p>
<p>You can supply a path to the image if you like:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= image_tag "icons/delete.gif" %&gt;
```</p>
<p>You can supply a hash of additional HTML options:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= image_tag "icons/delete.gif", {height: 45} %&gt;
```</p>
<p>You can supply alternate text for the image which will be used if the user has images turned off in their browser. If you do not specify an alt text explicitly, it defaults to the file name of the file, capitalized and with no extension. For example, these two image tags would return the same code:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= image_tag "home.gif" %&gt;
&lt;%= image_tag "home.gif", alt: "Home" %&gt;
```</p>
<p>You can also specify a special size tag, in the format "{width}x{height}":</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= image_tag "home.gif", size: "50x20" %&gt;
```</p>
<p>In addition to the above special tags, you can supply a final hash of standard HTML options, such as <code>:class</code>, <code>:id</code> or <code>:name</code>:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= image_tag "home.gif", alt: "Go Home",
                          id: "HomeImage",
                          class: "nav_bar" %&gt;
```</p>
<h5 id="linking-to-videos-with-the-video_tag">3.1.5 Linking to Videos with the <code>video_tag</code>
</h5>
<p>The <code>video_tag</code> helper builds an HTML 5 <code>&lt;video&gt;</code> tag to the specified file. By default, files are loaded from <code>public/videos</code>.</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= video_tag "movie.ogg" %&gt;
```</p>
<p>Produces</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p><video src="/videos/movie.ogg"></video>
```</p>
<p>Like an <code>image_tag</code> you can supply a path, either absolute, or relative to the <code>public/videos</code> directory. Additionally you can specify the <code>size: "#{width}x#{height}"</code> option just like an <code>image_tag</code>. Video tags can also have any of the HTML options specified at the end (<code>id</code>, <code>class</code> et al).</p>
<p>The video tag also supports all of the <code>&lt;video&gt;</code> HTML options through the HTML options hash, including:</p>
<ul>
<li>
<code>poster: "image_name.png"</code>, provides an image to put in place of the video before it starts playing.</li>
<li>
<code>autoplay: true</code>, starts playing the video on page load.</li>
<li>
<code>loop: true</code>, loops the video once it gets to the end.</li>
<li>
<code>controls: true</code>, provides browser supplied controls for the user to interact with the video.</li>
<li>
<code>autobuffer: true</code>, the video will pre load the file for the user on page load.</li>
</ul>
<p>You can also specify multiple videos to play by passing an array of videos to the <code>video_tag</code>:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= video_tag ["trailer.ogg", "movie.ogg"] %&gt;
```</p>
<p>This will produce:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p><video><source src="trailer.ogg"></source><source src="movie.ogg"></source></video>
```</p>
<h5 id="linking-to-audio-files-with-the-audio_tag">3.1.6 Linking to Audio Files with the <code>audio_tag</code>
</h5>
<p>The <code>audio_tag</code> helper builds an HTML 5 <code>&lt;audio&gt;</code> tag to the specified file. By default, files are loaded from <code>public/audios</code>.</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= audio_tag "music.mp3" %&gt;
```</p>
<p>You can supply a path to the audio file if you like:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= audio_tag "music/first_song.mp3" %&gt;
```</p>
<p>You can also supply a hash of additional options, such as <code>:id</code>, <code>:class</code> etc.</p>
<p>Like the <code>video_tag</code>, the <code>audio_tag</code> has special options:</p>
<ul>
<li>
<code>autoplay: true</code>, starts playing the audio on page load</li>
<li>
<code>controls: true</code>, provides browser supplied controls for the user to interact with the audio.</li>
<li>
<code>autobuffer: true</code>, the audio will pre load the file for the user on page load.</li>
</ul>
<h4 id="understanding-yield">3.2 Understanding <code>yield</code>
</h4>
<p>Within the context of a layout, <code>yield</code> identifies a section where content from the view should be inserted. The simplest way to use this is to have a single <code>yield</code>, into which the entire contents of the view currently being rendered is inserted:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;html&gt;
&lt;head&gt;
&lt;/head&gt;
  &lt;body&gt;
{0}&lt;%={/0} {1}yield{/1} {0}%&gt;{/0}
  &lt;/body&gt;
&lt;/html&gt; 

</pre>
</div>
<p>You can also create a layout with multiple yielding regions:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;html&gt;
&lt;head&gt;
  &lt;%= yield :head %&gt;
&lt;/head&gt;
  &lt;body&gt;
{0}&lt;%={/0} {1}yield{/1} {0}%&gt;{/0}
  &lt;/body&gt;
&lt;/html&gt; 

</pre>
</div>
<p>The main body of the view will always render into the unnamed <code>yield</code>. To render content into a named <code>yield</code>, you use the <code>content_for</code> method.</p>
<h4 id="using-the-content_for-method">3.3 Using the <code>content_for</code> Method</h4>
<p>The <code>content_for</code> method allows you to insert content into a named <code>yield</code> block in your layout. For example, this view would work with the layout that you just saw:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;% content_for :head do %&gt;
  &lt;title&gt;A simple page&lt;/title&gt;
&lt;% end %&gt;

&lt;p&gt;Hello, Rails!&lt;/p&gt;

</pre>
</div>
<p>The result of rendering this page into the supplied layout would be this HTML:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;A simple page&lt;/title&gt;
&lt;/head&gt;
  &lt;body&gt;
  &lt;p&gt;Hello, Rails!&lt;/p&gt;
{0} {/0}{1}&lt;/body&gt;{/1}
&lt;/html&gt; 

</pre>
</div>
<p>The <code>content_for</code> method is very helpful when your layout contains distinct regions such as sidebars and footers that should get their own blocks of content inserted. It's also useful for inserting tags that load page-specific JavaScript or css files into the header of an otherwise generic layout.</p>
<h4 id="using-partials">3.4 Using Partials</h4>
<p>Partial templates - usually just called "partials" - are another device for breaking the rendering process into more manageable chunks. With a partial, you can move the code for rendering a particular piece of a response to its own file.</p>
<h5 id="naming-partials">3.4.1 Naming Partials</h5>
<p>To render a partial as part of a view, you use the <code>render</code> method within the view:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&lt;%= render "menu" %&gt;

</pre>
</div>
<p>This will render a file named <code>_menu.html.erb</code> at that point within the view being rendered. Note the leading underscore character: partials are named with a leading underscore to distinguish them from regular views, even though they are referred to without the underscore. This holds true even when you're pulling in a partial from another folder:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&lt;%= render "shared/menu" %&gt;

</pre>
</div>
<p>That code will pull in the partial from <code>app/views/shared/_menu.html.erb</code>.</p>
<h5 id="using-partials-to-simplify-views">3.4.2 Using Partials to Simplify Views</h5>
<p>One way to use partials is to treat them as the equivalent of subroutines: as a way to move details out of a view so that you can grasp what's going on more easily. For example, you might have a view that looked like this:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= render "shared/ad_banner" %&gt;</p>
<h1>Products</h1>

<p>Here are a few of our fine products:</p>
<p>...</p>
<p>&lt;%= render "shared/footer" %&gt;
```</p>
<p>Here, the <code>_ad_banner.html.erb</code> and <code>_footer.html.erb</code> partials could contain content that is shared among many pages in your application. You don't need to see the details of these sections when you're concentrating on a particular page.</p>
<div class="info"><p>For content that is shared among all pages in your application, you can use partials directly from layouts.</p></div>
<h5 id="partial-layouts">3.4.3 Partial Layouts</h5>
<p>A partial can use its own layout file, just as a view can use a layout. For example, you might call a partial like this:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= render partial: "link_area", layout: "graybar" %&gt;
```</p>
<p>This would look for a partial named <code>_link_area.html.erb</code> and render it using the layout <code>_graybar.html.erb</code>. Note that layouts for partials follow the same leading-underscore naming as regular partials, and are placed in the same folder with the partial that they belong to (not in the master <code>layouts</code> folder).</p>
<p>Also note that explicitly specifying <code>:partial</code> is required when passing additional options such as <code>:layout</code>.</p>
<h5 id="passing-local-variables">3.4.4 Passing Local Variables</h5>
<p>You can also pass local variables into partials, making them even more powerful and flexible. For example, you can use this technique to reduce duplication between new and edit pages, while still keeping a bit of distinct content:</p>
<ul>
<li><code>new.html.erb</code></li>
</ul>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
    &lt;h1&gt;New zone&lt;/h1&gt;
    &lt;%= render partial: "form", locals: {zone: @zone} %&gt;
    ```

* `edit.html.erb`

```html+erb
    &lt;h1&gt;Editing zone&lt;/h1&gt;
    &lt;%= render partial: "form", locals: {zone: @zone} %&gt;
    ```

* `_form.html.erb`

```html+erb
    &lt;%= form_for(zone) do |f| %&gt;
      &lt;p&gt;
        &lt;b&gt;Zone name&lt;/b&gt;&lt;br&gt;
{0}&lt;%={/0} {1}f{/1}{2}.{/2}{1}text_field{/1} {3}:name{/3} {0}%&gt;{/0}
&lt;/p&gt;
  &lt;p&gt;
    &lt;%= f.submit %&gt;
&lt;/p&gt;
&lt;% end %&gt;
    ```

Although the same partial will be rendered into both views, Action View's submit helper will return "Create Zone" for the new action and "Update Zone" for the edit action.

Every partial also has a local variable with the same name as the partial (minus the underscore). You can pass an object in to this local variable via the `:object` option:

    ```erb
&lt;%= render partial: "customer", object: @new_customer %&gt;

</pre>
</div>
<p>Within the <code>customer</code> partial, the <code>customer</code> variable will refer to <code>@new_customer</code> from the parent view.</p>
<p>If you have an instance of a model to render into a partial, you can use a shorthand syntax:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= render @customer %&gt;
```</p>
<p>Assuming that the <code>@customer</code> instance variable contains an instance of the <code>Customer</code> model, this will use <code>_customer.html.erb</code> to render it and will pass the local variable <code>customer</code> into the partial which will refer to the <code>@customer</code> instance variable in the parent view.</p>
<h5 id="rendering-collections">3.4.5 Rendering Collections</h5>
<p>Partials are very useful in rendering collections. When you pass a collection to a partial via the <code>:collection</code> option, the partial will be inserted once for each member in the collection:</p>
<ul>
<li><code>index.html.erb</code></li>
</ul>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
    &lt;h1&gt;Products&lt;/h1&gt;
    &lt;%= render partial: "product", collection: @products %&gt;
    ```

* `_product.html.erb`

```html+erb
    &lt;p&gt;Product Name: &lt;%= product.name %&gt;&lt;/p&gt;
    ```

When a partial is called with a pluralized collection, then the individual instances of the partial have access to the member of the collection being rendered via a variable named after the partial. In this case, the partial is `_product`, and within the `_product` partial, you can refer to `product` to get the instance that is being rendered.

There is also a shorthand for this. Assuming `@products` is a collection of `product` instances, you can simply write this in the `index.html.erb` to produce the same result:

```html+erb
&lt;h1&gt;Products&lt;/h1&gt;
&lt;%= render @products %&gt;

</pre>
</div>
<p>Rails determines the name of the partial to use by looking at the model name in the collection. In fact, you can even create a heterogeneous collection and render it this way, and Rails will choose the proper partial for each member of the collection:</p>
<ul>
<li><code>index.html.erb</code></li>
</ul>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
    &lt;h1&gt;Contacts&lt;/h1&gt;
    &lt;%= render [customer1, employee1, customer2, employee2] %&gt;
    ```

* `customers/_customer.html.erb`

```html+erb
    &lt;p&gt;Customer: &lt;%= customer.name %&gt;&lt;/p&gt;
    ```

* `employees/_employee.html.erb`

```html+erb
    &lt;p&gt;Employee: &lt;%= employee.name %&gt;&lt;/p&gt;
    ```

In this case, Rails will use the customer or employee partials as appropriate for each member of the collection.

In the event that the collection is empty, `render` will return nil, so it should be fairly simple to provide alternative content.

```html+erb
&lt;h1&gt;Products&lt;/h1&gt;
&lt;%= render(@products) || "There are no products available." %&gt;

</pre>
</div>
<h5 id="local-variables">3.4.6 Local Variables</h5>
<p>To use a custom local variable name within the partial, specify the <code>:as</code> option in the call to the partial:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= render partial: "product", collection: @products, as: :item %&gt;
```</p>
<p>With this change, you can access an instance of the <code>@products</code> collection as the <code>item</code> local variable within the partial.</p>
<p>You can also pass in arbitrary local variables to any partial you are rendering with the <code>locals: {}</code> option:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= render partial: "product", collection: @products,
           as: :item, locals: {title: "Products Page"} %&gt;
```</p>
<p>In this case, the partial will have access to a local variable <code>title</code> with the value "Products Page".</p>
<div class="info"><p>Rails also makes a counter variable available within a partial called by the collection, named after the member of the collection followed by <code>_counter</code>. For example, if you're rendering <code>@products</code>, within the partial you can refer to <code>product_counter</code> to tell you how many times the partial has been rendered. This does not work in conjunction with the <code>as: :value</code> option.</p></div>
<p>You can also specify a second partial to be rendered between instances of the main partial by using the <code>:spacer_template</code> option:</p>
<h5 id="spacer-templates">3.4.7 Spacer Templates</h5>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= render partial: @products, spacer_template: "product_ruler" %&gt;
```</p>
<p>Rails will render the <code>_product_ruler</code> partial (with no data passed in to it) between each pair of <code>_product</code> partials.</p>
<h5 id="collection-partial-layouts">3.4.8 Collection Partial Layouts</h5>
<p>When rendering collections it is also possible to use the <code>:layout</code> option:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
```erb

</pre>
</div>
<p>&lt;%= render partial: "product", collection: @products, layout: "special_layout" %&gt;
```</p>
<p>The layout will be rendered together with the partial for each item in the collection. The current object and object_counter variables will be available in the layout as well, the same way they do within the partial.</p>
<h4 id="using-nested-layouts">3.5 Using Nested Layouts</h4>
<p>You may find that your application requires a layout that differs slightly from your regular application layout to support one particular controller. Rather than repeating the main layout and editing it, you can accomplish this by using nested layouts (sometimes called sub-templates). 下が例です：</p>
<p>Suppose you have the following <code>ApplicationController</code> layout:</p>
<ul>
<li><code>app/views/layouts/application.html.erb</code></li>
</ul>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;html&gt;
&lt;head&gt;
      &lt;title&gt;&lt;%= @page_title or "Page Title" %&gt;&lt;/title&gt;
      &lt;%= stylesheet_link_tag "layout" %&gt;
      &lt;style&gt;&lt;%= yield :stylesheets %&gt;&lt;/style&gt;
&lt;/head&gt;
  &lt;body&gt;
      &lt;div id="top_menu"&gt;Top menu items here&lt;/div&gt;
      &lt;div id="menu"&gt;Menu items here&lt;/div&gt;
      &lt;div id="content"&gt;&lt;%= content_for?(:content) ? yield(:content) : yield %&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt; 
    ```

On pages generated by `NewsController`, you want to hide the top menu and add a right menu:

* `app/views/layouts/news.html.erb`

```html+erb
    &lt;% content_for :stylesheets do %&gt;
      #top_menu {display: none}
      #right_menu {float: right; background-color: yellow; color: black}
&lt;% end %&gt;
    &lt;% content_for :content do %&gt;
      &lt;div id="right_menu"&gt;Right menu items here&lt;/div&gt;
      &lt;%= content_for?(:news_content) ? yield(:news_content) : yield %&gt;
&lt;% end %&gt;
    &lt;%= render template: "layouts/application" %&gt;
    ```

これだけなんです。The News views will use the new layout, hiding the top menu and adding a new right menu inside the "content" div.

There are several ways of getting similar results with different sub-templating schemes using this technique. Note that there is no limit in nesting levels. One can use the `ActionView::render` method via `render template: 'layouts/news'` to base a new layout on the News layout. If you are sure you will not subtemplate the `News` layout, you can replace the `content_for?(:news_content) ? yield(:news_content) : yield` with simply `yield`.

</pre>
</div>
</body></html>


        <h3>フィードバックについて</h3>
        <p>
          本ガイドの訳文およびソースコードは、GitHub上の <a href="https://github.com/yasslab/railsguides.jp">yasslab/railsguides.jp</a> で管理・公開されております。
	  本ガイドを読んで、誤字・脱字・誤訳などを見かけましたら、上記リポジトリにてお気軽に <a href="https://github.com/yasslab/railsguides.jp/issues">Issue</a> を出して頂けると大変嬉しいです。また、「Pull Request を送りたい!」という場合には、<a href="ruby_on_rails_guides_guidelines.html">Ruby on Railsガイドのガイドライン</a>と、<a href="https://github.com/yasslab/railsguides.jp#%E7%BF%BB%E8%A8%B3%E3%81%AE%E6%B5%81%E3%82%8C">README</a>に記載されている「翻訳の流れ」をご参考にしてください。
	</p>
	<p>
	  なお、原著レベルでの間違いを見つけましたら、原著へのフィードバック方法 (<a href="http://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">documentation contributions</a>) をご参考にしてください。
        </p>
        <p>
	  本ガイドの品質向上に向けて、皆さまのご協力が得られれば幸いです。よろしくお願い致します。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <ul class="snsb" style="margin-left: 13px">
      <li><a href="http://www.railscp.org/text/" target="_blank"><img src="images/railscp_logo.png" width="150px"/></a></li>
    </ul>
    <ul class="snsb" style="margin-left: 13px">
      <li><a href="http://b.hatena.ne.jp/entry/railsguides.jp" class="hatena-bookmark-button" data-hatena-bookmark-title="Ruby on Rails ガイド：Rails 開発のお供に! 日本語版 Rails リファレンスガイド (Rails 4.1 対応)" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script></li>
      <li><div class="fb-like" data-href="http://railsguides.jp/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div></li>
      <li><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://railsguides.jp/" data-text="Ruby on Rails ガイド：Rails 開発のお供に! 日本語版 Rails リファレンスガイド (Rails 4.1 対応)" data-lang="ja" data-hashtags="railsguidesjp">ツイート</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></li>
    </ul>

    <div class="wrapper">
      <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-Share Alike 3.0</a> License</p>
<p>"Rails", "Ruby on Rails", and the Rails logo are trademarks of David Heinemeier Hansson. All rights reserved.</p>

    </div>
  </div>

  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all();
    $(guidesIndex.bind);
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
    ga('create', 'UA-50163209-4', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
