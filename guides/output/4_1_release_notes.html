<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Ruby on Rails Guides</title>
<link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />

<link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

<link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
</head>
<body class="guide">
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">他の情報源: </strong>
      <span class="red-button more-info-button">
        他の情報源
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="http://guides.rubyonrails.org/">原著 (英語)</a></li>
        <li class="more-info"><a href="https://github.com/yasslab/railsguides.jp">ソースコード(GitHub)</a></li>
        <li class="more-info"><a href="http://railstutorial.jp/">Railsチュートリアル</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="/" title="Return to home page">railsguides.jp</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">ホーム</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">ガイド目次</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>はじめに</dt>
                <dd><a href="getting_started.html">Railsをはじめよう</a></dd>
                <dt>モデル</dt>
                <dd><a href="active_record_basics.html">Active Recordの基礎</a></dd>
                <dd><a href="active_record_migrations.html">Active Recordとマイグレーション (※翻訳中)</a></dd>
                <dd><a href="active_record_validations.html">Active Record検証機能 (バリデーション)</a></dd>
                <dd><a href="active_record_callbacks.html">Active Recordコールバック</a></dd>
                <dd><a href="association_basics.html">Active Recordの関連付け (アソシエーション)</a></dd>
                <dd><a href="active_record_querying.html">Active Recordクエリインターフェイス</a></dd>
                <dt>ビュー</dt>
                <dd><a href="layouts_and_rendering.html">ビューのレイアウトとレンダリング (※翻訳中)</a></dd>
                <dd><a href="form_helpers.html">Action Viewフォームヘルパー</a></dd>
                <dt>コントローラ</dt>
                <dd><a href="action_controller_overview.html">Action Controllerの概要</a></dd>
                <dd><a href="routing.html">Railsのルーティング (※翻訳中)</a></dd>
              </dl>
              <dl class="R">
                <dt>高度なトピック</dt>
                <dd><a href="active_support_core_extensions.html">Active Supportコア拡張機能</a></dd>
                <dd><a href="i18n.html">Rails国際化(I18n) API</a></dd>
                <dd><a href="action_mailer_basics.html">Action Mailerの基礎 (未着手)</a></dd>
                <dd><a href="active_job_basics.html">Active Jobの基礎 (未着手)</a></dd>
                <dd><a href="security.html">Ruby on Railsセキュリティガイド</a></dd>
                <dd><a href="debugging_rails_applications.html">Railsアプリケーションのデバッグ (未着手)</a></dd>
                <dd><a href="configuring.html">Railsアプリケーションを設定する</a></dd>
                <dd><a href="command_line.html">コマンドラインツールとRakeタスク (未着手)</a></dd>
                <dd><a href="asset_pipeline.html">アセットパイプライン (未着手)</a></dd>
                <dd><a href="working_with_javascript_in_rails.html">RailsでJavaScriptを使用する (未着手)</a></dd>
                <dt>Railsを拡張する</dt>
                <dd><a href="rails_on_rack.html">Rackに乗ったRails (未着手)</a></dd>
                <dd><a href="generators.html">Railsジェネレータの作成とカスタマイズ (未着手)</a></dd>
                <dt>Ruby on Railsに貢献する</dt>
                <dd><a href="contributing_to_ruby_on_rails.html">Ruby on Railsへの貢献方法 (未着手)</a></dd>
                <dd><a href="api_documentation_guidelines.html">APIドキュメントの書き方 (未着手)</a></dd>
                <dd><a href="ruby_on_rails_guides_guidelines.html">Ruby on Railsガイドのガイドライン</a></dd>
                <dt>メンテナンスポリシー</dt>
                <dd><a href="maintenance_policy.html">メンテナンスポリシー (未着手)</a></dd>
                <dt>リリースノート</dt>
                <dd><a href="upgrading_ruby_on_rails.html">Ruby on Railsアップグレードガイド</a></dd>
                <dd><a href="4_1_release_notes.html">Ruby on Rails 4.1リリースノート</a></dd>
                <dd><a href="4_0_release_notes.html">Ruby on Rails 4.0リリースノート (未着手)</a></dd>
                <dd><a href="3_2_release_notes.html">Ruby on Rails 3.2リリースノート (未着手)</a></dd>
                <dd><a href="3_1_release_notes.html">Ruby on Rails 3.1リリースノート (未着手)</a></dd>
                <dd><a href="3_0_release_notes.html">Ruby on Rails 3.0リリースノート (未着手)</a></dd>
                <dd><a href="2_3_release_notes.html">Ruby on Rails 2.3リリースノート (未着手)</a></dd>
                <dd><a href="2_2_release_notes.html">Ruby on Rails 2.2リリースノート (未着手)</a></dd>
              </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">貢献方法</a></li>
        <li><a class="nav-item" href="credits.html">原著者</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">ガイド目次</option>
              <optgroup label="はじめに">
                  <option value="getting_started.html">Railsをはじめよう</option>
              </optgroup>
              <optgroup label="モデル">
                  <option value="active_record_basics.html">Active Recordの基礎</option>
                  <option value="active_record_migrations.html">Active Recordとマイグレーション (※翻訳中)</option>
                  <option value="active_record_validations.html">Active Record検証機能 (バリデーション)</option>
                  <option value="active_record_callbacks.html">Active Recordコールバック</option>
                  <option value="association_basics.html">Active Recordの関連付け (アソシエーション)</option>
                  <option value="active_record_querying.html">Active Recordクエリインターフェイス</option>
              </optgroup>
              <optgroup label="ビュー">
                  <option value="layouts_and_rendering.html">ビューのレイアウトとレンダリング (※翻訳中)</option>
                  <option value="form_helpers.html">Action Viewフォームヘルパー</option>
              </optgroup>
              <optgroup label="コントローラ">
                  <option value="action_controller_overview.html">Action Controllerの概要</option>
                  <option value="routing.html">Railsのルーティング (※翻訳中)</option>
              </optgroup>
              <optgroup label="高度なトピック">
                  <option value="active_support_core_extensions.html">Active Supportコア拡張機能</option>
                  <option value="i18n.html">Rails国際化(I18n) API</option>
                  <option value="action_mailer_basics.html">Action Mailerの基礎 (未着手)</option>
                  <option value="active_job_basics.html">Active Jobの基礎 (未着手)</option>
                  <option value="security.html">Ruby on Railsセキュリティガイド</option>
                  <option value="debugging_rails_applications.html">Railsアプリケーションのデバッグ (未着手)</option>
                  <option value="configuring.html">Railsアプリケーションを設定する</option>
                  <option value="command_line.html">コマンドラインツールとRakeタスク (未着手)</option>
                  <option value="asset_pipeline.html">アセットパイプライン (未着手)</option>
                  <option value="working_with_javascript_in_rails.html">RailsでJavaScriptを使用する (未着手)</option>
              </optgroup>
              <optgroup label="Railsを拡張する">
                  <option value="rails_on_rack.html">Rackに乗ったRails (未着手)</option>
                  <option value="generators.html">Railsジェネレータの作成とカスタマイズ (未着手)</option>
              </optgroup>
              <optgroup label="Ruby on Railsに貢献する">
                  <option value="contributing_to_ruby_on_rails.html">Ruby on Railsへの貢献方法 (未着手)</option>
                  <option value="api_documentation_guidelines.html">APIドキュメントの書き方 (未着手)</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Ruby on Railsガイドのガイドライン</option>
              </optgroup>
              <optgroup label="メンテナンスポリシー">
                  <option value="maintenance_policy.html">メンテナンスポリシー (未着手)</option>
              </optgroup>
              <optgroup label="リリースノート">
                  <option value="upgrading_ruby_on_rails.html">Ruby on Railsアップグレードガイド</option>
                  <option value="4_1_release_notes.html">Ruby on Rails 4.1リリースノート</option>
                  <option value="4_0_release_notes.html">Ruby on Rails 4.0リリースノート (未着手)</option>
                  <option value="3_2_release_notes.html">Ruby on Rails 3.2リリースノート (未着手)</option>
                  <option value="3_1_release_notes.html">Ruby on Rails 3.1リリースノート (未着手)</option>
                  <option value="3_0_release_notes.html">Ruby on Rails 3.0リリースノート (未着手)</option>
                  <option value="2_3_release_notes.html">Ruby on Rails 2.3リリースノート (未着手)</option>
                  <option value="2_2_release_notes.html">Ruby on Rails 2.2リリースノート (未着手)</option>
              </optgroup>
          </select>
        </li>
      </ul>
      </div>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      
                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<ol class="chapters">
<li><a href="#a77d82b66afaf69db86db157bea30553f41bade6">Rails 4.1へのアップグレード</a></li>
<li>
<a href="#bb42c86592fe15c0b4b824e81c617fe229813e05">主要な変更</a>

<ul>
<li><a href="#5baaaaea00a5a3e2cd5817522ab4379491ead882">「Spring」アプリケーションプリローダー</a></li>
<li><a href="#9257f2d2a6401206ac4de16332b9e93c63a84a86"><code>config/secrets.yml</code></a></li>
<li><a href="#9b8796c7816560773d7312159a1cfde6c4347cc0">Action Pack Variant</a></li>
<li><a href="#8e63dab24eadf9fe44d0d6de5efdefc2b6d3374a">Active Record enums</a></li>
<li><a href="#93398096d01d7e47e1c80c5935b0cba19be27ef3">メッセージベリファイア</a></li>
<li><a href="#fac72f314e42896683165258872b2eb3d877aaf4">Module#concerning</a></li>
<li><a href="#34b83418b9085323de7f623c8d4d7c79c7646a23">リモート <code>&lt;script&gt;</code> タグにCSRF保護を実施</a></li>
</ul>
</li>
<li>
<a href="#fbebdc2e6aa9105b0260297b8a88b5252aaeedf6">Railties</a>

<ul>
<li><a href="#fbebdc2e6aa9105b0260297b8a88b5252aaeedf6-9531648a25e24d596c150245849b929dcda07049">削除されたもの</a></li>
<li><a href="#fbebdc2e6aa9105b0260297b8a88b5252aaeedf6-fb2fba87dbdb0924b42c39367cdc848e4cff62a2">主な変更点</a></li>
<li><a href="#c5076d1d9c9e2d6c7f5de326d5574c9892ec272e">Action Pack</a></li>
<li><a href="#fbebdc2e6aa9105b0260297b8a88b5252aaeedf6-9531648a25e24d596c150245849b929dcda07049">削除されたもの</a></li>
<li><a href="#fbebdc2e6aa9105b0260297b8a88b5252aaeedf6-fb2fba87dbdb0924b42c39367cdc848e4cff62a2">主な変更点</a></li>
</ul>
</li>
<li>
<a href="#3c10227d539b6d0c0a09cc6df0b1a05ad130ee12">Action Mailer</a>

<ul>
<li><a href="#3c10227d539b6d0c0a09cc6df0b1a05ad130ee12-fb2fba87dbdb0924b42c39367cdc848e4cff62a2">主な変更点</a></li>
</ul>
</li>
<li>
<a href="#c56ace212803860c39af85632d205438bc84aece">Active Record</a>

<ul>
<li><a href="#c56ace212803860c39af85632d205438bc84aece-9531648a25e24d596c150245849b929dcda07049">削除されたもの</a></li>
<li><a href="#c56ace212803860c39af85632d205438bc84aece-59b1c03d62d9e0f176827408dbda6e0f3b95e531">非推奨</a></li>
<li><a href="#c56ace212803860c39af85632d205438bc84aece-fb2fba87dbdb0924b42c39367cdc848e4cff62a2">主な変更点</a></li>
</ul>
</li>
<li>
<a href="#c47e7615c4671aca979fd45eedb5701c89db3922">Active Model</a>

<ul>
<li><a href="#c47e7615c4671aca979fd45eedb5701c89db3922-59b1c03d62d9e0f176827408dbda6e0f3b95e531">非推奨</a></li>
<li><a href="#c47e7615c4671aca979fd45eedb5701c89db3922-fb2fba87dbdb0924b42c39367cdc848e4cff62a2">主な変更点</a></li>
</ul>
</li>
<li>
<a href="#83d7ddd8135d4147fd05e436fcfd1766471aa123">Active Support</a>

<ul>
<li><a href="#83d7ddd8135d4147fd05e436fcfd1766471aa123-9531648a25e24d596c150245849b929dcda07049">削除されたもの</a></li>
<li><a href="#59b1c03d62d9e0f176827408dbda6e0f3b95e531">非推奨</a></li>
<li><a href="#83d7ddd8135d4147fd05e436fcfd1766471aa123-fb2fba87dbdb0924b42c39367cdc848e4cff62a2">主な変更点</a></li>
</ul>
</li>
<li><a href="#e3c342ffbee5e40f6dee978ebb19260a5f8c12d4">クレジット表記</a></li>
</ol>
</body></html>

          </div>
</div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h2>Ruby on Rails 4.1リリースノート</h2>
<p>Rails 4.1の注目ポイント</p>
<ul>
<li>アプリケーションプリローダーSpring</li>
<li><code>config/secrets.yml</code></li>
<li>Action Packのバリアント</li>
<li>Action Mailerプレビュー</li>
</ul>
<p>本リリースノートでは、主要な変更についてのみ説明します。細かなバグ修正や変更については、change logを参照するか、Githubの主要なRailsリポジトリにある<a href="https://github.com/rails/rails/commits/master">コミットリスト</a> を参照してください</p>
<hr>
<h3 id="a77d82b66afaf69db86db157bea30553f41bade6">1 Rails 4.1へのアップグレード</h3>
<p>既存のアプリケーションをアップグレードするのであれば、その前に質のよいテストカバレッジを用意するのがよい考えです。アプリケーションがRails 4.0までアップグレードされていない場合は先にそれを完了し、アプリケーションが正常に動作することを十分確認してからRails 4.1にアップデートしてください。アップグレードの注意点などについては<a href="upgrading_ruby_on_rails.html#upgrading-from-rails-4-0-to-rails-4-1">Ruby on Railsアップグレードガイド</a> を参照してください。</p>
<h3 id="bb42c86592fe15c0b4b824e81c617fe229813e05">2 主要な変更</h3>
<h4 id="5baaaaea00a5a3e2cd5817522ab4379491ead882">2.1 「Spring」アプリケーションプリローダー</h4>
<p>SpringはRailsアプリケーション用のプリローダーです。アプリケーションをバックグラウンドで常駐させることで開発速度を向上させ、テストやrakeタスク、マイグレーションを実行するたびにRailsを起動しないで済むようにします。</p>
<p>Rails 4.1アプリケーションに含まれるbinstubは「spring化」されています。これは、アプリケーションのルートディレクトリで<code>bin/rails</code>および<code>bin/rake</code>を実行すると自動的にspring環境をプリロードするということです。</p>
<p><strong>rakeタスクの実行:</strong></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
bin/rake test:models

</pre>
</div>
<p><strong>RRailsコマンドの実行:</strong></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
bin/rails console

</pre>
</div>
<p><strong>Springの状態確認:</strong></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
$ bin/spring status
Spring is running:

1182 spring server | my_app | started 29 mins ago
3656 spring app    | my_app | started 23 secs ago | test mode
3746 spring app    | my_app | started 10 secs ago | development mode

</pre>
</div>
<p>Springのすべての機能については<a href="https://github.com/rails/spring/blob/master/README.md">Spring README</a>を参照してください。</p>
<p><a href="upgrading_ruby_on_rails.html#spring">Ruby on Railsアップグレードガイド</a>には、この機能を既存のアプリケーションと統合する方法について記載されています。</p>
<h4 id="9257f2d2a6401206ac4de16332b9e93c63a84a86">2.2 <code>config/secrets.yml</code>
</h4>
<p>Rails 4.1 generates a new <code>secrets.yml</code> file in the <code>config</code> folder. デフォルトでは、このファイルにはアプリケーションの<code>secret_key_base</code>が含まれていますが、外部API用のアクセスキーなどの秘密キーもここに保存できます。</p>
<p>このファイルに保存された秘密キーは<code>Rails.application.secrets</code>を使用してアクセスできます。
たとえば、以下の<code>config/secrets.yml</code>について見てみましょう。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
development:
  secret_key_base: 3b7cd727ee24e8444053437c36cc66c3
  some_api_key: SOMEKEY

</pre>
</div>
<p>上の設定にした場合、development環境で<code>Rails.application.secrets.some_api_key</code>を実行すると<code>SOMEKEY</code>が返されます。</p>
<p>既存のアプリケーションにこの機能を統合する方法については<a href="upgrading_ruby_on_rails.html#config-secrets-yml">Ruby on Railsアップグレードガイド</a>を参照してください。</p>
<h4 id="9b8796c7816560773d7312159a1cfde6c4347cc0">2.3 Action Pack Variant</h4>
<p>スマートフォン、タブレット、デスクトップブラウザごとに異なるHTML/JSON/XMLテンプレートを使いたいことはよくあります。Variantを使用することで、これを簡単に実現できます。</p>
<p>リクエストvariantは、<code>:tablet</code>、<code>:phone</code>、<code>:desktop</code>のようなリクエストフォーマットを特殊化したものです。</p>
<p><code>before_action</code>で以下のvariantを設定できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
request.variant = :tablet if request.user_agent =~ /iPad/

</pre>
</div>
<p>アクションの側では、フォーマットへの応答と同じ要領でvariantに応答します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
respond_to do |format|
  format.html do |html|
    html.tablet # renders app/views/projects/show.html+tablet.erb
    html.phone { extra_setup; render ... }
  end
end

</pre>
</div>
<p>フォーマットごと、variantごとに個別のテンプレートを用意してください。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
app/views/projects/show.html.erb
app/views/projects/show.html+tablet.erb
app/views/projects/show.html+phone.erb

</pre>
</div>
<p>以下のようなインライン文法を使用することで、variant定義を簡略化することもできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
respond_to do |format|
  format.js         { render "trash" }
  format.html.phone { redirect_to progress_path }
  format.html.none  { render "trash" }
end

</pre>
</div>

<ul>
<li>Action Mailerプレビュー</li>
</ul>
<p>Action Mailerプレビューは、特定のURLにアクセスすることで、送信されるメールがどんなふうに見えるかをレンダリングしてプレビューします。</p>
<p>チェックしたいメールオブジェクトを返すメソッドを持つプレビュークラスを定義してください。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class NotifierPreview &lt; ActionMailer::Preview
  def welcome
    Notifier.welcome(User.first)
  end
end

</pre>
</div>
<p>プレビューを表示するには <a href="http://localhost:3000/rails/mailers/notifier/welcome">http://localhost:3000/rails/mailers/notifier/welcome</a> にアクセスします。プレビューのリストは <a href="http://localhost:3000/rails/mailers">http://localhost:3000/rails/mailers</a> にあります。</p>
<p>デフォルトのプレビュークラスは<code>test/mailers/previews</code>に置かれます。
<code>preview_path</code>オプションを変更することでこれを変更できます。</p>
<p>詳細については<a href="http://api.rubyonrails.org/v4.1.0/classes/ActionMailer/Base.html">ドキュメント</a>を参照してください。</p>
<h4 id="8e63dab24eadf9fe44d0d6de5efdefc2b6d3374a">2.4 Active Record enums</h4>
<p>データベースで値をintegerにマップしたい場所でenum属性を宣言しますが、名前でクエリを発行することもできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Conversation &lt; ActiveRecord::Base
  enum status: [ :active, :archived ]
end

conversation.archived!
conversation.active? # =&gt; false
conversation.status  # =&gt; "archived"

Conversation.archived # =&gt; Relation for all archived Conversations

Conversation.statuses # =&gt; { "active" =&gt; 0, "archived" =&gt; 1 }

</pre>
</div>
<p>詳細については<a href="http://api.rubyonrails.org/v4.1.0/classes/ActiveRecord/Enum.html">マニュアル</a>を参照してください。</p>
<h4 id="93398096d01d7e47e1c80c5935b0cba19be27ef3">2.5 メッセージベリファイア</h4>
<p>メッセージベリファイア (message verifier) は、署名付きメッセージの生成と照合に使用できます。この機能は、「パスワードを保存 (remember me)」トークンや友人リストのような機密データを安全に転送するときに便利です。</p>
<p><code>Rails.application.message_verifier</code>メソッドは、 secret_key_baseを使用して生成されたキーで署名された新しいメッセージベリファイアと、与えられたメッセージ照合名を返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
signed_token = Rails.application.message_verifier(:remember_me).generate(token)
Rails.application.message_verifier(:remember_me).verify(signed_token) # =&gt; token

Rails.application.message_verifier(:remember_me).verify(tampered_token)
# ActiveSupport::MessageVerifier::InvalidSignatureをはっせいする

</pre>
</div>
<h4 id="fac72f314e42896683165258872b2eb3d877aaf4">2.6 Module#concerning</h4>
<p>自然かつ堅苦しくない方法で、クラスから責任を分離します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Todo &lt; ActiveRecord::Base
  concerning :EventTracking do
    included do
      has_many :events
    end

    def latest_event
      ...
    end

    private
      def some_internal_method
        ...
      end
  end
end

</pre>
</div>
<p>この例は、<code>EventTracking</code>モジュールをインラインで定義し、<code>ActiveSupport::Concern</code>でextendし、<code>Todo</code>クラスにミックスインしたのと同等です。</p>
<p>詳細および想定されるユースケースについては<a href="http://api.rubyonrails.org/v4.1.0/classes/Module/Concerning.html">マニュアル</a> を参照してください。</p>
<h4 id="34b83418b9085323de7f623c8d4d7c79c7646a23">2.7 リモート <code>&lt;script&gt;</code> タグにCSRF保護を実施</h4>
<p>JavaScriptレスポンスを伴うGETリクエストもクロスサイトリクエストフォージェリ (CSRF) 保護の対象となりました。この保護によって、第三者のサイトが重要なデータの奪取のために自分のサイトのJavaScript URLを参照して実行しようとすることを防止します。</p>
<p>これは、xhr<code>を使用しない場合、</code>.js<code>URLにヒットするすべてのテストはCSRF保護によって失敗するということです。</code>XmlHttpRequestsを明示的に想定するようにテストをアップグレードしてください。<code>post :create, format: :js</code>の代りに、明示的に<code>xhr :post, :create, format: :js</code>を使用してください。</p>
<h3 id="fbebdc2e6aa9105b0260297b8a88b5252aaeedf6">3 Railties</h3>
<p>変更の詳細については<a href="https://github.com/rails/rails/blob/4-1-stable/railties/CHANGELOG.md">Changelog</a> を参照してください。</p>
<h4 id="fbebdc2e6aa9105b0260297b8a88b5252aaeedf6-9531648a25e24d596c150245849b929dcda07049">3.1 削除されたもの</h4>
<ul>
<li><p><code>update:application_controller</code> rake taskが削除されました。</p></li>
<li><p>非推奨の<code>Rails.application.railties.engines</code>が除外されました。</p></li>
<li><p>非推奨の<code>threadsafe!</code>がRails Configから削除されました。</p></li>
<li><p>非推奨の<code>ActiveRecord::Generators::ActiveModel#update_attributes</code>が削除されました。<code>ActiveRecord::Generators::ActiveModel#update</code>をご使用ください。</p></li>
<li><p>非推奨の<code>config.whiny_nils</code>オプションが削除されました。</p></li>
<li><p>非推奨のテスト実行rakeタスク<code>rake test:uncommitted</code>および<code>rake test:recent</code>が削除されました。</p></li>
</ul>
<h4 id="fbebdc2e6aa9105b0260297b8a88b5252aaeedf6-fb2fba87dbdb0924b42c39367cdc848e4cff62a2">3.2 主な変更点</h4>
<ul>
<li><p><a href="https://github.com/rails/spring">Springアプリケーションプリローダー</a> は新規アプリケーションにデフォルトでインストールされます。Gemfileのdevelopグループにインストールされ、productionグループにはインストールされません。(<a href="https://github.com/rails/rails/pull/12958">Pull Request</a>)</p></li>
<li><p>テスト失敗時にフィルタされていないバックトレースを表示する<code>BACKTRACE</code>環境変数。(<a href="https://github.com/rails/rails/commit/84eac5dab8b0fe9ee20b51250e52ad7bfea36553">Commit</a>)</p></li>
<li><p><code>MiddlewareStack#unshift</code>が環境構成用に公開されました。(<a href="https://github.com/rails/rails/pull/12479">Pull Request</a>)</p></li>
<li><p>メッセージベリファイアを返す<code>Application#message_verifier</code>メソッド。(<a href="https://github.com/rails/rails/pull/12995">Pull Request</a>)</p></li>
<li><p>デフォルトで生成されるテストヘルパーでrequireされる<code>test_help.rb</code>ファイルは、<code>db/schema.rb</code> (または <code>db/structure.sql</code>) を使用して自動的にテストデータベースを最新の状態に保ちます。スキーマを再度読み込んでもペンディング中のマイグレーションをすべて解決できなかった場合はエラーが発生します。<code>config.active_record.maintain_test_schema = false</code>を指定することでエラーを回避できます。(<a href="https://github.com/rails/rails/pull/13528">Pull Request</a>)</p></li>
<li><p><code>Gem::Version.new(Rails.version)</code>を返す便利なメソッドとして<code>Rails.gem_version</code>が導入されました。より信頼できるバージョン比較法を提供します。(<a href="https://github.com/rails/rails/pull/14103">Pull Request</a>)</p></li>
</ul>
<h4 id="c5076d1d9c9e2d6c7f5de326d5574c9892ec272e">3.3 Action Pack</h4>
<hr>
<p>変更の詳細については<a href="https://github.com/rails/rails/blob/4-1-stable/actionpack/CHANGELOG.md">Changelog</a> を参照してください。</p>
<h4 id="fbebdc2e6aa9105b0260297b8a88b5252aaeedf6-9531648a25e24d596c150245849b929dcda07049">3.4 削除されたもの</h4>
<ul>
<li><p>非推奨の、結合テスト用Railsアプリケーションフォールバックが削除されました。<code>ActionDispatch.test_app</code>を代りにご使用ください。</p></li>
<li><p>非推奨の<code>page_cache_extension</code> configが削除されました。</p></li>
<li><p>非推奨の<code>ActionController::RecordIdentifier</code>が削除されました。<code>ActionView::RecordIdentifier</code>を代りにご使用ください。</p></li>
<li><p>以下の非推奨の定数がAction Controllerから削除されました。</p></li>
</ul>
<p>  | 削除された                            | 今後使用する                       |
  |:-----------------------------------|:--------------------------------|
  | ActionController::AbstractRequest  | ActionDispatch::Request         |
  | ActionController::Request          | ActionDispatch::Request         |
  | ActionController::AbstractResponse | ActionDispatch::Response        |
  | ActionController::Response         | ActionDispatch::Response        |
  | ActionController::Routing          | ActionDispatch::Routing         |
  | ActionController::Integration      | ActionDispatch::Integration     |
  | ActionController::IntegrationTest  | ActionDispatch::IntegrationTest |</p>
<h4 id="fbebdc2e6aa9105b0260297b8a88b5252aaeedf6-fb2fba87dbdb0924b42c39367cdc848e4cff62a2">3.5 主な変更点</h4>
<ul>
<li><p><code>protect_from_forgery</code>によって、クロスオリジン<code>&lt;script&gt;</code>タグも使用できなくなりました。テストをアップデートして、 <code>get :foo, format: :js</code>の代りに<code>xhr :get, :foo, format: :js</code>を使うようにしてください。(<a href="https://github.com/rails/rails/pull/13345">Pull Request</a>)</p></li>
<li><p><code>#url_for</code>は、オプションのハッシュを配列の中で使用できるようになりました。(<a href="https://github.com/rails/rails/pull/9599">Pull Request</a>)</p></li>
<li><p><code>session#fetch</code>メソッドが追加されました。この振る舞いは<a href="http://www.ruby-doc.org/core-1.9.3/Hash.html#method-i-fetch">Hash#fetch</a>と似ていますが、返し値が常にセッションに保存される点が異なります。(<a href="https://github.com/rails/rails/pull/12692">Pull Request</a>)</p></li>
<li><p>Action ViewはAction Packから完全に分離されました。(<a href="https://github.com/rails/rails/pull/11032">Pull Request</a>)</p></li>
<li><p>deep_mungeに影響されているキーがログ出力されるようになりました。(<a href="https://github.com/rails/rails/pull/13813">Pull Request</a>)</p></li>
<li><p>セキュリティ脆弱性CVE-2013-0155に対応するため、パラメータのdeep_munge化を回避する<code>config.action_dispatch.perform_deep_munge</code>configオプションが新たに追加されました。(<a href="https://github.com/rails/rails/pull/13188">Pull Request</a>)</p></li>
<li><p>署名及び暗号化されたcookies jarのシリアライザを指定する<code>config.action_dispatch.cookies_serializer</code>configオプションが新たに追加されました。 (Pull Requests <a href="https://github.com/rails/rails/pull/13692">1</a>, <a href="https://github.com/rails/rails/pull/13945">2</a> / <a href="upgrading_ruby_on_rails.html#cookies-serializer">詳細</a>)</p></li>
<li><p><code>render :plain</code>、<code>render :html</code>、<code>render :body</code>が追加されました。(<a href="https://github.com/rails/rails/pull/14062">Pull Request</a> / <a href="upgrading_ruby_on_rails.html#rendering-content-from-string">詳細</a>)</p></li>
</ul>
<h3 id="3c10227d539b6d0c0a09cc6df0b1a05ad130ee12">4 Action Mailer</h3>
<p>変更の詳細については<a href="https://github.com/rails/rails/blob/4-1-stable/actionmailer/CHANGELOG.md">Changelog</a> を参照してください。</p>
<h4 id="3c10227d539b6d0c0a09cc6df0b1a05ad130ee12-fb2fba87dbdb0924b42c39367cdc848e4cff62a2">4.1 主な変更点</h4>
<ul>
<li><p>37 Signals社のmail_view gemを元にメイラーのプレビュー機能が追加されました。(<a href="https://github.com/rails/rails/commit/d6dec7fcb6b8fddf8c170182d4fe64ecfc7b2261">Commit</a>)</p></li>
<li><p>Action Mailerメッセージの生成が計測されるようになりました。メッセージを生成するのにかかった時間がログに記録されます。(<a href="https://github.com/rails/rails/pull/12556">Pull Request</a>)</p></li>
</ul>
<h3 id="c56ace212803860c39af85632d205438bc84aece">5 Active Record</h3>
<p>変更の詳細については<a href="https://github.com/rails/rails/blob/4-1-stable/activerecord/CHANGELOG.md">Changelog</a> を参照してください。</p>
<h4 id="c56ace212803860c39af85632d205438bc84aece-9531648a25e24d596c150245849b929dcda07049">5.1 削除されたもの</h4>
<ul>
<li><p><code>SchemaCache</code>メソッド (<code>primary_keys</code>、<code>tables</code>、<code>columns</code>、<code>columns_hash</code>) にnilを渡す非推奨機能が削除されました。</p></li>
<li><p>非推奨のブロックフィルタが<code>ActiveRecord::Migrator#migrate</code>から削除されました。</p></li>
<li><p>非推奨のStringコンストラクタが<code>ActiveRecord::Migrator</code>から削除されました。</p></li>
<li><p><code>scope</code>で呼び出し可能オブジェクトを渡さない用法が削除されました。</p></li>
<li><p>非推奨の<code>transaction_joinable=</code>が削除されました。<code>:joinable</code>オプション付きで<code>begin_transaction</code>をお使いください。</p></li>
<li><p>非推奨の<code>decrement_open_transactions</code>が削除されました。</p></li>
<li><p>非推奨の<code>increment_open_transactions</code>が削除されました。</p></li>
<li><p>非推奨の<code>PostgreSQLAdapter#outside_transaction?</code>メソッドが削除されました。代りに<code>#transaction_open?</code>をお使いください。</p></li>
<li><p>非推奨の<code>ActiveRecord::Fixtures.find_table_name</code>が削除されました。<code>ActiveRecord::Fixtures.default_fixture_model_name</code>をお使いください。</p></li>
<li><p>非推奨の<code>columns_for_remove</code>が<code>SchemaStatements</code>削除されました。</p></li>
<li><p>非推奨の<code>SchemaStatements#distinct</code>が削除されました。</p></li>
<li><p>非推奨の<code>ActiveRecord::TestCase</code>がRailsテストスイートに移動しました。このクラスはpublicでなくなり、Railsテストの内部でのみ使用されます。</p></li>
<li><p>関連付けの<code>:dependent</code>で、非推奨の<code>:restrict</code>オプションのサポートが削除されました。</p></li>
<li><p>関連付けにおいて、非推奨の<code>:delete_sql</code>、<code>:insert_sql</code>、<code>:finder_sql</code>、<code>:counter_sql</code>オプションが削除されました。</p></li>
<li><p>Columnから非推奨の<code>type_cast_code</code>が削除されました。</p></li>
<li><p>非推奨の<code>ActiveRecord::Base#connection</code>メソッドが削除されました。このメソッドにはクラス経由でアクセスするようにしてください。</p></li>
<li><p><code>auto_explain_threshold_in_seconds</code>における非推奨の警告が削除されました。</p></li>
<li><p><code>Relation#count</code>から非推奨の<code>:distinct</code>オプションが削除されました。</p></li>
<li><p>非推奨の<code>partial_updates</code>、<code>partial_updates?</code>、<code>partial_updates=</code>が削除されました。</p></li>
<li><p>非推奨の<code>scoped</code>メソッドが削除されました。</p></li>
<li><p>非推奨の<code>default_scopes?</code>が削除されました。</p></li>
<li><p>4.0で非推奨だった、暗黙の結合参照が削除されました。</p></li>
<li><p>依存関係としての<code>activerecord-deprecated_finders</code>が削除されました。詳細については<a href="https://github.com/rails/activerecord-deprecated_finders#active-record-deprecated-finders">gem README</a>を参照してください。</p></li>
<li><p><code>implicit_readonly</code>の用法が削除されました。明示的に<code>readonly</code>メソッドを使用してレコードを<code>readonly</code>に設定してください。(<a href="https://github.com/rails/rails/pull/10769">Pull Request</a>)</p></li>
</ul>
<h4 id="c56ace212803860c39af85632d205438bc84aece-59b1c03d62d9e0f176827408dbda6e0f3b95e531">5.2 非推奨</h4>
<ul>
<li><p><code>quoted_locking_column</code>メソッドは非推奨です。現在使われている場所はありません。</p></li>
<li><p><code>ConnectionAdapters::SchemaStatements#distinct</code>は内部で使用されなくなったため非推奨です。(<a href="https://github.com/rails/rails/pull/10556">Pull Request</a>)</p></li>
<li><p><code>rake db:test:*</code>タスクは非推奨となりました。データベースは自動的にメンテナンスされます。railtiesのリリースノートを参照してください。(<a href="https://github.com/rails/rails/pull/13528">Pull Request</a>)</p></li>
<li><p>使用されていない<code>ActiveRecord::Base.symbolized_base_class</code>、および置き換えのない<code>ActiveRecord::Base.symbolized_sti_name</code>は非推奨になりました。<a href="https://github.com/rails/rails/commit/97e7ca48c139ea5cce2fa9b4be631946252a1ebd">Commit</a></p></li>
</ul>
<h4 id="c56ace212803860c39af85632d205438bc84aece-fb2fba87dbdb0924b42c39367cdc848e4cff62a2">5.3 主な変更点</h4>
<p>デフォルトのスコープは、条件を連鎖した場合にオーバーライドされなくなりました。</p>
<p>  今回の変更より前にモデルで<code>default_scope</code>を定義していた場合、同じフィールドで条件が連鎖している場合にはオーバーライドされていました。現在は、他のスコープと同様、マージされるようになりました。<a href="upgrading_ruby_on_rails.html#changes-on-default-scopes">詳細</a></p>
<ul>
<li><p>モデルの属性やメソッドから派生する便利な "pretty" URL用に<code>ActiveRecord::Base.to_param</code>が追加されました。(<a href="https://github.com/rails/rails/pull/12891">Pull Request</a>)</p></li>
<li><p><code>ActiveRecord::Base.no_touching</code>が追加されました。モデルへのタッチを無視します。(<a href="https://github.com/rails/rails/pull/12772">Pull Request</a>)</p></li>
<li><p><code>MysqlAdapter</code>および<code>Mysql2Adapter</code>における型変換の真偽値が統一されました。<code>type_cast</code>は<code>true</code>の場合に<code>1を、</code>false<code>の場合に</code>2`を返します。(<a href="https://github.com/rails/rails/pull/12425">Pull Request</a>)</p></li>
<li><p><code>.unscope</code>を指定すると<code>default_scope</code>で指定された条件が削除されます。(<a href="https://github.com/rails/rails/commit/94924dc32baf78f13e289172534c2e71c9c8cade">Commit</a>)</p></li>
<li><p><code>ActiveRecord::QueryMethods#rewhere</code>が追加されました。既存の名前付きwhere条件をオーバーライドします。(<a href="https://github.com/rails/rails/commit/f950b2699f97749ef706c6939a84dfc85f0b05f2">Commit</a>)</p></li>
<li><p><code>ActiveRecord::Base#cache_key</code>が拡張され、timestamp属性のリストをオプションで取れるようになりました。timestamp属性リストのうち最大値が使用されます。(<a href="https://github.com/rails/rails/commit/e94e97ca796c0759d8fcb8f946a3bbc60252d329">Commit</a>)</p></li>
<li><p>enum属性を宣言する<code>ActiveRecord::Base#enum</code>が追加されました。enum属性はデータベースのintegerにマップされますが、名前でクエリできます。(<a href="https://github.com/rails/rails/commit/db41eb8a6ea88b854bf5cd11070ea4245e1639c5">Commit</a>)</p></li>
<li><p>json値が書き込み時に型変換されます。これにより値がデータベースからの読み出し時と一貫します。(<a href="https://github.com/rails/rails/pull/12643">Pull Request</a>)</p></li>
<li><p>hstore値が書き込み時に型変換されます。これにより値がデータベースからの読み出し時と一致します。(<a href="https://github.com/rails/rails/commit/5ac2341fab689344991b2a4817bd2bc8b3edac9d">Commit</a>)</p></li>
<li><p>サードパーティ製ジェネレータ用に、<code>next_migration_number</code>がアクセス可能になりました。(<a href="https://github.com/rails/rails/pull/12407">Pull Request</a>)</p></li>
<li><p>引数を<code>nil</code>にして<code>update_attributes</code>を呼び出すと、常に<code>ArgumentError</code>エラーが発生します。具体的には、渡された引数が<code>stringify_keys</code>に応答しない場合にエラーが発生します。(<a href="https://github.com/rails/rails/pull/9860">Pull Request</a>)</p></li>
<li><p><code>CollectionAssociation#first</code>/<code>#last</code> (<code>has_many</code>など) による結果の取り出しで、コレクション全体を読み出すクエリの代りに、限定的なクエリが使用されるようになりました。(<a href="https://github.com/rails/rails/pull/12137">Pull Request</a>)</p></li>
<li><p>Active Recordモデルクラスの<code>inspect</code>は新しい接続を初期化しなくなりました。つまり、データベースが見つからない状態で<code>inspect</code>を呼び出した場合に例外を発生しなくなりました。(<a href="https://github.com/rails/rails/pull/11014">Pull Request</a>)</p></li>
<li><p><code>count</code>のカラム制約が削除されました。SQLが無効な場合にはデータベース側でraiseされます。(<a href="https://github.com/rails/rails/pull/10710">Pull Request</a>)</p></li>
<li><p>Railsが逆関連付けを自動で検出するようになりました。関連付けで<code>:inverse_of</code>オプションを設定していない場合、Active Recordはヒューリスティックに逆関連付けを推測します。(<a href="https://github.com/rails/rails/pull/10886">Pull Request</a>)</p></li>
<li><p>ActiveRecord::Relationの属性のエイリアスを扱うようになりました。シンボルキーを使用すると、ActiveRecordはエイリアス化された属性名をデータベース上の実際のカラム名に翻訳します。(<a href="https://github.com/rails/rails/pull/7839">Pull Request</a>)</p></li>
<li><p>フィクスチャーのERBファイルはメインオブジェクトのコンテキストでは評価されなくなりました。複数のフィクスチャーで使用されているヘルパーメソッドは、<code>ActiveRecord::FixtureSet.context_class</code>でインクルードされるモジュール上で定義しておく必要があります。(<a href="https://github.com/rails/rails/pull/13022">Pull Request</a>)</p></li>
<li><p>RAILS_ENVが明示的に指定されている場合はテストデータベースのcreateやdropは行いません。(<a href="https://github.com/rails/rails/pull/13629">Pull Request</a>)</p></li>
</ul>
<p><code>Relation</code>には<code>#map!</code>や<code>#delete_if</code>などのミューテーターメソッド (mutator method) が含まれなくなりました。これらのメソッドを使用したい場合は<code>#to_a</code>を呼び出して<code>Array</code>に変更してからにしてください。(<a href="https://github.com/rails/rails/pull/13314">Pull Request</a>)</p>
<ul>
<li><p><code>find_in_batches</code>、<code>find_each</code>、<code>Result#each</code> and <code>Enumerable#index_by</code>は、自身のサイズを計算可能な<code>Enumerator</code>を返すようになりました。(<a href="https://github.com/rails/rails/pull/13938">Pull Request</a>)</p></li>
<li><p><code>scope</code>、<code>enum</code>とAssociationsで "dangerous" 名前衝突が発生するようになりました。(<a href="https://github.com/rails/rails/pull/13450">Pull Request</a>, <a href="https://github.com/rails/rails/pull/13896">Pull Request</a>)</p></li>
<li><p><code>second</code>から<code>fifth</code>メソッドは<code>first</code>ファインダーと同様に動作します。(<a href="https://github.com/rails/rails/pull/13757">Pull Request</a>)</p></li>
<li><p><code>touch</code>が<code>after_commit</code>と<code>after_rollback</code>コールバックを発火するようになりました。(<a href="https://github.com/rails/rails/pull/12031">Pull Request</a>)</p></li>
<li><p><code>sqlite &gt;= 3.8.0</code>でのパーシャルインデックスが有効になりました。(<a href="https://github.com/rails/rails/pull/13350">Pull Request</a>)</p></li>
<li><p><code>change_column_null</code>が復元可能になりました。(<a href="https://github.com/rails/rails/commit/724509a9d5322ff502aefa90dd282ba33a281a96">Commit</a>)</p></li>
<li><p>マイグレーション後無効になったスキーマダンプにフラグが追加されました。これは新しいアプリケーションのproduction環境ではデフォルトで<code>false</code>に設定されます。(<a href="https://github.com/rails/rails/pull/13948">Pull Request</a>)</p></li>
</ul>
<h3 id="c47e7615c4671aca979fd45eedb5701c89db3922">6 Active Model</h3>
<p>変更の詳細については<a href="https://github.com/rails/rails/blob/4-1-stable/activemodel/CHANGELOG.md">Changelog</a> を参照してください。</p>
<h4 id="c47e7615c4671aca979fd45eedb5701c89db3922-59b1c03d62d9e0f176827408dbda6e0f3b95e531">6.1 非推奨</h4>
<ul>
<li>
<code>Validator#setup</code>は非推奨です。今後はバリデーターのコンストラクタ内で手動で行なう必要があります。(<a href="https://github.com/rails/rails/commit/7d84c3a2f7ede0e8d04540e9c0640de7378e9b3a">Commit</a>)</li>
</ul>
<h4 id="c47e7615c4671aca979fd45eedb5701c89db3922-fb2fba87dbdb0924b42c39367cdc848e4cff62a2">6.2 主な変更点</h4>
<ul>
<li><p><code>ActiveModel::Dirty</code>に、状態を制御する新しいAPI<code>reset_changes</code> および<code>changes_applied</code>が追加されました。</p></li>
<li><p>検証の定義時に複数のコンテキストを指定できるようになりました。(<a href="https://github.com/rails/rails/pull/13754">Pull Request</a>)</p></li>
<li><p><code>attribute_changed?</code>がハッシュを受け付けるようになり、属性が与えられた値<code>に</code>変更されたか(または与えられた値<code>から</code>変更されたか)どうかをチェックするようになりました。(<a href="https://github.com/rails/rails/pull/13131">Pull Request</a>)</p></li>
</ul>
<h3 id="83d7ddd8135d4147fd05e436fcfd1766471aa123">7 Active Support</h3>
<p>変更の詳細については<a href="https://github.com/rails/rails/blob/4-1-stable/activesupport/CHANGELOG.md">Changelog</a> を参照してください。</p>
<h4 id="83d7ddd8135d4147fd05e436fcfd1766471aa123-9531648a25e24d596c150245849b929dcda07049">7.1 削除されたもの</h4>
<ul>
<li><p><code>MultiJSON</code>依存が削除されました。これにより、<code>ActiveSupport::JSON.decode</code>は<code>MultiJSON</code>のオプションハッシュを受け付けなくなりました。(<a href="https://github.com/rails/rails/pull/10576">Pull Request</a> / <a href="upgrading_ruby_on_rails.html#changes-in-json-handling">詳細</a>)</p></li>
<li><p>カスタムオブジェクトをJSONにエンコードする<code>encode_json</code>フックのサポートが削除されました。この機能は<a href="https://github.com/rails/activesupport-json_encoder">activesupport-json_encoder</a> gemに書き出されました。
この機能は<a href="https://github.com/rails/activesupport-json_encoder">activesupport-json_encoder</a> gemに書き出されました。</p></li>
<li><p>非推奨の<code>ActiveSupport::JSON::Variable</code>が代替なしで削除されました。</p></li>
<li><p>非推奨の<code>String#encoding_aware?</code>コアエクステンション (<code>core_ext/string/encoding</code>) が削除されました。</p></li>
<li><p>非推奨の<code>Module#local_constant_names</code>が削除されました。<code>Module#local_constants</code>を使用します。</p></li>
<li><p>非推奨の<code>DateTime.local_offset</code>が削除されました。<code>DateTime.civil_from_format</code>を使用します。</p></li>
<li><p>非推奨の<code>Logger</code>コアエクステンション (<code>core_ext/logger.rb</code>) が削除されました。</p></li>
<li><p>非推奨の<code>Time#time_with_datetime_fallback</code>、<code>Time#utc_time</code>、<code>Time#local_time</code>が削除されました。<code>Time#utc</code>および<code>Time#local</code>を使用します。</p></li>
<li><p>非推奨の<code>Hash#diff</code>が代替なしで削除されました。</p></li>
<li><p>非推奨の<code>Date#to_time_in_current_zone</code>が削除されました。<code>Date#in_time_zone</code>を使用します。</p></li>
<li><p>非推奨の<code>Proc#bind</code>が代替なしで削除されました。</p></li>
<li><p>非推奨の<code>Array#uniq_by</code>と<code>Array#uniq_by!</code>が削除されました。ネイティブの<code>Array#uniq</code>および<code>Array#uniq!</code>を使用してください。</p></li>
<li><p>非推奨の<code>ActiveSupport::BasicObject</code>が削除されました。<code>ActiveSupport::ProxyObject</code>を使用してください。</p></li>
<li><p>非推奨の<code>BufferedLogger</code>が削除されました。<code>ActiveSupport::Logger</code>を使用してください。</p></li>
<li><p>非推奨の<code>assert_present</code>メソッドと<code>assert_blank</code>メソッドが削除されました。<code>assert object.blank?</code>および<code>assert object.present?</code>を使用してください。</p></li>
<li><p>フィルタオブジェクト用の非推奨<code>#filter</code>メソッドが削除されました。対応する別のメソッドを使用してください。(before filterの<code>#before</code>など)</p></li>
<li><p>デフォルトの活用形から不規則活用の'cow' =&gt; 'kine'が削除されました。(<a href="https://github.com/rails/rails/commit/c300dca9963bda78b8f358dbcb59cabcdc5e1dc9">Commit</a>)</p></li>
</ul>
<h4 id="59b1c03d62d9e0f176827408dbda6e0f3b95e531">7.2 非推奨</h4>
<ul>
<li><p>時間表現<code>Numeric#{ago,until,since,from_now}</code>が非推奨になりました。この値はAS::Durationに明示的に変換してください。例: <code>5.ago</code> =&gt; <code>5.seconds.ago</code> (<a href="https://github.com/rails/rails/pull/12389">Pull Request</a>)</p></li>
<li><p>requireパス<code>active_support/core_ext/object/to_json</code>が非推奨になりました。<code>active_support/core_ext/object/json</code>を代りにrequireしてください。(<a href="https://github.com/rails/rails/pull/12203">Pull Request</a>)</p></li>
<li><p><code>ActiveSupport::JSON::Encoding::CircularReferenceError</code>が非推奨になりました。この機能は<a href="https://github.com/rails/activesupport-json_encoder">activesupport-json_encoder</a> gemに書き出されました。(<a href="https://github.com/rails/rails/pull/10785">Pull Request</a> / <a href="upgrading_ruby_on_rails.html#changes-in-json-handling">詳細</a>)</p></li>
<li><p><code>ActiveSupport.encode_big_decimal_as_string</code>オプションが非推奨になりました。この機能は<a href="https://github.com/rails/activesupport-json_encoder">activesupport-json_encoder</a> gemに書き出されました。
(<a href="https://github.com/rails/rails/pull/13060">Pull Request</a> / <a href="upgrading_ruby_on_rails.html#changes-in-json-handling">詳細</a>)</p></li>
<li><p>カスタムの<code>BigDecimal</code>シリアライズが非推奨になりました。(<a href="https://github.com/rails/rails/pull/13911">Pull Request</a>)</p></li>
</ul>
<h4 id="83d7ddd8135d4147fd05e436fcfd1766471aa123-fb2fba87dbdb0924b42c39367cdc848e4cff62a2">7.3 主な変更点</h4>
<ul>
<li><p><code>ActiveSupport</code>のJSONエンコーダーが書き直され、pure-RubyのカスタムエンコーディングではなくJSON gemを利用するようになりました。
(<a href="https://github.com/rails/rails/pull/12183">Pull Request</a> / <a href="upgrading_ruby_on_rails.html#changes-in-json-handling">詳細</a>)</p></li>
<li><p>JSON gemとの互換性が向上しました。
(<a href="https://github.com/rails/rails/pull/12862">Pull Request</a> / <a href="upgrading_ruby_on_rails.html#changes-in-json-handling">詳細</a>)</p></li>
<li><p><code>ActiveSupport::Testing::TimeHelpers#travel</code>および<code>#travel_to</code>が追加されました。これらのメソッドは、<code>Time.now</code>および<code>Date.today</code>をスタブ化することによって、現在時刻を指定の時刻または時間に変換します。</p></li>
<li><p><code>ActiveSupport::Testing::TimeHelpers#travel_back</code>が追加されました。このメソッドは、<code>travel</code>および<code>travel_to</code>メソッドによって追加されたスタブを削除することで、現在時刻を元の状態に戻します。(<a href="https://github.com/rails/rails/pull/13884">Pull Request</a>)</p></li>
<li><p><code>Numeric#in_milliseconds</code>が追加されました。<code>1.hour.in_milliseconds</code>のように使用でき、これを<code>getTime()</code>などのJavaScript関数に渡すことができます。(<a href="https://github.com/rails/rails/commit/423249504a2b468d7a273cbe6accf4f21cb0e643">Commit</a>)</p></li>
<li><p><code>Date#middle_of_day</code>、<code>DateTime#middle_of_day</code>、<code>Time#middle_of_day</code>メソッドが追加されました。エイリアスとして<code>midday</code>、<code>noon</code>、<code>at_midday</code>、<code>at_noon</code>、<code>at_middle_of_day</code>も追加されました。(<a href="https://github.com/rails/rails/pull/10879">Pull Request</a>)</p></li>
<li><p>期間を生成するための<code>Date#all_week/month/quarter/year</code>が追加されました。(<a href="https://github.com/rails/rails/pull/9685">Pull Request</a>)</p></li>
<li><p><code>Time.zone.yesterday</code>と<code>Time.zone.tomorrow</code>が追加されました。(<a href="https://github.com/rails/rails/pull/12822">Pull Request</a>)</p></li>
<li><p>よく使用される<code>String#gsub("pattern,'')</code>の省略表現として<code>String#remove(pattern)</code>が追加されました。(<a href="https://github.com/rails/rails/commit/5da23a3f921f0a4a3139495d2779ab0d3bd4cb5f">Commit</a>)</p></li>
<li><p>値がnilの項目をハッシュから削除するための<code>Hash#compact</code>および<code>Hash#compact!</code>が追加されました。(<a href="https://github.com/rails/rails/pull/13632">Pull Request</a>)</p></li>
<li><p><code>blank?</code>および<code>present?</code>はシングルトンを返します。(<a href="https://github.com/rails/rails/commit/126dc47665c65cd129967cbd8a5926dddd0aa514">Commit</a>)</p></li>
<li><p>新しい<code>I18n.enforce_available_locales</code> configのデフォルトは<code>true</code>です。これは、ロケールに渡された<code>I18n</code>が<code>available_locales</code>リストに載っていなければならないということです。(<a href="https://github.com/rails/rails/pull/13341">Pull Request</a>)</p></li>
</ul>
<p><code>Module#concerning</code>が導入されました。自然かつ堅苦しくない方法で、クラスから責任を分離します。(<a href="https://github.com/rails/rails/commit/1eee0ca6de975b42524105a59e0521d18b38ab81">Commit</a>)</p>
<ul>
<li>
<code>Object#presence_in</code>が追加されました。値のホワイトリスト化を簡略化します。(<a href="https://github.com/rails/rails/commit/4edca106daacc5a159289eae255207d160f22396">Commit</a>)</li>
</ul>
<h3 id="e3c342ffbee5e40f6dee978ebb19260a5f8c12d4">8 クレジット表記</h3>
<p>膨大な時間を費やしてRailsを作り、頑丈かつ安定したフレームワークにしてくれた多くの皆様については、<a href="http://contributors.rubyonrails.org/">Railsコントリビューターの完全なリスト</a>を参照してください。これらの方々全員に敬意を表明いたします。</p>
</body></html>


        <h3>フィードバックについて</h3>
        <p>
          本ガイドの訳文およびソースコードは、GitHub上の <a href="https://github.com/yasslab/railsguides.jp">yasslab/railsguides.jp</a> で管理・公開されております。
	  本ガイドを読んで、誤字・脱字・誤訳などを見かけましたら、上記リポジトリにてお気軽に <a href="https://github.com/yasslab/railsguides.jp/issues">Issue</a> を出して頂けると大変嬉しいです。また、「Pull Request を送りたい!」という場合には、<a href="ruby_on_rails_guides_guidelines.html">Ruby on Railsガイドのガイドライン</a>と、<a href="https://github.com/yasslab/railsguides.jp#%E7%BF%BB%E8%A8%B3%E3%81%AE%E6%B5%81%E3%82%8C">README</a>に記載されている「翻訳の流れ」をご参考にしてください。
	</p>
	<p>
	  なお、原著レベルでの間違いを見つけましたら、原著へのフィードバック方法 (<a href="http://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">documentation contributions</a>) をご参考にしてください。
        </p>
        <p>
	  本ガイドの品質向上に向けて、皆さまのご協力が得られれば幸いです。よろしくお願い致します。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-Share Alike 3.0</a> License</p>
<p>"Rails", "Ruby on Rails", and the Rails logo are trademarks of David Heinemeier Hansson. All rights reserved.</p>

    </div>
  </div>

  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all();
    $(guidesIndex.bind);
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
    ga('create', 'UA-50163209-4', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
