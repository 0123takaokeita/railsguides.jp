<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport"    content="width=device-width, initial-scale=1"/>
<meta name="description" content="Rails ガイドは、Ruby on Rails Guides に基づいた Rails 4.2 対応のリファレンスガイドです。Rails 開発で生産性を向上する方法や、各部品がどのように連携しているかなどを体系的に理解する上で役に立ちます。" />
<meta name="keywords"    content="Ruby Rails ガイド 体系的 入門 無料" />
<meta name="author"      content="Ruby on Rails Community" />

<meta property="fb:admins"      content="715330868" />
<meta property="og:title"       content="Ruby on Rails ガイド：体系的に Rails を学ぼう"/>
<meta property="og:site_name"   content="Ruby on Rails ガイド：体系的に Rails を学ぼう"/>
<meta property="og:image"       content="http://railsguides.jp/images/cover_for_facebook.png"/>
<meta property="og:url"         content="http://railsguides.jp/" />
<meta property="og:type"        content="article" />
<meta property="og:description" content="Rails ガイドは、Ruby on Rails Guides に基づいた Rails 4.2 対応のリファレンスガイドです。Rails 開発で生産性を向上する方法や、各部品がどのように連携しているかなどを体系的に理解する上で役に立ちます。" />

<meta name="twitter:card"  content="summary" />
<meta name="twitter:site"  content="@RailsGuidesJP" />
<meta name="twitter:title" content="Ruby on Rails ガイド：体系的に Rails を学ぼう" />
<meta name="twitter:description" content="Rails ガイドは、Ruby on Rails Guides に基づいた Rails 4.2 対応のリファレンスガイドです。Rails 開発で生産性を向上する方法や、各部品がどのように連携しているかなどを体系的に理解する上で役に立ちます。" />
<meta name="twitter:image" content="http://railsguides.jp/images/cover_for_twitter.png" />
<meta name="twitter:url"   content="http://railsguides.jp/" />

<title>Rails アプリケーションのデバッグ — Rails ガイド</title>
<link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />

<link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

<link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
</head>
<body class="guide">
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=614116885378153&version=v2.0";
    fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">関連サイト: </strong>
      <span class="red-button more-info-button">関連URL</span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="http://guides.rubyonrails.org/">原著 (英語)</a></li>
        <li class="more-info"><a href="https://github.com/yasslab/railsguides.jp">ソースコード (GitHub)</a></li>
        <li class="more-info"><a href="http://railstutorial.jp/">Rails チュートリアル</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="/" title="Return to home page">railsguides.jp</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="/">ホーム</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">ガイド目次</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>はじめに</dt>
                <dd><a href="getting_started.html">Rails をはじめよう</a></dd>
                <dt>モデル</dt>
                <dd><a href="active_record_basics.html">Active Record の基礎</a></dd>
                <dd><a href="active_record_migrations.html">Active Record マイグレーション</a></dd>
                <dd><a href="active_record_validations.html">Active Record バリデーション</a></dd>
                <dd><a href="active_record_callbacks.html">Active Record コールバック</a></dd>
                <dd><a href="association_basics.html">Active Record の関連付け</a></dd>
                <dd><a href="active_record_querying.html">Active Record クエリインターフェイス</a></dd>
                <dd><a href="active_model_basics.html">Active Model の基礎</a></dd>
                <dt>ビュー</dt>
                <dd><a href="action_view_overview.html">Action View の概要</a></dd>
                <dd><a href="layouts_and_rendering.html">レイアウトとレンダリング</a></dd>
                <dd><a href="form_helpers.html">Action View フォームヘルパー</a></dd>
                <dt>コントローラ</dt>
                <dd><a href="action_controller_overview.html">Action Controller の概要</a></dd>
                <dd><a href="routing.html">Rails ルーティング</a></dd>
              </dl>
              <dl class="R">
                <dt>高度なトピック</dt>
                <dd><a href="active_support_core_extensions.html">Active Support コア拡張機能</a></dd>
                <dd><a href="i18n.html">Rails 国際化 (i18n) API</a></dd>
                <dd><a href="action_mailer_basics.html">Action Mailer の基礎</a></dd>
                <dd><a href="active_job_basics.html">Active Job の基礎</a></dd>
                <dd><a href="testing.html">Rails テスティングガイド</a></dd>
                <dd><a href="security.html">Rails セキュリティガイド</a></dd>
                <dd><a href="debugging_rails_applications.html">Debugging Rails Applications [未着手]</a></dd>
                <dd><a href="configuring.html">Rails アプリケーションを設定する</a></dd>
                <dd><a href="command_line.html">コマンドラインツールと Rake タスク</a></dd>
                <dd><a href="asset_pipeline.html">アセットパイプライン</a></dd>
                <dd><a href="working_with_javascript_in_rails.html">Rails で JavaScript を使用する</a></dd>
                <dd><a href="engines.html">Rails エンジン入門</a></dd>
                <dd><a href="initialization.html">Rails の初期化プロセス</a></dd>
                <dd><a href="constant_autoloading_and_reloading.html">定数の自動読み込みと再読み込み</a></dd>
                <dt>Rails を拡張する</dt>
                <dd><a href="plugins.html">Rails プラグイン作成入門</a></dd>
                <dd><a href="rails_on_rack.html">Rails と Rack</a></dd>
                <dd><a href="generators.html">Rails ジェネレータとテンプレート入門</a></dd>
                <dt>Ruby on Rails に貢献する</dt>
                <dd><a href="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails [未着手]</a></dd>
                <dd><a href="api_documentation_guidelines.html">APIドキュメント作成ガイドライン</a></dd>
                <dd><a href="ruby_on_rails_guides_guidelines.html">Rails ガイドのガイドライン</a></dd>
                <dt>メンテナンスポリシー</dt>
                <dd><a href="maintenance_policy.html">メンテナンスポリシー</a></dd>
                <dt>リリースノート</dt>
                <dd><a href="upgrading_ruby_on_rails.html">Rails アップグレードガイド</a></dd>
                <dd><a href="4_2_release_notes.html">Ruby on Rails 4.2 リリースノート</a></dd>
                <dd><a href="4_1_release_notes.html">Ruby on Rails 4.1 リリースノート</a></dd>
                <dd><a href="4_0_release_notes.html">Ruby on Rails 4.0 リリースノート</a></dd>
                <dd><a href="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes [未着手]</a></dd>
                <dd><a href="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes [未着手]</a></dd>
                <dd><a href="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes [未着手]</a></dd>
                <dd><a href="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes [未着手]</a></dd>
                <dd><a href="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes [未着手]</a></dd>
              </dl>
          </div>
        </li>
        <li><a class="nav-item" href="https://github.com/yasslab/railsguides.jp#readme">翻訳に貢献する</a></li>
        <li><a class="nav-item" href="credits.html">原著者</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">ガイド目次</option>
              <optgroup label="はじめに">
                  <option value="getting_started.html">Rails をはじめよう</option>
              </optgroup>
              <optgroup label="モデル">
                  <option value="active_record_basics.html">Active Record の基礎</option>
                  <option value="active_record_migrations.html">Active Record マイグレーション</option>
                  <option value="active_record_validations.html">Active Record バリデーション</option>
                  <option value="active_record_callbacks.html">Active Record コールバック</option>
                  <option value="association_basics.html">Active Record の関連付け</option>
                  <option value="active_record_querying.html">Active Record クエリインターフェイス</option>
                  <option value="active_model_basics.html">Active Model の基礎</option>
              </optgroup>
              <optgroup label="ビュー">
                  <option value="action_view_overview.html">Action View の概要</option>
                  <option value="layouts_and_rendering.html">レイアウトとレンダリング</option>
                  <option value="form_helpers.html">Action View フォームヘルパー</option>
              </optgroup>
              <optgroup label="コントローラ">
                  <option value="action_controller_overview.html">Action Controller の概要</option>
                  <option value="routing.html">Rails ルーティング</option>
              </optgroup>
              <optgroup label="高度なトピック">
                  <option value="active_support_core_extensions.html">Active Support コア拡張機能</option>
                  <option value="i18n.html">Rails 国際化 (i18n) API</option>
                  <option value="action_mailer_basics.html">Action Mailer の基礎</option>
                  <option value="active_job_basics.html">Active Job の基礎</option>
                  <option value="testing.html">Rails テスティングガイド</option>
                  <option value="security.html">Rails セキュリティガイド</option>
                  <option value="debugging_rails_applications.html">Debugging Rails Applications [未着手]</option>
                  <option value="configuring.html">Rails アプリケーションを設定する</option>
                  <option value="command_line.html">コマンドラインツールと Rake タスク</option>
                  <option value="asset_pipeline.html">アセットパイプライン</option>
                  <option value="working_with_javascript_in_rails.html">Rails で JavaScript を使用する</option>
                  <option value="engines.html">Rails エンジン入門</option>
                  <option value="initialization.html">Rails の初期化プロセス</option>
                  <option value="constant_autoloading_and_reloading.html">定数の自動読み込みと再読み込み</option>
              </optgroup>
              <optgroup label="Rails を拡張する">
                  <option value="plugins.html">Rails プラグイン作成入門</option>
                  <option value="rails_on_rack.html">Rails と Rack</option>
                  <option value="generators.html">Rails ジェネレータとテンプレート入門</option>
              </optgroup>
              <optgroup label="Ruby on Rails に貢献する">
                  <option value="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails [未着手]</option>
                  <option value="api_documentation_guidelines.html">APIドキュメント作成ガイドライン</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Rails ガイドのガイドライン</option>
              </optgroup>
              <optgroup label="メンテナンスポリシー">
                  <option value="maintenance_policy.html">メンテナンスポリシー</option>
              </optgroup>
              <optgroup label="リリースノート">
                  <option value="upgrading_ruby_on_rails.html">Rails アップグレードガイド</option>
                  <option value="4_2_release_notes.html">Ruby on Rails 4.2 リリースノート</option>
                  <option value="4_1_release_notes.html">Ruby on Rails 4.1 リリースノート</option>
                  <option value="4_0_release_notes.html">Ruby on Rails 4.0 リリースノート</option>
                  <option value="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes [未着手]</option>
                  <option value="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes [未着手]</option>
                  <option value="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes [未着手]</option>
                  <option value="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes [未着手]</option>
                  <option value="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes [未着手]</option>
              </optgroup>
          </select>
        </li>
      </ul>
      </div>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Rails アプリケーションのデバッグ</h2><p>本ガイドでは、Ruby on Rails アプリケーションのさまざまなデバッグ技法をご紹介します。</p><p>このガイドの内容:</p>
<ul>
<li>デバッグの目的</li>
<li>テストで特定できない問題がアプリケーションで発生したときの追跡方法</li>
<li>さまざまなデバッグ方法</li>
<li>スタックトレースの解析方法</li>
</ul>

                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />目次</h3>
            <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<ol class="chapters">
<li>
<a href="#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%AB%E5%88%A9%E7%94%A8%E3%81%A7%E3%81%8D%E3%82%8B%E3%83%93%E3%83%A5%E3%83%BC%E3%83%98%E3%83%AB%E3%83%91%E3%83%BC">デバッグに利用できるビューヘルパー</a>

<ul>
<li><a href="#debug"><code>debug</code></a></li>
<li><a href="#to_yaml"><code>to_yaml</code></a></li>
<li><a href="#inspect"><code>inspect</code></a></li>
</ul>
</li>
<li>
<a href="#%E3%83%AD%E3%82%AC%E3%83%BC">ロガー</a>

<ul>
<li><a href="#%E3%83%AD%E3%82%AC%E3%83%BC%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">ロガーについて</a></li>
<li><a href="#%E3%83%AD%E3%82%B0%E3%81%AE%E5%87%BA%E5%8A%9B%E3%83%AC%E3%83%99%E3%83%AB">ログの出力レベル</a></li>
<li><a href="#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E9%80%81%E4%BF%A1">メッセージ送信</a></li>
<li><a href="#%E3%82%BF%E3%82%B0%E4%BB%98%E3%81%8D%E3%83%AD%E3%82%B0%E3%81%AE%E5%87%BA%E5%8A%9B">タグ付きログの出力</a></li>
<li><a href="#%E3%83%AD%E3%82%B0%E3%81%8C%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%81%AB%E4%B8%8E%E3%81%88%E3%82%8B%E5%BD%B1%E9%9F%BF">ログがパフォーマンスに与える影響</a></li>
</ul>
</li>
<li>
<a href="#byebug-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%99%E3%82%8B"><code>byebug</code> gemを使用してデバッグする</a>

<ul>
<li><a href="#the-shell">The Shell</a></li>
<li><a href="#the-context">The Context</a></li>
<li><a href="#threads">Threads</a></li>
<li><a href="#byebug-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%99%E3%82%8B-inspecting-variables">Inspecting Variables</a></li>
<li><a href="#step-by-step">Step by Step</a></li>
<li><a href="#breakpoints">Breakpoints</a></li>
<li><a href="#catching-exceptions">Catching Exceptions</a></li>
<li><a href="#resuming-execution">Resuming Execution</a></li>
<li><a href="#editing">Editing</a></li>
<li><a href="#quitting">Quitting</a></li>
<li><a href="#byebug-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%99%E3%82%8B-settings">Settings</a></li>
</ul>
</li>
<li>
<a href="#debugging-with-the-web-console-gem">Debugging with the <code>web-console</code> gem</a>

<ul>
<li><a href="#console">Console</a></li>
<li><a href="#debugging-with-the-web-console-gem-inspecting-variables">Inspecting Variables</a></li>
<li><a href="#debugging-with-the-web-console-gem-settings">Settings</a></li>
</ul>
</li>
<li>
<a href="#debugging-memory-leaks">Debugging Memory Leaks</a>

<ul>
<li><a href="#valgrind">Valgrind</a></li>
</ul>
</li>
<li>
<a href="#plugins-for-debugging">Plugins for Debugging</a>

<ul>
<li><a href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99">参考資料</a></li>
</ul>
</li>
</ol>
</body></html>

          </div>
</div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h3 id="デバッグに利用できるビューヘルパー"><a href="#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%AB%E5%88%A9%E7%94%A8%E3%81%A7%E3%81%8D%E3%82%8B%E3%83%93%E3%83%A5%E3%83%BC%E3%83%98%E3%83%AB%E3%83%91%E3%83%BC">1 デバッグに利用できるビューヘルパー</a></h3>
<p>変数にどんな値が入っているかを確認する作業は何かと必要になります。Rails では以下の3つのメソッドを利用できます。</p>
<ul>
<li><code>debug</code></li>
<li><code>to_yaml</code></li>
<li><code>inspect</code></li>
</ul>
<h4 id="debug"><a href="#debug">1.1 <code>debug</code></a></h4>
<p><code>debug</code>ヘルパーは&lt;pre&gt;タグを返します。このタグの中にYAML形式でオブジェクトが出力されます。これにより、あらゆるオブジェクトを人間が読めるデータに変換できます。たとえば、以下のコードがビューにあるとします。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= debug @article %&gt;
&lt;p&gt;
  &lt;b&gt;Title:&lt;/b&gt;
  &lt;%= @article.title %&gt;
&lt;/p&gt;

</pre>
</div>
<p>ここから以下のような出力を得られます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
--- !ruby/object Article
attributes:
  updated_at: 2008-09-05 22:55:47
  body: It's a very helpful guide for debugging your Rails app.
  title: Rails debugging guide
  published: t
  id: "1"
  created_at: 2008-09-05 22:55:47
attributes_cache: {}


Title: Rails debugging guide

</pre>
</div>
<h4 id="to_yaml"><a href="#to_yaml">1.2 <code>to_yaml</code></a></h4>
<p>インスタンス変数や、その他のあらゆるオブジェクトやメソッドをYAML形式で表示します。以下のような感じで使用します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= simple_format @article.to_yaml %&gt;
&lt;p&gt;
  &lt;b&gt;Title:&lt;/b&gt;
  &lt;%= @article.title %&gt;
&lt;/p&gt;

</pre>
</div>
<p><code>to_yaml</code>メソッドは、メソッドをYAML形式に変換して読みやすくし、<code>simple_format</code>ヘルパーは出力結果をコンソールのように行ごとに改行します。これが<code>debug</code>メソッドのマジックです。</p>
<p>これにより、以下のような結果がビューに表示されます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
--- !ruby/object Article
attributes:
updated_at: 2008-09-05 22:55:47
body: It's a very helpful guide for debugging your Rails app.
title: Rails debugging guide
published: t
id: "1"
created_at: 2008-09-05 22:55:47
attributes_cache: {}

Title: Rails debugging guide

</pre>
</div>
<h4 id="inspect"><a href="#inspect">1.3 <code>inspect</code></a></h4>
<p>オブジェクトの値を表示するのに便利なメソッドとして<code>inspect</code>も利用できます。特に、配列やハッシュを扱うときに便利です。このメソッドはオブジェクトの値を文字列として出力します。以下に例を示します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= [1, 2, 3, 4, 5].inspect %&gt;
&lt;p&gt;
  &lt;b&gt;Title:&lt;/b&gt;
  &lt;%= @article.title %&gt;
&lt;/p&gt;

</pre>
</div>
<p>上のコードから以下の出力を得られます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
[1, 2, 3, 4, 5]

Title: Rails debugging guide

</pre>
</div>
<h3 id="ロガー"><a href="#%E3%83%AD%E3%82%AC%E3%83%BC">2 ロガー</a></h3>
<p>実行時に情報をログに保存できるとさらに便利です。Railsは実行環境ごとに異なるログファイルを出力するようになっています。</p>
<h4 id="ロガーについて"><a href="#%E3%83%AD%E3%82%AC%E3%83%BC%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">2.1 ロガーについて</a></h4>
<p>Railsは<code>ActiveSupport::Logger</code>クラスを利用してログ情報を出力します。必要に応じて、<code>Log4r</code>など別のロガーに差し替えることもできます。</p>
<p>別のロガーの指定は、<code>environment.rb</code>または環境ごとの設定ファイルで行います。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Rails.logger = Logger.new(STDOUT)
Rails.logger = Log4r::Logger.new("Application Log")

</pre>
</div>
<p>あるいは、<code>Initializer</code>セクションに以下の <em>いずれか</em> を追加します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
config.logger = Logger.new(STDOUT)
config.logger = Log4r::Logger.new("Application Log")

</pre>
</div>
<div class="info"><p>ログの保存場所は、デフォルトでは<code>Rails.root/log/</code>になります。ログのファイル名は、アプリケーションが実行されるときの環境 (development/test/productionなど) が使用されます。</p></div>
<h4 id="ログの出力レベル"><a href="#%E3%83%AD%E3%82%B0%E3%81%AE%E5%87%BA%E5%8A%9B%E3%83%AC%E3%83%99%E3%83%AB">2.2 ログの出力レベル</a></h4>
<p>ログに出力されるメッセージのログレベルが、設定済みのログレベル以上になった場合に、対応するログファイルにそのメッセージが出力されます。現在のログレベルを知りたい場合は、<code>Rails.logger.level</code>メソッドを呼び出します。</p>
<p>指定可能なログレベルは<code>:debug</code>、<code>:info</code>、<code>:warn</code>、<code>:error</code>、<code>:fatal</code>、<code>:unknown</code>の6つであり、それぞれ0から5までの数字に対応します。デフォルトのログレベルを変更するには以下のようにします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
config.log_level = :warn # 環境ごとのイニシャライザで使用可能
Rails.logger.level = 0 # いつでも使用可能

</pre>
</div>
<p>これは、development環境やstating環境ではログを出力し、production環境では不要な情報をログに出力したくない場合などに便利です。</p>
<div class="info"><p>Railsのデフォルトログレベルは全環境で<code>debug</code>です。</p></div>
<h4 id="メッセージ送信"><a href="#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E9%80%81%E4%BF%A1">2.3 メッセージ送信</a></h4>
<p>コントローラ、モデル、メイラーから現在のログに書き込みたい場合は、<code>logger.(debug|info|warn|error|fatal)</code>を使用します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
logger.debug "Person attributes hash: #{@person.attributes.inspect}"
logger.info "Processing the request..."
logger.fatal "Terminating application, raised unrecoverable error!!!"

</pre>
</div>
<p>例として、ログに別の情報を追加する機能を装備したメソッドを以下に示します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
  class ArticlesController &lt; ApplicationController
  # ...

  def create
    @article = Article.new(params[:article])
    logger.debug "新しい記事: #{@article.attributes.inspect}"
    logger.debug "記事が正しいかどうか: #{@article.valid?}"

    if @article.save
      flash[:notice] =  'Article was successfully created.'
      logger.debug "記事は正常に保存され、ユーザーをリダイレクト中..."
      redirect_to(@article)
    else
      render action: "new"
    end
  end

  # ...
end

</pre>
</div>
<p>上のコントローラのアクションを実行すると、以下のようなログが生成されます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
Processing ArticlesController#create (for 127.0.0.1 at 2008-09-08 11:52:54) [POST]
  Session ID: BAh7BzoMY3NyZl9pZCIlMDY5MWU1M2I1ZDRjODBlMzkyMWI1OTg2NWQyNzViZjYiCmZsYXNoSUM6J0FjdGl
vbkNvbnRyb2xsZXI6OkZsYXNoOjpGbGFzaEhhc2h7AAY6CkB1c2VkewA=--b18cd92fba90eacf8137e5f6b3b06c4d724596a4
  Parameters: {"commit"=&gt;"Create", "article"=&gt;{"title"=&gt;"Debugging Rails",
"body"=&gt;"I'm learning how to print in logs!!!", "published"=&gt;"0"},
"authenticity_token"=&gt;"2059c1286e93402e389127b1153204e0d1e275dd", "action"=&gt;"create", "controller"=&gt;"articles"}
新しい記事: {"updated_at"=&gt;nil, "title"=&gt;"Debugging Rails", "body"=&gt;"I'm learning how to print in logs!!!",
"published"=&gt;false, "created_at"=&gt;nil}
記事が正しいかどうか: true
  Article Create (0.000443)   INSERT INTO "articles" ("updated_at", "title", "body", "published",
"created_at") VALUES('2008-09-08 14:52:54', 'Debugging Rails',
'I''m learning how to print in logs!!!', 'f', '2008-09-08 14:52:54')
記事は正常に保存され、ユーザーをリダイレクト中...
Redirected to # Article:0x20af760&gt;
Completed in 0.01224 (81 reqs/sec) | DB: 0.00044 (3%) | 302 Found [http://localhost/articles]

</pre>
</div>
<p>このようにログに独自の情報を追加すると、予想外の異常な動作をログで見つけやすくなります。ログに独自の情報を追加する場合は、productionログが意味のない大量のメッセージでうずまることのないよう、適切なログレベルを使用するようにしてください。</p>
<h4 id="タグ付きログの出力"><a href="#%E3%82%BF%E3%82%B0%E4%BB%98%E3%81%8D%E3%83%AD%E3%82%B0%E3%81%AE%E5%87%BA%E5%8A%9B">2.4 タグ付きログの出力</a></h4>
<p>ユーザーとアカウントを多数使用するアプリケーションを実行するときに、何らかのカスタムルールを設定してログをフィルタできると便利です。Active Supportの<code>TaggedLogging</code>を使用すれば、サブドメインやリクエストIDなどを指定してログを絞り込むことができ、このようなアプリケーションのデバッグがはかどります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
logger = ActiveSupport::TaggedLogging.new(Logger.new(STDOUT))
logger.tagged("BCX") { logger.info "Stuff" }                            # Logs "[BCX] Stuff"
logger.tagged("BCX", "Jason") { logger.info "Stuff" }                   # Logs "[BCX] [Jason] Stuff"
logger.tagged("BCX") { logger.tagged("Jason") { logger.info "Stuff" } } # Logs "[BCX] [Jason] Stuff"

</pre>
</div>
<h4 id="ログがパフォーマンスに与える影響"><a href="#%E3%83%AD%E3%82%B0%E3%81%8C%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%81%AB%E4%B8%8E%E3%81%88%E3%82%8B%E5%BD%B1%E9%9F%BF">2.5 ログがパフォーマンスに与える影響</a></h4>
<p>ログ出力がRailsアプリのパフォーマンスに与える影響は常にわずかです。ログをディスクに保存する場合は特にそうです。ただし、場合によってはそうとは言い切れないことがあります。</p>
<p>ログレベル<code>:debug</code>は、<code>:fatal</code>と比べてはるかに多くの文字列が評価および(ディスクなどに)出力されるため、パフォーマンスに与える影響がずっと大きくなります。</p>
<p>他にも、以下のように<code>Logger</code>の呼び出しを多数実行した場合には落とし穴に注意する必要があります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
logger.debug "Person attributes hash: #{@person.attributes.inspect}"

</pre>
</div>
<p>上の例では、たとえログ出力レベルをdebugにしなかった場合でもパフォーマンスが低下します。その理由は、上のコードでは文字列を評価する必要があり、その際に比較的動作が重い<code>String</code>オブジェクトのインスタンス化と、実行に時間のかかる変数の式展開 (interpolation) が行われているからです。
したがって、ロガーメソッドに渡すものはブロックの形にしておくことをお勧めします。ブロックとして渡しておけば、ブロックの評価は出力レベルが設定レベル以上になった場合にしか行われない (遅延読み込みなど) ためです。これに従って上のコードを書き直すと以下のようになります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
logger.debug {"Person attributes hash: #{@person.attributes.inspect}"}

</pre>
</div>
<p>渡したブロックの内容 (ここでは文字列の式展開) は、debug が有効になっている場合にしか評価されません。この方法によるパフォーマンスの改善は、大量のログを出力しているときでないとそれほど実感できないかもしれませんが、それでも採用する価値があります。</p>
<h3 id="byebug-gemを使用してデバッグする"><a href="#byebug-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%99%E3%82%8B">3 <code>byebug</code> gemを使用してデバッグする</a></h3>
<p>コードが期待どおりに動作しない場合は、ログやコンソールに出力して問題を診断することができます。ただし、この方法ではエラー追跡を何度も繰り返さねばならず、根本的な原因を突き止めるには能率がよいとは言えません。
実行中のコードに探りを入れる必要があるのであれば、最も頼りになるのはやはりデバッガーです。</p>
<p>デバッガーは、Railsのソースコードを追うときに、そのコードがどこで開始されるのかがを知りたいときにも有用です。Just debug any request to your application and use this guide to learn how to move from the code you have written deeper into Rails code.</p>
<p>設定</p>
<p>You can use the <code>byebug</code> gem to set breakpoints and step through live code in Rails. To install it, just run:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
$ gem install byebug

</pre>
</div>
<p>Inside any Rails application you can then invoke the debugger by calling the <code>byebug</code> method.</p>
<p>以下に例を示します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class PeopleController &lt; ApplicationController
  def new
    byebug
    @person = Person.new
  end
end

</pre>
</div>
<h4 id="the-shell"><a href="#the-shell">3.1 The Shell</a></h4>
<p>As soon as your application calls the <code>byebug</code> method, the debugger will be started in a debugger shell inside the terminal window where you launched your application server, and you will be placed at the debugger's prompt <code>(byebug)</code>.
Before the prompt, the code around the line that is about to be run will be displayed and the current line will be marked by '=&gt;'. 以下に例を示します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
[1, 10] in /PathTo/project/app/controllers/articles_controller.rb
    3:
    4:   # GET /articles
    5:   # GET /articles.json
    6:   def index
    7:     byebug
=&gt;  8:     @articles = Article.find_recent
    9:
   10:     respond_to do |format|
   11:       format.html # index.html.erb
   12:       format.json { render json: @articles }

(byebug)

</pre>
</div>
<p>If you got there by a browser request, the browser tab containing the request will be hung until the debugger has finished and the trace has finished processing the entire request.</p>
<p>以下に例を示します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
=&gt; Booting WEBrick
=&gt; Rails 5.0.0 application starting in development on http://0.0.0.0:3000
=&gt; Run `rails server -h` for more startup options
=&gt; Notice: server is listening on all interfaces (0.0.0.0). Consider using 127.0.0.1 (--binding option)
=&gt; Ctrl-C to shutdown server
[2014-04-11 13:11:47] INFO  WEBrick 1.3.1
[2014-04-11 13:11:47] INFO  ruby 2.1.1 (2014-02-24) [i686-linux]
[2014-04-11 13:11:47] INFO  WEBrick::HTTPServer#start: pid=6370 port=3000


Started GET "/" for 127.0.0.1 at 2014-04-11 13:11:48 +0200
  ActiveRecord::SchemaMigration Load (0.2ms)  SELECT "schema_migrations".* FROM "schema_migrations"
Processing by ArticlesController#index as HTML

[3, 12] in /PathTo/project/app/controllers/articles_controller.rb
    3:
    4:   # GET /articles
    5:   # GET /articles.json
    6:   def index
    7:     byebug
=&gt;  8:     @articles = Article.find_recent
    9:
   10:     respond_to do |format|
   11:       format.html # index.html.erb
   12:       format.json { render json: @articles }

(byebug)

</pre>
</div>
<p>Now it's time to explore and dig into your application. A good place to start is by asking the debugger for help. Type: <code>help</code></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) help

byebug 2.7.0

Type 'help &lt;command-name&gt;' for help on a specific command

Available commands:
backtrace  delete   enable  help       list    pry next  restart  source     up
break      disable  eval    info       method  ps        save     step       var
catch      display  exit    interrupt  next    putl      set      thread
condition  down     finish  irb        p       quit      show     trace
continue   edit     frame   kill       pp      reload    skip     undisplay

</pre>
</div>
<div class="info"><p>To view the help menu for any command use <code>help &lt;command-name&gt;</code> at the debugger prompt. For example: <em><code>help list</code></em>. You can abbreviate any debugging command by supplying just enough letters to distinguish them from other commands, so you can also use <code>l</code> for the <code>list</code> command, for example.</p></div>
<p>To see the previous ten lines you should type <code>list-</code> (or <code>l-</code>)</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) l-

[1, 10] in /PathTo/project/app/controllers/articles_controller.rb
   1  class ArticlesController &lt; ApplicationController
   2    before_action :set_article, only: [:show, :edit, :update, :destroy]
   3
   4    # GET /articles
   5    # GET /articles.json
   6    def index
   7      byebug
   8      @articles = Article.find_recent
   9
   10      respond_to do |format|


</pre>
</div>
<p>This way you can move inside the file, being able to see the code above and over the line where you added the <code>byebug</code> call. Finally, to see where you are in the code again you can type <code>list=</code></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) list=

[3, 12] in /PathTo/project/app/controllers/articles_controller.rb
    3:
    4:   # GET /articles
    5:   # GET /articles.json
    6:   def index
    7:     byebug
=&gt;  8:     @articles = Article.find_recent
    9:
   10:     respond_to do |format|
   11:       format.html # index.html.erb
   12:       format.json { render json: @articles }

(byebug)

</pre>
</div>
<h4 id="the-context"><a href="#the-context">3.2 The Context</a></h4>
<p>When you start debugging your application, you will be placed in different contexts as you go through the different parts of the stack.</p>
<p>The debugger creates a context when a stopping point or an event is reached. The context has information about the suspended program which enables the debugger to inspect the frame stack, evaluate variables from the perspective of the debugged program, and contains information about the place where the debugged program is stopped.</p>
<p>At any time you can call the <code>backtrace</code> command (or its alias <code>where</code>) to print the backtrace of the application. This can be very helpful to know how you got where you are. If you ever wondered about how you got somewhere in your code, then <code>backtrace</code> will supply the answer.</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) where
--&gt; #0  ArticlesController.index
      at /PathTo/project/test_app/app/controllers/articles_controller.rb:8
    #1  ActionController::ImplicitRender.send_action(method#String, *args#Array)
      at /PathToGems/actionpack-5.0.0/lib/action_controller/metal/implicit_render.rb:4
    #2  AbstractController::Base.process_action(action#NilClass, *args#Array)
      at /PathToGems/actionpack-5.0.0/lib/abstract_controller/base.rb:189
    #3  ActionController::Rendering.process_action(action#NilClass, *args#NilClass)
      at /PathToGems/actionpack-5.0.0/lib/action_controller/metal/rendering.rb:10
...

</pre>
</div>
<p>The current frame is marked with <code>--&gt;</code>. You can move anywhere you want in this trace (thus changing the context) by using the <code>frame _n_</code> command, where <em>n</em> is the specified frame number. If you do that, <code>byebug</code> will display your new context.</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) frame 2

[184, 193] in /PathToGems/actionpack-5.0.0/lib/abstract_controller/base.rb
   184:       # is the intended way to override action dispatching.
   185:       #
   186:       # Notice that the first argument is the method to be dispatched
   187:       # which is *not* necessarily the same as the action name.
   188:       def process_action(method_name, *args)
=&gt; 189:         send_action(method_name, *args)
   190:       end
   191:
   192:       # Actually call the method associated with the action. Override
   193:       # this method if you wish to change how action methods are called,

(byebug)

</pre>
</div>
<p>The available variables are the same as if you were running the code line by line. After all, that's what debugging is.</p>
<p>You can also use <code>up [n]</code> (<code>u</code> for abbreviated) and <code>down [n]</code> commands in order to change the context <em>n</em> frames up or down the stack respectively. <em>n</em> defaults to one. Up in this case is towards higher-numbered stack frames, and down is towards lower-numbered stack frames.</p>
<h4 id="threads"><a href="#threads">3.3 Threads</a></h4>
<p>The debugger can list, stop, resume and switch between running threads by using the <code>thread</code> command (or the abbreviated <code>th</code>). This command has a handful of options:</p>
<ul>
<li>
<code>thread</code> shows the current thread.</li>
<li>
<code>thread list</code> is used to list all threads and their statuses. The plus + character and the number indicates the current thread of execution.</li>
<li>
<code>thread stop _n_</code> stop thread <em>n</em>.</li>
<li>
<code>thread resume _n_</code> resumes thread <em>n</em>.</li>
<li>
<code>thread switch _n_</code> switches the current thread context to <em>n</em>.</li>
</ul>
<p>This command is very helpful, among other occasions, when you are debugging concurrent threads and need to verify that there are no race conditions in your code.</p>
<h4 id="byebug-gemを使用してデバッグする-inspecting-variables"><a href="#byebug-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%99%E3%82%8B-inspecting-variables">3.4 Inspecting Variables</a></h4>
<p>Any expression can be evaluated in the current context. To evaluate an expression, just type it!</p>
<p>This example shows how you can print the instance variables defined within the current context:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
[3, 12] in /PathTo/project/app/controllers/articles_controller.rb
    3:
    4:   # GET /articles
    5:   # GET /articles.json
    6:   def index
    7:     byebug
=&gt;  8:     @articles = Article.find_recent
    9:
   10:     respond_to do |format|
   11:       format.html # index.html.erb
   12:       format.json { render json: @articles }

(byebug) instance_variables
[:@_action_has_layout, :@_routes, :@_headers, :@_status, :@_request, :@_response, :@_env, :@_prefixes, :@_lookup_context, :@_action_name, :@_response_body, :@marked_for_same_origin_verification, :@_config]

</pre>
</div>
<p>As you may have figured out, all of the variables that you can access from a controller are displayed. This list is dynamically updated as you execute code.
For example, run the next line using <code>next</code> (you'll learn more about this command later in this guide).</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) next
[5, 14] in /PathTo/project/app/controllers/articles_controller.rb
   5     # GET /articles.json
   6     def index
   7       byebug
   8       @articles = Article.find_recent
   9
=&gt; 10       respond_to do |format|
   11         format.html # index.html.erb
   12        format.json { render json: @articles }
   13      end
   14    end
   15
(byebug)

</pre>
</div>
<p>And then ask again for the instance_variables:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) instance_variables.include? "@articles"
true

</pre>
</div>
<p>Now <code>@articles</code> is included in the instance variables, because the line defining it was executed.</p>
<div class="info"><p>You can also step into <strong>irb</strong> mode with the command <code>irb</code> (of course!).
This way an irb session will be started within the context you invoked it. But be warned: this is an experimental feature.</p></div>
<p>The <code>var</code> method is the most convenient way to show variables and their values.
Let's let <code>byebug</code> help us with it.</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) help var
v[ar] cl[ass]                   show class variables of self
v[ar] const &lt;object&gt;            show constants of object
v[ar] g[lobal]                  show global variables
v[ar] i[nstance] &lt;object&gt;       show instance variables of object
v[ar] l[ocal]                   show local variables

</pre>
</div>
<p>This is a great way to inspect the values of the current context variables. For example, to check that we have no local variables currently defined.</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) var local
(byebug)

</pre>
</div>
<p>You can also inspect for an object method this way:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) var instance Article.new
@_start_transaction_state = {}
@aggregation_cache = {}
@association_cache = {}
@attributes = {"id"=&gt;nil, "created_at"=&gt;nil, "updated_at"=&gt;nil}
@attributes_cache = {}
@changed_attributes = nil
...

</pre>
</div>
<div class="info"><p>The commands <code>p</code> (print) and <code>pp</code> (pretty print) can be used to evaluate
Ruby expressions and display the value of variables to the console.</p></div>
<p>You can use also <code>display</code> to start watching variables. This is a good way of tracking the values of a variable while the execution goes on.</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) display @articles
1: @articles = nil

</pre>
</div>
<p>The variables inside the displaying list will be printed with their values after you move in the stack. To stop displaying a variable use <code>undisplay _n_</code> where <em>n</em> is the variable number (1 in the last example).</p>
<h4 id="step-by-step"><a href="#step-by-step">3.5 Step by Step</a></h4>
<p>Now you should know where you are in the running trace and be able to print the available variables. But lets continue and move on with the application execution.</p>
<p>Use <code>step</code> (abbreviated <code>s</code>) to continue running your program until the next logical stopping point and return control to the debugger.</p>
<p>You may also use <code>next</code> which is similar to step, but function or method calls that appear within the line of code are executed without stopping.</p>
<div class="info"><p>You can also use <code>step n</code> or <code>next n</code> to move forwards <code>n</code> steps at once.</p></div>
<p>The difference between <code>next</code> and <code>step</code> is that <code>step</code> stops at the next line of code executed, doing just a single step, while <code>next</code> moves to the next line without descending inside methods.</p>
<p>For example, consider the following situation:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Started GET "/" for 127.0.0.1 at 2014-04-11 13:39:23 +0200
Processing by ArticlesController#index as HTML

[1, 8] in /home/davidr/Proyectos/test_app/app/models/article.rb
   1: class Article &lt; ActiveRecord::Base
   2:
   3:   def self.find_recent(limit = 10)
   4:     byebug
=&gt; 5:     where('created_at &gt; ?', 1.week.ago).limit(limit)
   6:   end
   7:
   8: end

(byebug)

</pre>
</div>
<p>If we use <code>next</code>, we want go deep inside method calls. Instead, byebug will go to the next line within the same context. In this case, this is the last line of the method, so <code>byebug</code> will jump to next next line of the previous frame.</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) next
Next went up a frame because previous frame finished

[4, 13] in /PathTo/project/test_app/app/controllers/articles_controller.rb
    4:   # GET /articles
    5:   # GET /articles.json
    6:   def index
    7:     @articles = Article.find_recent
    8:
=&gt;  9:     respond_to do |format|
   10:       format.html # index.html.erb
   11:       format.json { render json: @articles }
   12:     end
   13:   end

(byebug)

</pre>
</div>
<p>If we use <code>step</code> in the same situation, we will literally go the next ruby instruction to be executed. In this case, the activesupport's <code>week</code> method.</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) step

[50, 59] in /PathToGems/activesupport-5.0.0/lib/active_support/core_ext/numeric/time.rb
   50:     ActiveSupport::Duration.new(self * 24.hours, [[:days, self]])
   51:   end
   52:   alias :day :days
   53:
   54:   def weeks
=&gt; 55:     ActiveSupport::Duration.new(self * 7.days, [[:days, self * 7]])
   56:   end
   57:   alias :week :weeks
   58:
   59:   def fortnights

(byebug)

</pre>
</div>
<p>This is one of the best ways to find bugs in your code, or perhaps in Ruby on Rails.</p>
<h4 id="breakpoints"><a href="#breakpoints">3.6 Breakpoints</a></h4>
<p>A breakpoint makes your application stop whenever a certain point in the program is reached. The debugger shell is invoked in that line.</p>
<p>You can add breakpoints dynamically with the command <code>break</code> (or just <code>b</code>).
There are 3 possible ways of adding breakpoints manually:</p>
<ul>
<li>
<code>break line</code>: set breakpoint in the <em>line</em> in the current source file.</li>
<li>
<code>break file:line [if expression]</code>: set breakpoint in the <em>line</em> number inside the <em>file</em>. If an <em>expression</em> is given it must evaluated to <em>true</em> to fire up the debugger.</li>
<li>
<code>break class(.|\#)method [if expression]</code>: set breakpoint in <em>method</em> (. and # for class and instance method respectively) defined in <em>class</em>. The <em>expression</em> works the same way as with file:line.</li>
</ul>
<p>For example, in the previous situation</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
[4, 13] in /PathTo/project/app/controllers/articles_controller.rb
    4:   # GET /articles
    5:   # GET /articles.json
    6:   def index
    7:     @articles = Article.find_recent
    8:
=&gt;  9:     respond_to do |format|
   10:       format.html # index.html.erb
   11:       format.json { render json: @articles }
   12:     end
   13:   end

(byebug) break 11
Created breakpoint 1 at /PathTo/project/app/controllers/articles_controller.rb:11


</pre>
</div>
<p>Use <code>info breakpoints _n_</code> or <code>info break _n_</code> to list breakpoints. If you supply a number, it lists that breakpoint. Otherwise it lists all breakpoints.</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) info breakpoints
Num Enb What
1   y   at /PathTo/project/app/controllers/articles_controller.rb:11

</pre>
</div>
<p>To delete breakpoints: use the command <code>delete _n_</code> to remove the breakpoint number <em>n</em>. If no number is specified, it deletes all breakpoints that are currently active.</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) delete 1
(byebug) info breakpoints
No breakpoints.

</pre>
</div>
<p>You can also enable or disable breakpoints:</p>
<ul>
<li>
<code>enable breakpoints</code>: allow a <em>breakpoints</em> list or all of them if no list is specified, to stop your program. This is the default state when you create a breakpoint.</li>
<li>
<code>disable breakpoints</code>: the <em>breakpoints</em> will have no effect on your program.</li>
</ul>
<h4 id="catching-exceptions"><a href="#catching-exceptions">3.7 Catching Exceptions</a></h4>
<p>The command <code>catch exception-name</code> (or just <code>cat exception-name</code>) can be used to intercept an exception of type <em>exception-name</em> when there would otherwise be no handler for it.</p>
<p>To list all active catchpoints use <code>catch</code>.</p>
<h4 id="resuming-execution"><a href="#resuming-execution">3.8 Resuming Execution</a></h4>
<p>There are two ways to resume execution of an application that is stopped in the debugger:</p>
<ul>
<li>
<code>continue</code> [line-specification] (or <code>c</code>): resume program execution, at the address where your script last stopped; any breakpoints set at that address are bypassed. The optional argument line-specification allows you to specify a line number to set a one-time breakpoint which is deleted when that breakpoint is reached.</li>
<li>
<code>finish</code> [frame-number] (or <code>fin</code>): execute until the selected stack frame returns. If no frame number is given, the application will run until the currently selected frame returns. The currently selected frame starts out the most-recent frame or 0 if no frame positioning (e.g up, down or frame) has been performed. If a frame number is given it will run until the specified frame returns.</li>
</ul>
<h4 id="editing"><a href="#editing">3.9 Editing</a></h4>
<p>Two commands allow you to open code from the debugger into an editor:</p>
<ul>
<li>
<code>edit [file:line]</code>: edit <em>file</em> using the editor specified by the EDITOR environment variable. A specific <em>line</em> can also be given.</li>
</ul>
<h4 id="quitting"><a href="#quitting">3.10 Quitting</a></h4>
<p>To exit the debugger, use the <code>quit</code> command (abbreviated <code>q</code>), or its alias <code>exit</code>.</p>
<p>A simple quit tries to terminate all threads in effect. Therefore your server will be stopped and you will have to start it again.</p>
<h4 id="byebug-gemを使用してデバッグする-settings"><a href="#byebug-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%99%E3%82%8B-settings">3.11 Settings</a></h4>
<p><code>byebug</code> has a few available options to tweak its behaviour:</p>
<ul>
<li>
<code>set autoreload</code>: Reload source code when changed (defaults: true).</li>
<li>
<code>set autolist</code>: Execute <code>list</code> command on every breakpoint (defaults: true).</li>
<li>
<code>set listsize _n_</code>: Set number of source lines to list by default to <em>n</em> (defaults: 10)</li>
<li>
<code>set forcestep</code>: Make sure the <code>next</code> and <code>step</code> commands always move to a new line.</li>
</ul>
<p>You can see the full list by using <code>help set</code>. Use <code>help set _subcommand_</code> to learn about a particular <code>set</code> command.</p>
<div class="info"><p>You can save these settings in an <code>.byebugrc</code> file in your home directory.
The debugger reads these global settings when it starts. 以下に例を示します。</p></div>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
set forcestep
set listsize 25

</pre>
</div>
<h3 id="debugging-with-the-web-console-gem"><a href="#debugging-with-the-web-console-gem">4 Debugging with the <code>web-console</code> gem</a></h3>
<p>Web Console is a bit like <code>byebug</code>, but it runs in the browser. In any page you are developing, you can request a console in the context of a view or a controller. The console would be rendered next to your HTML content.</p>
<h4 id="console"><a href="#console">4.1 Console</a></h4>
<p>Inside any controller action or view, you can then invoke the console by calling the <code>console</code> method.</p>
<p>For example, in a controller:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class PostsController &lt; ApplicationController
  def new
    console
    @post = Post.new
  end
end

</pre>
</div>
<p>Or in a view:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;% console %&gt;

&lt;h2&gt;New Post&lt;/h2&gt;

</pre>
</div>
<p>This will render a console inside your view. You don't need to care about the location of the <code>console</code> call; it won't be rendered on the spot of its invocation but next to your HTML content.</p>
<p>The console executes pure Ruby code. You can define and instantiate custom classes, create new models and inspect variables.</p>
<div class="note"><p>Only one console can be rendered per request. Otherwise <code>web-console</code> will raise an error on the second <code>console</code> invocation.</p></div>
<h4 id="debugging-with-the-web-console-gem-inspecting-variables"><a href="#debugging-with-the-web-console-gem-inspecting-variables">4.2 Inspecting Variables</a></h4>
<p>You can invoke <code>instance_variables</code> to list all the instance variables available in your context. If you want to list all the local variables, you can do that with <code>local_variables</code>.</p>
<h4 id="debugging-with-the-web-console-gem-settings"><a href="#debugging-with-the-web-console-gem-settings">4.3 Settings</a></h4>
<ul>
<li>
<code>config.web_console.whitelisted_ips</code>: Authorized list of IPv4 or IPv6 addresses and networks (defaults: <code>127.0.0.1/8, ::1</code>).</li>
<li>
<code>config.web_console.whiny_requests</code>: Log a message when a console rendering is prevented (defaults: <code>true</code>).</li>
</ul>
<p>Since <code>web-console</code> evaluates plain Ruby code remotely on the server, don't try to use it in production.</p>
<h3 id="debugging-memory-leaks"><a href="#debugging-memory-leaks">5 Debugging Memory Leaks</a></h3>
<p>A Ruby application (on Rails or not), can leak memory - either in the Ruby code or at the C code level.</p>
<p>In this section, you will learn how to find and fix such leaks by using tool such as Valgrind.</p>
<h4 id="valgrind"><a href="#valgrind">5.1 Valgrind</a></h4>
<p><a href="http://valgrind.org/">Valgrind</a> is a Linux-only application for detecting C-based memory leaks and race conditions.</p>
<p>There are Valgrind tools that can automatically detect many memory management and threading bugs, and profile your programs in detail. For example, if a C extension in the interpreter calls <code>malloc()</code> but doesn't properly call <code>free()</code>, this memory won't be available until the app terminates.</p>
<p>For further information on how to install Valgrind and use with Ruby, refer to <a href="http://blog.evanweaver.com/articles/2008/02/05/valgrind-and-ruby/">Valgrind and Ruby</a> by Evan Weaver.</p>
<h3 id="plugins-for-debugging"><a href="#plugins-for-debugging">6 Plugins for Debugging</a></h3>
<p>There are some Rails plugins to help you to find errors and debug your application. Here is a list of useful plugins for debugging:</p>
<ul>
<li>
<a href="https://github.com/josevalim/rails-footnotes">Footnotes</a> Every Rails page has footnotes that give request information and link back to your source via TextMate.</li>
<li>
<a href="https://github.com/ruckus/active-record-query-trace/tree/master">Query Trace</a> Adds query origin tracing to your logs.</li>
<li>
<a href="https://github.com/nesquena/query_reviewer">Query Reviewer</a> This rails plugin not only runs "EXPLAIN" before each of your select queries in development, but provides a small DIV in the rendered output of each page with the summary of warnings for each query that it analyzed.</li>
<li>
<a href="https://github.com/smartinez87/exception_notification/tree/master">Exception Notifier</a> Provides a mailer object and a default set of templates for sending email notifications when errors occur in a Rails application.</li>
<li>
<a href="https://github.com/charliesome/better_errors">Better Errors</a> Replaces the standard Rails error page with a new one containing more contextual information, like source code and variable inspection.</li>
<li>
<a href="https://github.com/dejan/rails_panel">RailsPanel</a> Chrome extension for Rails development that will end your tailing of development.log. Have all information about your Rails app requests in the browser - in the Developer Tools panel.
Provides insight to db/rendering/total times, parameter list, rendered views and more.</li>
</ul>
<h4 id="参考資料"><a href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99">6.1 参考資料</a></h4>
<hr>

<ul>
<li><a href="http://bashdb.sourceforge.net/ruby-debug/home-page.html">ruby-debug Homepage</a></li>
<li><a href="https://github.com/cldwalker/debugger">debugger Homepage</a></li>
<li><a href="https://github.com/deivid-rodriguez/byebug">byebug Homepage</a></li>
<li><a href="https://github.com/rails/web-console">web-console Homepage</a></li>
<li><a href="http://www.sitepoint.com/debug-rails-app-ruby-debug/">Article: Debugging a Rails application with ruby-debug</a></li>
<li><a href="http://railscasts.com/episodes/54-debugging-ruby-revised">Ryan Bates' debugging ruby (revised) screencast</a></li>
<li><a href="http://railscasts.com/episodes/24-the-stack-trace">Ryan Bates' stack trace screencast</a></li>
<li><a href="http://railscasts.com/episodes/56-the-logger">Ryan Bates' logger screencast</a></li>
<li><a href="http://bashdb.sourceforge.net/ruby-debug.html">Debugging with ruby-debug</a></li>
</ul>
</body></html>

        
        <h3>フィードバックについて</h3>
        <p>
          本ガイドの訳文およびソースコードは、GitHub上の <a href="https://github.com/yasslab/railsguides.jp">yasslab/railsguides.jp</a> で管理・公開されております。
	  本ガイドを読んで、誤字・脱字・誤訳などを見かけましたら、上記リポジトリにてお気軽に <a href="https://github.com/yasslab/railsguides.jp/issues">Issue</a> を出して頂けると大変嬉しいです。また、「Pull Request を送りたい!」という場合には、<a href="ruby_on_rails_guides_guidelines.html">Ruby on Railsガイドのガイドライン</a>と、<a href="https://github.com/yasslab/railsguides.jp#%E7%BF%BB%E8%A8%B3%E3%81%AE%E6%B5%81%E3%82%8C">README</a>に記載されている「翻訳の流れ」をご参考にしてください。
	</p>
	<p>
	  なお、原著レベルでの間違いを見つけましたら、原著へのフィードバック方法 (<a href="http://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">documentation contributions</a>) をご参考にしてください。
        </p>
        <p>
	  本ガイドの品質向上に向けて、皆さまのご協力が得られれば幸いです。よろしくお願い致します。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <ol class="snsb" style="margin-left: 13px">
	<li><a href="http://www.railscp.org/text/" target="_blank"><img src="images/railscp_logo.png" width="150px"/></a></li>
      </ol>
      <ol class="snsb" style="margin-left: 13px">
	<li><iframe src="http://ghbtns.com/github-btn.html?user=yasslab&repo=railsguides.jp&type=watch&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="80" height="20"></iframe></li>
	<li><a href="http://b.hatena.ne.jp/entry/railsguides.jp" class="hatena-bookmark-button" data-hatena-bookmark-title="Ruby on Rails ガイド：体系的に Rails を学ぼう (Rails 4.2 対応)" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script></li>
	<li><div class="fb-like" data-href="http://railsguides.jp/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div></li>
	<li><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://railsguides.jp/" data-text="Ruby on Rails ガイド：体系的に Rails を学ぼう (Rails 4.2 対応)" data-lang="ja" data-hashtags="Railsガイド" width="100">ツイート</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></li>
      </ol>
      <ol class="snsb" style="margin-left: 13px">
	<li>本ガイドは<a href="https://creativecommons.org/licenses/by-sa/4.0/deed.ja">クリエイティブ・コモンズ 表示-継承 4.0 国際</a> (CC BY-SA 4.0) ライセンスに基づいて公開されています。</li>
	<li>「Rails」および「Ruby on Rails」という名称、そして Rails のロゴは、David Heinemeier Hansson による登録商標で、すべての権利を有しています。</li>
      </ol>
    </div>
  </div>
</h5>
  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all();
    $(guidesIndex.bind);
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
    ga('create', 'UA-50163209-4', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
